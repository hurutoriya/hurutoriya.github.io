<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>Jupyter Notebook で Pandas DataFrame 内部にURLから画像を参照することで、画像をダウンロードすることなく表示させる | Shunya Ueta</title><link rel=stylesheet href=/sass/main.min.b81b77bfef641cdef5a77f4a7bb221547def6cea9b73ab29b5fed4c98707f2a8.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-39994406-11','auto');ga('send','pageview');}</script><meta property="og:title" content="Jupyter Notebook で Pandas DataFrame 内部にURLから画像を参照することで、画像をダウンロードすることなく表示させる"><meta property="og:description" content="データ分析などをしていると、画像はダウンロードせずに特定の CDN (GCP なら GCS, AWS なら S3 など)で提供されている画像を参照して、 Jupyter Notebook 上で良い感じに表示させたいときがありませんか?
例えば、画像と説明文がペアになっているデータを画像自体はダウンロードせずに Jupyter 上で画像と説明文を DataFrame として表示させたいときが多々ある。 元の画像自体は CDN に格納されていて、画像をダウンロードする必要はなく参照するだけのときにはすごく便利。 毎度画像を CDN からダウンロードするのも無駄なので、画像を加工せずに Jupyter 上で表示するだけなら、この方法がベストですね。
url からとってきた画像を jupyter に表示する でも同じような課題に取り組んでいるが、今回紹介する方法なら余計なパッケージを入れずに最小構成で Jupyter 上で表示できるのが利点。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  import pandas as pd from IPython.display import HTML # NOTE: https://www.irasutoya.com/2021/01/onepiece.html から画像を参照 onepiece = { &#34;モンキー・D・ルフィ&#34; : &#34;https://1.bp.blogspot.com/-uxIsaN0S5lQ/X-FcrvAAInI/AAAAAAABdD4/6uw_qNUh9dQrG0aUzIExybt84yTEmXOPwCNcBGAsYHQ/s200/onepiece01_luffy.png&#34;, &#34;ロロノア・ゾロ&#34; : &#34;https://1."><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2021-12-28/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="article:published_time" content="2021-12-28T23:04:19+09:00"><meta property="article:modified_time" content="2022-01-11T15:28:18+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="Jupyter Notebook で Pandas DataFrame 内部にURLから画像を参照することで、画像をダウンロードすることなく表示させる"><meta name=twitter:description content="データ分析などをしていると、画像はダウンロードせずに特定の CDN (GCP なら GCS, AWS なら S3 など)で提供されている画像を参照して、 Jupyter Notebook 上で良い感じに表示させたいときがありませんか?
例えば、画像と説明文がペアになっているデータを画像自体はダウンロードせずに Jupyter 上で画像と説明文を DataFrame として表示させたいときが多々ある。 元の画像自体は CDN に格納されていて、画像をダウンロードする必要はなく参照するだけのときにはすごく便利。 毎度画像を CDN からダウンロードするのも無駄なので、画像を加工せずに Jupyter 上で表示するだけなら、この方法がベストですね。
url からとってきた画像を jupyter に表示する でも同じような課題に取り組んでいるが、今回紹介する方法なら余計なパッケージを入れずに最小構成で Jupyter 上で表示できるのが利点。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  import pandas as pd from IPython.display import HTML # NOTE: https://www.irasutoya.com/2021/01/onepiece.html から画像を参照 onepiece = { &#34;モンキー・D・ルフィ&#34; : &#34;https://1.bp.blogspot.com/-uxIsaN0S5lQ/X-FcrvAAInI/AAAAAAABdD4/6uw_qNUh9dQrG0aUzIExybt84yTEmXOPwCNcBGAsYHQ/s200/onepiece01_luffy.png&#34;, &#34;ロロノア・ゾロ&#34; : &#34;https://1."></head><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/><span class=emoji>🦅</span>
Shunya Ueta</a></div><div class=flex><a href=/articles/>All posts</a>
<a href=/newsletter/>Newsletter</a>
<button id=dark-mode-button></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Jupyter Notebook で Pandas DataFrame 内部にURLから画像を参照することで、画像をダウンロードすることなく表示させる</h1><div class=post-meta><div>By Shunya Ueta on <time>2021.12.28</time> (Last updated:<time>2022.01.11</time>)</div><div class=tags><a href=/tags/python/>python</a>
<a href=/tags/jupyter/>jupyter</a>
<a href=/tags/pandas/>pandas</a></div></div></div></div></header></article><div class=article-post><p>データ分析などをしていると、画像はダウンロードせずに特定の CDN (GCP なら GCS, AWS なら S3 など)で提供されている画像を参照して、 Jupyter Notebook 上で良い感じに表示させたいときがありませんか?</p><p>例えば、画像と説明文がペアになっているデータを画像自体はダウンロードせずに Jupyter 上で画像と説明文を DataFrame として表示させたいときが多々ある。
元の画像自体は CDN に格納されていて、画像をダウンロードする必要はなく参照するだけのときにはすごく便利。
毎度画像を CDN からダウンロードするのも無駄なので、画像を加工せずに Jupyter 上で表示するだけなら、この方法がベストですね。</p><p><a href=https://tsukin.hateblo.jp/entry/2020/04/08/162605>url からとってきた画像を jupyter に表示する</a> でも同じような課題に取り組んでいるが、今回紹介する方法なら余計なパッケージを入れずに最小構成で Jupyter 上で表示できるのが利点。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>pandas</span> <span class=kn>as</span> <span class=nn>pd</span>
<span class=kn>from</span> <span class=nn>IPython.display</span> <span class=kn>import</span> <span class=n>HTML</span>

<span class=c1># NOTE: https://www.irasutoya.com/2021/01/onepiece.html から画像を参照</span>
<span class=n>onepiece</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>&#34;モンキー・D・ルフィ&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://1.bp.blogspot.com/-uxIsaN0S5lQ/X-FcrvAAInI/AAAAAAABdD4/6uw_qNUh9dQrG0aUzIExybt84yTEmXOPwCNcBGAsYHQ/s200/onepiece01_luffy.png&#34;</span><span class=p>,</span>
    <span class=s2>&#34;ロロノア・ゾロ&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://1.bp.blogspot.com/-rzRcgoXDqEg/YAOTCKoCpPI/AAAAAAABdOI/5Bl3_zhOxm07TUGzW8_83cXMOT9yy1VJwCNcBGAsYHQ/s200/onepiece02_zoro_bandana.png&#34;</span><span class=p>,</span>
    <span class=s2>&#34;ナミ&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://1.bp.blogspot.com/-2ut_UQv3iss/X-Fcs_0oAII/AAAAAAABdD8/jrCZTd_xK-Y6CP1KwOtT_LpEpjp-1nvxgCNcBGAsYHQ/s200/onepiece03_nami.png&#34;</span><span class=p>,</span>
    <span class=s2>&#34;そげキング（ウソップ）&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://1.bp.blogspot.com/-mZpzgXC1Sxk/YAOTCAKwWTI/AAAAAAABdOM/5B4hXli0KLU5N-BySHgjVbhZscKLSE-bQCNcBGAsYHQ/s200/onepiece04_usopp_sogeking.png&#34;</span><span class=p>,</span>
<span class=p>}</span>

<span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s2>&#34;Name&#34;</span><span class=p>:</span> <span class=n>onepiece</span><span class=o>.</span><span class=n>keys</span><span class=p>(),</span>
                   <span class=s2>&#34;Image&#34;</span><span class=p>:</span> <span class=n>onepiece</span><span class=o>.</span><span class=n>values</span><span class=p>()})</span>

<span class=k>def</span> <span class=nf>path_to_image_html</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>f</span><span class=s1>&#39;&lt;img src=&#34;{path}&#34;/&gt;&#39;</span>

<span class=n>pd</span><span class=o>.</span><span class=n>set_option</span><span class=p>(</span><span class=s1>&#39;display.max_colwidth&#39;</span><span class=p>,</span> <span class=bp>None</span><span class=p>)</span>
<span class=n>HTML</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>to_html</span><span class=p>(</span><span class=n>escape</span><span class=o>=</span><span class=bp>False</span> <span class=p>,</span><span class=n>formatters</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=n>path_to_image_html</span><span class=p>)))</span>
</code></pre></td></tr></table></div></div><p>結果はこうなる</p><p><img src=/posts/2021-12-28/images/1.png alt="Jupyter 上でDataFrame内部に画像が表示されている"></p><p>やっていることとしては、</p><ol><li>Pandas の<a href=https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_html.html>DataFrame.to_html()</a>関数で、DataFrame を HTML に変換</li><li>変換時に、<code>escape=False</code> にすることでエスケープせずに HTML を出力</li><li><code>formatters</code>では、特定のカラムに関数を適用して変換できる。この関数は文字列を返す関数でなくてはならない。</li><li>最後に出力された HTML を <code>IPython.display</code> の<code>HTML</code>モジュールで HTML を Jupyter 上で表示</li></ol><h2 id=appendix>Appendix</h2><p>Gist はこちら</p><script src=https://gist.github.com/hurutoriya/0ebd3b83be391948fdec11e2dbfe5c83.js></script><p>Colab でも公開しておきます</p><p><a href="https://colab.research.google.com/drive/1ufdIjcElRjmOLeYOy2RplgqXxaHXOgau?usp=sharing">Colab link</a></p><h2 id=references>References</h2><ul><li><a href=https://tsukin.hateblo.jp/entry/2020/04/08/162605>url からとってきた画像を jupyter に表示する</a></li><li><a href=https://stackoverflow.com/questions/37365824/pandas-ipython-notebook-include-and-display-an-image-in-a-dataframe>Pandas / IPython Notebook: Include and display an Image in a dataframe</a></li></ul></div><h2>Support</h2><div class=container><div class=posts><div class=post><div class=post-row><a href=https://www.buymeacoffee.com/hurutoriya target=_blank>☕️ Buy me a cofee: お読みくださりありがとうございます。
こちらから ☕ を一杯支援していただけると、ブログ執筆のモチベーションに繋がります ✨</a></div></div></div></div><h2>See Also</h2><ul><li><a href=/posts/2020-09-09/>pandas を使って特定のディレクトリのCSVファイルをすべて連結して一つのCSVファイルを作成</a></li><li><a href=/posts/2019-10-03/>遅すぎる `pandas.read_gbq` を使わずに、Google BigQueryから高速にデータを読み込む</a></li><li><a href=/posts/2019-09-25/>Jupyter Notebook上にTensorboard を わずか2行で表示させる</a></li><li><a href=/posts/2018-04-23/>Google Colaboratory で Mecab-ipadic-Neologd を使用可能にする</a></li><li><a href=/posts/2018-01-15/>Jupyter Notebookの差分を明瞭に確認する事ができるpackage : nbdime</a></li></ul></div><div class=container><nav class="flex container suggested"><a rel=prev href=/posts/2021-12-26/ title="Previous post (older)"><span>Previous</span>
[抄訳] Daria Sorokina さんによる、 Amazon 検索での製品のランキング付けの楽しさ at MLconf SF 2016</a>
<a rel=next href=/posts/2021-12-29/ title="Next post (newer)"><span>Next</span>
2021 年振り返り</a></nav></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/about/>About</a>
<a href=/newsletter/>Newsletter</a>
<a href=/index.xml>RSS</a>
<a href=https://www.buymeacoffee.com/hurutoriya>Support</a></nav></section><script async src=/js/features.min.a94f58a30ad2560de728e080d87f75c60cf806fd1b3d5f4815f1a1a02c0d1859.js></script></footer></body></html>