<!doctype html><html lang=ja><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Streamlit でアップロードしたファイルのパスを取得して、特定の処理をする | hurutoriya</title><meta name=title content="Streamlit でアップロードしたファイルのパスを取得して、特定の処理をする"><meta name=description content="モチベーション Streamlit は Python code のみで簡単かつ高速に Web アプリを作成できる強力なパッケージ。 Streamplit で作られた Web アプリ経由でファイルをアップロードして、そのファイルを処理したい際の具体的な実現方法がなかったので備忘録がてら残しておく。
PDF ファイルをアップロードして、画像に変換する Web アプリ 具体的に例を交えつつ説明する。 Streamlit を使って、PDF ファイルをアップロードしてアップロードされた PDF ファイルを画像化するアプリを作成する。 今回は、Belval/pdf2image という PDF パッケージを使用する。 このパッケージは処理したい PDF のファイルパスを要求するインターフェースなので今回の実例に沿っていてわかりやすい。 ローカルマシンは MacOS を想定しており、pdf2image はpoppler の事前インストールが必須。
完成形のスクリーンショット GitHub でもコードを公開しておきました。
hurutoriya/streamlist-file-uploader-example
デモ動画はこちら
Demo Movie in Youtube
Makefile Makefile は依存パッケージを事前インストールするために採用
install: brew install poppler poetry install run: poetry run streamlit run streamlit_pdf_uploader/main.py Poetry for package management 環境構築は poetry を使っています。
[tool.poetry] name = &#34;streamlit-pdf-uploader&#34; version = &#34;0."><meta name=keywords content="python,streamlit,"><meta property="og:title" content="Streamlit でアップロードしたファイルのパスを取得して、特定の処理をする"><meta property="og:description" content="モチベーション Streamlit は Python code のみで簡単かつ高速に Web アプリを作成できる強力なパッケージ。 Streamplit で作られた Web アプリ経由でファイルをアップロードして、そのファイルを処理したい際の具体的な実現方法がなかったので備忘録がてら残しておく。
PDF ファイルをアップロードして、画像に変換する Web アプリ 具体的に例を交えつつ説明する。 Streamlit を使って、PDF ファイルをアップロードしてアップロードされた PDF ファイルを画像化するアプリを作成する。 今回は、Belval/pdf2image という PDF パッケージを使用する。 このパッケージは処理したい PDF のファイルパスを要求するインターフェースなので今回の実例に沿っていてわかりやすい。 ローカルマシンは MacOS を想定しており、pdf2image はpoppler の事前インストールが必須。
完成形のスクリーンショット GitHub でもコードを公開しておきました。
hurutoriya/streamlist-file-uploader-example
デモ動画はこちら
Demo Movie in Youtube
Makefile Makefile は依存パッケージを事前インストールするために採用
install: brew install poppler poetry install run: poetry run streamlit run streamlit_pdf_uploader/main.py Poetry for package management 環境構築は poetry を使っています。
[tool.poetry] name = &#34;streamlit-pdf-uploader&#34; version = &#34;0."><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2021-07-08/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-08T22:40:37+09:00"><meta property="article:modified_time" content="2021-07-08T22:40:37+09:00"><meta property="og:site_name" content="hurutoriya"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="Streamlit でアップロードしたファイルのパスを取得して、特定の処理をする"><meta name=twitter:description content="モチベーション Streamlit は Python code のみで簡単かつ高速に Web アプリを作成できる強力なパッケージ。 Streamplit で作られた Web アプリ経由でファイルをアップロードして、そのファイルを処理したい際の具体的な実現方法がなかったので備忘録がてら残しておく。
PDF ファイルをアップロードして、画像に変換する Web アプリ 具体的に例を交えつつ説明する。 Streamlit を使って、PDF ファイルをアップロードしてアップロードされた PDF ファイルを画像化するアプリを作成する。 今回は、Belval/pdf2image という PDF パッケージを使用する。 このパッケージは処理したい PDF のファイルパスを要求するインターフェースなので今回の実例に沿っていてわかりやすい。 ローカルマシンは MacOS を想定しており、pdf2image はpoppler の事前インストールが必須。
完成形のスクリーンショット GitHub でもコードを公開しておきました。
hurutoriya/streamlist-file-uploader-example
デモ動画はこちら
Demo Movie in Youtube
Makefile Makefile は依存パッケージを事前インストールするために採用
install: brew install poppler poetry install run: poetry run streamlit run streamlit_pdf_uploader/main.py Poetry for package management 環境構築は poetry を使っています。
[tool.poetry] name = &#34;streamlit-pdf-uploader&#34; version = &#34;0."><meta itemprop=name content="Streamlit でアップロードしたファイルのパスを取得して、特定の処理をする"><meta itemprop=description content="モチベーション Streamlit は Python code のみで簡単かつ高速に Web アプリを作成できる強力なパッケージ。 Streamplit で作られた Web アプリ経由でファイルをアップロードして、そのファイルを処理したい際の具体的な実現方法がなかったので備忘録がてら残しておく。
PDF ファイルをアップロードして、画像に変換する Web アプリ 具体的に例を交えつつ説明する。 Streamlit を使って、PDF ファイルをアップロードしてアップロードされた PDF ファイルを画像化するアプリを作成する。 今回は、Belval/pdf2image という PDF パッケージを使用する。 このパッケージは処理したい PDF のファイルパスを要求するインターフェースなので今回の実例に沿っていてわかりやすい。 ローカルマシンは MacOS を想定しており、pdf2image はpoppler の事前インストールが必須。
完成形のスクリーンショット GitHub でもコードを公開しておきました。
hurutoriya/streamlist-file-uploader-example
デモ動画はこちら
Demo Movie in Youtube
Makefile Makefile は依存パッケージを事前インストールするために採用
install: brew install poppler poetry install run: poetry run streamlit run streamlit_pdf_uploader/main.py Poetry for package management 環境構築は poetry を使っています。
[tool.poetry] name = &#34;streamlit-pdf-uploader&#34; version = &#34;0."><meta itemprop=datePublished content="2021-07-08T22:40:37+09:00"><meta itemprop=dateModified content="2021-07-08T22:40:37+09:00"><meta itemprop=wordCount content="250"><meta itemprop=image content="https://shunyaueta.com/ogp.jpg"><meta itemprop=keywords content="python,streamlit,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-JMJRQJT0Q3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JMJRQJT0Q3")</script></head><body><header><a href=/ class=title><h2>hurutoriya</h2></a><nav><a href=/index.xml>RSS</a>
<a href=/about/>著者について</a></nav></header><main><h1>Streamlit でアップロードしたファイルのパスを取得して、特定の処理をする</h1><p><i><time datetime=2021-07-08 pubdate>2021-07-08</time></i></p><content><h2 id=モチベーション>モチベーション</h2><p><a href=https://streamlit.io/>Streamlit</a> は Python code のみで簡単かつ高速に Web アプリを作成できる強力なパッケージ。
Streamplit で作られた Web アプリ経由でファイルをアップロードして、そのファイルを処理したい際の具体的な実現方法がなかったので備忘録がてら残しておく。</p><h2 id=pdf-ファイルをアップロードして画像に変換する-web-アプリ>PDF ファイルをアップロードして、画像に変換する Web アプリ</h2><p>具体的に例を交えつつ説明する。
Streamlit を使って、PDF ファイルをアップロードしてアップロードされた PDF ファイルを画像化するアプリを作成する。
今回は、<a href=https://github.com/Belval/pdf2image>Belval/pdf2image</a> という PDF パッケージを使用する。
このパッケージは処理したい PDF のファイルパスを要求するインターフェースなので今回の実例に沿っていてわかりやすい。
ローカルマシンは MacOS を想定しており、<code>pdf2image</code> は<a href=https://poppler.freedesktop.org/>poppler</a> の事前インストールが必須。</p><h3 id=完成形のスクリーンショット>完成形のスクリーンショット</h3><p><img src=/posts/2021-07-08/images/1.png alt="get the uploaded file path in Streamlit"></p><p>GitHub でもコードを公開しておきました。</p><p><a href=https://github.com/hurutoriya/streamlist-file-uploader-example>hurutoriya/streamlist-file-uploader-example</a></p><p>デモ動画はこちら</p><p><a href=https://youtu.be/ILGVapirwlg>Demo Movie in Youtube</a></p><h3 id=makefile>Makefile</h3><p>Makefile は依存パッケージを事前インストールするために採用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=display:flex><span><span style=color:#a6e22e>install</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	brew install poppler
</span></span><span style=display:flex><span>	poetry install
</span></span><span style=display:flex><span><span style=color:#a6e22e>run</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	poetry run streamlit run streamlit_pdf_uploader/main.py
</span></span></code></pre></div><h3 id=poetry-for-package-management>Poetry for package management</h3><p>環境構築は poetry を使っています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>poetry</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;streamlit-pdf-uploader&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>authors</span> = [<span style=color:#e6db74>&#34;&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>poetry</span>.<span style=color:#a6e22e>dependencies</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>python</span> = <span style=color:#e6db74>&#34;^3.8&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>streamlit</span> = <span style=color:#e6db74>&#34;^0.84.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>watchdog</span> = <span style=color:#e6db74>&#34;^2.1.3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>pdf2image</span> = <span style=color:#e6db74>&#34;^1.16.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>tool</span>.<span style=color:#a6e22e>poetry</span>.<span style=color:#a6e22e>dev-dependencies</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>pytest</span> = <span style=color:#e6db74>&#34;^5.2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>build-system</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>requires</span> = [<span style=color:#e6db74>&#34;poetry-core&gt;=1.0.0&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>build-backend</span> = <span style=color:#e6db74>&#34;poetry.core.masonry.api&#34;</span>
</span></span></code></pre></div><h3 id=streamlit-python-file>Streamlit Python file</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> tempfile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> streamlit <span style=color:#66d9ef>as</span> st
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pdf2image <span style=color:#f92672>import</span> convert_from_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pathlib <span style=color:#f92672>import</span> Path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show_pdf</span>(file_path:str):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Show the PDF in Streamlit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    That returns as html component
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ----------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    file_path : [str]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Uploaded PDF file path
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(file_path, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        base64_pdf <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64encode(f<span style=color:#f92672>.</span>read())<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#34;utf-8&#34;</span>)
</span></span><span style=display:flex><span>    pdf_display <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;&lt;embed src=&#34;data:application/pdf;base64,</span><span style=color:#e6db74>{</span>base64_pdf<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34; width=&#34;100%&#34; height=&#34;1000&#34; type=&#34;application/pdf&#34;&gt;&#39;</span>
</span></span><span style=display:flex><span>    st<span style=color:#f92672>.</span>markdown(pdf_display, unsafe_allow_html<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Streamlit application
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    st<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#34;PDF file uplodaer&#34;</span>)
</span></span><span style=display:flex><span>    uploaded_file <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>file_uploader(<span style=color:#e6db74>&#34;Choose your .pdf file&#34;</span>, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pdf&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> uploaded_file <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Make temp file path from uploaded file</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> tempfile<span style=color:#f92672>.</span>NamedTemporaryFile(delete<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>) <span style=color:#66d9ef>as</span> tmp_file:
</span></span><span style=display:flex><span>            st<span style=color:#f92672>.</span>markdown(<span style=color:#e6db74>&#34;## Original PDF file&#34;</span>)
</span></span><span style=display:flex><span>            fp <span style=color:#f92672>=</span> Path(tmp_file<span style=color:#f92672>.</span>name)
</span></span><span style=display:flex><span>            fp<span style=color:#f92672>.</span>write_bytes(uploaded_file<span style=color:#f92672>.</span>getvalue())
</span></span><span style=display:flex><span>            st<span style=color:#f92672>.</span>write(show_pdf(tmp_file<span style=color:#f92672>.</span>name))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            imgs <span style=color:#f92672>=</span> convert_from_path(tmp_file<span style=color:#f92672>.</span>name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            st<span style=color:#f92672>.</span>markdown(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Converted images from PDF&#34;</span>)
</span></span><span style=display:flex><span>            st<span style=color:#f92672>.</span>image(imgs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>これで、Streamlit 上でファイルをアップロードして、そのアップロードされたファイルに対する処理ができます。
画像や音声など色々応用先があるので便利そう。
動作が遅いという欠点はあれど、これだけ簡単に GUI を Python のみで構築できるのは驚き。
Protly Dash も 2 年ほど前に使ったことがあるけど、UI のライフサイクルや HTML を結構意識しないとかけなかったので辛かった記憶があるので、なおさら感動している。</p><h2 id=reference>Reference</h2><ul><li><a href=https://discuss.streamlit.io/t/showing-pdf-file-on-streamlitsharing-thats-in-github-directory/11955>Showing PDF file on StreamlitSharing that’s in github directory</a></li><li><a href=https://discuss.streamlit.io/t/problem-in-reading-a-db-object-using-file-uploader/3064/10>Problem in reading a “db” object using file uploader</a></li></ul></content><p><a href=https://shunyaueta.com/tags/python/>#python</a>
<a href=https://shunyaueta.com/tags/streamlit/>#streamlit</a></p><h2>関連しているかもしれない記事</h2><ul><li><a href=/posts/2021-05-23/>Poetry からsetup.py を自動生成する</a></li><li><a href=/posts/2021-05-19/>KyTeaをPythonで扱えるMykyteaを使うために必要なこと</a></li><li><a href=/posts/2021-04-29/>Pythonで変数を挿入してSQLクエリを柔軟に構築する</a></li><li><a href=/posts/2021-03-13/>pipenv のversion 2020.11.15 でローカルパッケージが正常にインストールされないときの対処法</a></li><li><a href=/posts/2021-02-08/>pip 実行時に sys.stderr.write(f"ERROR: {exc} ") とエラーが出てpipを実行できないときの対処方法</a></li></ul>---<br>このサイトの更新情報を<a href=/index.xml>RSS</a>で配信しています。お好きなフィードリーダーで購読してみてください。<br>👏このウェブサイトの運営を支援していただける方を募集しています。<br>もしよろしければ、<a href=https://www.buymeacoffee.com/hurutoriya>Buy Me a Coffee</a> からサポート(投げ銭)していただけると、著者の活動のモチベーションに繋がります✨<br>📮おたより<br>記事への感想の<a href="https://docs.google.com/forms/d/e/1FAIpQLScgZVDrjQiKLbQRovfs88oweCITzjtvt1PlgwL14JfWPOrpPQ/viewform?usp=pp_url&entry.838298670=https%3a%2f%2fshunyaueta.com%2fposts%2f2021-07-08%2f">おたより</a>をおまちしてます。
お気軽にお送りください。
お返事はメールアドレス入力があればメールでさせていただきます。
もちろんお返事を希望せずに単なる感想だけでも大歓迎です。</main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>