<!doctype html><html lang=ja><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>GKE ä¸Šã«ã¦ Pythonã§ logger.info() ã‚’è¡Œã†ã¨Cloud logging ã§ã¯ stderr ã«ä¿å­˜ã•ã‚Œã€ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å•é¡Œã¸ã®å¯¾å‡¦æ³• | Shunya Ueta</title><meta name=title content="GKE ä¸Šã«ã¦ Pythonã§ logger.info() ã‚’è¡Œã†ã¨Cloud logging ã§ã¯ stderr ã«ä¿å­˜ã•ã‚Œã€ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å•é¡Œã¸ã®å¯¾å‡¦æ³•"><meta name=description content="Python ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ Python Cloud Logging package ã‚’ä½¿ç”¨ã™ã‚‹ ä¸Šè¨˜ã®ï¼’ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
ä¸å¿…è¦ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¢—ã‚„ã—ãŸãã¯ãªã„ã®ã§ã€1 ã®æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Cloud Logger ã¸å‡ºåŠ›ã§ããªã„ã‹è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©¦ã™ æ¨™æº–ã® logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
import logging logger = logging.getLogger(__name__) def hoge(): logger.info('logging Start 2021') ã¨ã€logging.info() ã‚’ä»•è¾¼ã‚“ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ã¿ã‚‹ã¨ã€logger.info() ã§å‡ºã—ã¦ã„ã‚‹ã¯ãšãªã®ã«ã€Cloud logger ä¸Šã§ã¯ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€logger ã®ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã‚‹ã¨ logger.info() ãŒã™ã¹ã¦ stderræ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸å‡ºåŠ›ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
{ &#34;textPayload&#34;: &#34;2021-02-20 21:26:51,012 - root:predict:36 - INFO: logging Start\n&#34;, ... }, &#34;timestamp&#34;: &#34;2021-02-20T12:26:51.013213826Z&#34;, &#34;severity&#34;: &#34;ERROR&#34;, &#34;labels&#34;: { ... }, &#34;logName&#34;: &#34;projects/.../logs/stderr&#34;, &#34;receiveTimestamp&#34;: &#34;2021-02-20T12:26:55."><meta name=keywords content="gcp,"><meta property="og:title" content="GKE ä¸Šã«ã¦ Pythonã§ logger.info() ã‚’è¡Œã†ã¨Cloud logging ã§ã¯ stderr ã«ä¿å­˜ã•ã‚Œã€ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å•é¡Œã¸ã®å¯¾å‡¦æ³•"><meta property="og:description" content="Python ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ Python Cloud Logging package ã‚’ä½¿ç”¨ã™ã‚‹ ä¸Šè¨˜ã®ï¼’ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
ä¸å¿…è¦ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¢—ã‚„ã—ãŸãã¯ãªã„ã®ã§ã€1 ã®æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Cloud Logger ã¸å‡ºåŠ›ã§ããªã„ã‹è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©¦ã™ æ¨™æº–ã® logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
import logging logger = logging.getLogger(__name__) def hoge(): logger.info('logging Start 2021') ã¨ã€logging.info() ã‚’ä»•è¾¼ã‚“ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ã¿ã‚‹ã¨ã€logger.info() ã§å‡ºã—ã¦ã„ã‚‹ã¯ãšãªã®ã«ã€Cloud logger ä¸Šã§ã¯ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€logger ã®ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã‚‹ã¨ logger.info() ãŒã™ã¹ã¦ stderræ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸å‡ºåŠ›ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
{ &#34;textPayload&#34;: &#34;2021-02-20 21:26:51,012 - root:predict:36 - INFO: logging Start\n&#34;, ... }, &#34;timestamp&#34;: &#34;2021-02-20T12:26:51.013213826Z&#34;, &#34;severity&#34;: &#34;ERROR&#34;, &#34;labels&#34;: { ... }, &#34;logName&#34;: &#34;projects/.../logs/stderr&#34;, &#34;receiveTimestamp&#34;: &#34;2021-02-20T12:26:55."><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2021-03-03/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-03T00:29:03+09:00"><meta property="article:modified_time" content="2021-03-03T00:29:03+09:00"><meta property="og:site_name" content="Shunya Ueta"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="GKE ä¸Šã«ã¦ Pythonã§ logger.info() ã‚’è¡Œã†ã¨Cloud logging ã§ã¯ stderr ã«ä¿å­˜ã•ã‚Œã€ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å•é¡Œã¸ã®å¯¾å‡¦æ³•"><meta name=twitter:description content="Python ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ Python Cloud Logging package ã‚’ä½¿ç”¨ã™ã‚‹ ä¸Šè¨˜ã®ï¼’ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
ä¸å¿…è¦ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¢—ã‚„ã—ãŸãã¯ãªã„ã®ã§ã€1 ã®æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Cloud Logger ã¸å‡ºåŠ›ã§ããªã„ã‹è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©¦ã™ æ¨™æº–ã® logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
import logging logger = logging.getLogger(__name__) def hoge(): logger.info('logging Start 2021') ã¨ã€logging.info() ã‚’ä»•è¾¼ã‚“ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ã¿ã‚‹ã¨ã€logger.info() ã§å‡ºã—ã¦ã„ã‚‹ã¯ãšãªã®ã«ã€Cloud logger ä¸Šã§ã¯ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€logger ã®ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã‚‹ã¨ logger.info() ãŒã™ã¹ã¦ stderræ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸å‡ºåŠ›ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
{ &#34;textPayload&#34;: &#34;2021-02-20 21:26:51,012 - root:predict:36 - INFO: logging Start\n&#34;, ... }, &#34;timestamp&#34;: &#34;2021-02-20T12:26:51.013213826Z&#34;, &#34;severity&#34;: &#34;ERROR&#34;, &#34;labels&#34;: { ... }, &#34;logName&#34;: &#34;projects/.../logs/stderr&#34;, &#34;receiveTimestamp&#34;: &#34;2021-02-20T12:26:55."><meta itemprop=name content="GKE ä¸Šã«ã¦ Pythonã§ logger.info() ã‚’è¡Œã†ã¨Cloud logging ã§ã¯ stderr ã«ä¿å­˜ã•ã‚Œã€ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å•é¡Œã¸ã®å¯¾å‡¦æ³•"><meta itemprop=description content="Python ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ Python Cloud Logging package ã‚’ä½¿ç”¨ã™ã‚‹ ä¸Šè¨˜ã®ï¼’ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
ä¸å¿…è¦ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¢—ã‚„ã—ãŸãã¯ãªã„ã®ã§ã€1 ã®æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Cloud Logger ã¸å‡ºåŠ›ã§ããªã„ã‹è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©¦ã™ æ¨™æº–ã® logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«
import logging logger = logging.getLogger(__name__) def hoge(): logger.info('logging Start 2021') ã¨ã€logging.info() ã‚’ä»•è¾¼ã‚“ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ã¿ã‚‹ã¨ã€logger.info() ã§å‡ºã—ã¦ã„ã‚‹ã¯ãšãªã®ã«ã€Cloud logger ä¸Šã§ã¯ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€logger ã®ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã‚‹ã¨ logger.info() ãŒã™ã¹ã¦ stderræ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸å‡ºåŠ›ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
{ &#34;textPayload&#34;: &#34;2021-02-20 21:26:51,012 - root:predict:36 - INFO: logging Start\n&#34;, ... }, &#34;timestamp&#34;: &#34;2021-02-20T12:26:51.013213826Z&#34;, &#34;severity&#34;: &#34;ERROR&#34;, &#34;labels&#34;: { ... }, &#34;logName&#34;: &#34;projects/.../logs/stderr&#34;, &#34;receiveTimestamp&#34;: &#34;2021-02-20T12:26:55."><meta itemprop=datePublished content="2021-03-03T00:29:03+09:00"><meta itemprop=dateModified content="2021-03-03T00:29:03+09:00"><meta itemprop=wordCount content="228"><meta itemprop=image content="https://shunyaueta.com/ogp.jpg"><meta itemprop=keywords content="gcp,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-JMJRQJT0Q3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JMJRQJT0Q3")</script></head><body><header><a href=/ class=title><h2>Shunya Ueta</h2></a><nav><a href=/about/>è‘—è€…ã«ã¤ã„ã¦</a>
<a href=/index.xml>RSS</a></nav></header><main><h1>GKE ä¸Šã«ã¦ Pythonã§ logger.info() ã‚’è¡Œã†ã¨Cloud logging ã§ã¯ stderr ã«ä¿å­˜ã•ã‚Œã€ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å•é¡Œã¸ã®å¯¾å‡¦æ³•</h1><p><i><time datetime=2021-03-03 pubdate>2021-03-03</time></i></p><content><p>Python ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«</p><ol><li>æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹</li><li>Python Cloud Logging package ã‚’ä½¿ç”¨ã™ã‚‹</li></ol><p>ä¸Šè¨˜ã®ï¼’ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ä¸å¿…è¦ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¢—ã‚„ã—ãŸãã¯ãªã„ã®ã§ã€1 ã®æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Cloud Logger ã¸å‡ºåŠ›ã§ããªã„ã‹è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚</p><h2 id=æ¨™æº–ã®-python-logging-ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©¦ã™>æ¨™æº–ã® Python logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©¦ã™</h2><p>æ¨™æº–ã® logging ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hoge</span>():
</span></span><span style=display:flex><span>	logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#39;logging Start 2021&#39;</span>)
</span></span></code></pre></div><p>ã¨ã€logging.info() ã‚’ä»•è¾¼ã‚“ã§ã€Cloud logger ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ã¿ã‚‹ã¨ã€logger.info() ã§å‡ºã—ã¦ã„ã‚‹ã¯ãšãªã®ã«ã€Cloud logger ä¸Šã§ã¯ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚</p><p>åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€logger ã®ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã‚‹ã¨ logger.info() ãŒã™ã¹ã¦ <code>stderr</code>æ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸å‡ºåŠ›ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;textPayload&#34;</span>: <span style=color:#e6db74>&#34;2021-02-20 21:26:51,012 - root:predict:36 - INFO:  logging Start\n&#34;</span>,
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;timestamp&#34;</span>: <span style=color:#e6db74>&#34;2021-02-20T12:26:51.013213826Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;severity&#34;</span>: <span style=color:#e6db74>&#34;ERROR&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;labels&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;logName&#34;</span>: <span style=color:#e6db74>&#34;projects/.../logs/stderr&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;receiveTimestamp&#34;</span>: <span style=color:#e6db74>&#34;2021-02-20T12:26:55.050911180Z&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>ãã®ãŸã‚ã€æ˜ç¤ºçš„ã«æ¨™æº–å‡ºåŠ›ã¸å‡ºåŠ›å…ˆã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã—ãŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger(__name__)
</span></span><span style=display:flex><span>handler <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>StreamHandler(sys<span style=color:#f92672>.</span>stdout)
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>addHandler(handler)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hoge</span>():
</span></span><span style=display:flex><span>	logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#39;logging Start 2021&#39;</span>)
</span></span></code></pre></div><p>ã“ã‚Œã§è§£æ±ºã§ãã¦ã„ã‚‹ã¯ãšã¨ã€Cloud Logger ã‚’è¦‹ã¦ã¿ã‚‹ã¨</p><p><img src=/posts/2021-03-03/images/clooudlogging_stderr.png alt="Cloud logging duplicate log in stderr and stdout"></p><p>ãªãœã‹ã€<code>stderr</code> ã¸ã®å‡ºåŠ›ã¯æ®‹ã£ãŸã¾ã¾ã€<code>stdout</code>ã¸ã®å‡ºåŠ›ãŒæ–°ãŸã«å¢—ãˆã¾ã—ãŸã€‚ã“ã®ã¾ã¾ã§ã‚‚ INFO ãƒ¬ãƒ™ãƒ«ã§ãƒ­ã‚°ã¯æ®‹ã›ã¦ã„ã‚‹ã®ã§ç›®çš„ã¯é”æˆã§ãã¦ã„ã¾ã™ãŒã€<code>stderr</code>ã¸ã®å‡ºåŠ›ãŒæ®‹ã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã›ã„ã§ Cloud logger ä¸Šã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã‚ˆã†ã«ãªã‚Šå•é¡Œã§ã™ã€‚ãªã®ã§ã€ã“ã‚Œã‚’é¿ã‘ã‚‹ãŸã‚ã«ï¼’ã¤ç›®ã®æ–¹æ³•ã§ã‚ã‚‹ Python Cloud Logging package ã‚’åˆ©ç”¨ã—ã¦ã¿ã¾ã™ã€‚ (ã¨ã„ã†ã‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚€ã‚„ã¿ã«å¢—ã‚„ã—ãŸããªã„ã®ã ãŒåˆ©ç”¨ã›ã–ã‚‹ã‚’å¾—ãªã„ã€‚)</p><h2 id=python-cloud-logging-package-ã‚’ä½¿ç”¨ã™ã‚‹>Python Cloud Logging package ã‚’ä½¿ç”¨ã™ã‚‹</h2><p>ã¾ãš<a href=https://github.com/googleapis/python-logging>Python Client for Cloud Logging</a> ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã™ã™ã‚ã¦è¡Œãã¾ã™ã€‚</p><p>Cloud logging ã® Python package ã®<a href=https://github.com/googleapis/python-logging#quick-start>Quick Start</a> ã«ã¦ã‚ã‹ã‚Šã‚„ã™ãå°å…¥æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã“ã§æ··ä¹±ã—ã‚„ã™ã„ã®ãŒã€GCP ã®<a href=https://cloud.google.com/logging/docs/reference/libraries#cloud-console>Logging Client Libraries</a> ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã¾ãš Service Account ã‚’ä½œã£ã¦ã€<code>GOOGLE_APPLICATION_CREDENTIALS</code> ã‚’ä½¿ç”¨ã—ã¦ Cloud Logging ã®èªè¨¼ã‚’è¡Œã£ã¦ãã ã•ã„ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ã§ã™ãŒã€</p><ul><li><a href=https://googleapis.dev/python/google-api-core/latest/auth.html>GCP ä¸Šã§ã® VM ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ãªã‚‰èªè¨¼ã¯å¿…è¦ãªã„</a> ã€‚ãŸã ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® SA ã‚’ä½¿ã„ãŸããªã„å ´åˆã‚„ã€GCP å¤–ãªã©ã§å‹•ã‹ã—ãŸã„å ´åˆã¯ SA ãŒå¿…è¦</li></ul><p>ã¨æœ¬å…ƒã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯æ›¸ã‹ã‚Œã¦ãŠã‚Šã€ã“ã¡ã‚‰ã®ã»ã†ãŒèª¤è§£ãŒå°‘ãªãã¦ã„ã„ã§ã™ã­ã€‚(å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã ã¨ã€SA ä½œæˆæ™‚ã« <code>Project > Owner</code> ã‚’æŒ‡å®šã—ã‚ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚“ã ã‘ã©ã€ã“ã‚Œã£ã¦æ¨©é™éå¤šãªã®ã§ã¯ç„¡ã„ã®ã ã‚ã†ã‹??)</p><p>ã¡ãªã¿ã« GCP ä¸Šã®èªè¨¼éç¨‹ã¯ã“ã¡ã‚‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè©³ã—ãæ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€æ°—ã«ãªã£ãŸæ–¹ã¯å¾¡è¦§ãã ã•ã„ã€‚</p><p><a href=https://cloud.google.com/docs/authentication/production>Authenticating as a service account</a></p><p>ä¸Šè¨˜ã®èªè¨¼ä»®å®šã‚’ã¾ã¨ã‚ã‚‹ã¨</p><ol><li>GOOGLE_APPLICATION_CREDENTIALS ã‚’å‚ç…§ã™ã‚‹</li><li>ADC (Application Default Credentials) ãŒã€ã‚³ãƒ¼ãƒ‰ã«ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ SA ã‚’ä½¿ç”¨ã™ã‚‹</li><li>ADC ã¯å„ã‚µãƒ¼ãƒ“ã‚¹ã® SA ã‚’åˆ©ç”¨ã™ã‚‹</li><li>1-3 ãŒä½¿ç”¨ã§ããªã‹ã£ãŸå ´åˆã€èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹</li></ol><p>æœ€çµ‚çš„ã« GKE ä¸Šã§ Cloud logging ã¸ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã«ã¯ã€
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ç„¡äº‹ã« <code>INFO</code> ã®ãƒ­ã‚°ãŒ<code>stderr</code> ã«åãå‡ºã•ã‚Œã‚‹ã“ã¨ãªãã€<code>stdout</code> ã®ã¿ã«<code>INFO</code>ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#75715e># NOTE: GKE ã§ã¯CotainerEngineHandler ãŒå¿…è¦</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> google.cloud.logging.handlers <span style=color:#f92672>import</span> ContainerEngineHandler
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger(__name__)
</span></span><span style=display:flex><span><span style=color:#75715e># NOTE: stream ã§ stdout ã‚’æŒ‡å®šã™ã‚‹</span>
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>addHandler(ContainerEngineHandler(name<span style=color:#f92672>=</span>__name__, stream<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>stdout))
</span></span><span style=display:flex><span><span style=color:#75715e># NOTE: ãƒ­ã‚°ãŒé‡è¤‡ã—ã¦å‡ºåŠ›ã•ã‚Œã‚‹ã®ã§ã€propagate ã‚’åˆ‡ã‚‹</span>
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>propagate <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#39;Hello Cloud Logging.&#39;</span>)
</span></span></code></pre></div><h2 id=appendix>Appendix</h2><ul><li><a href=https://docs.python.org/3/howto/logging.html>https://docs.python.org/3/howto/logging.html</a></li><li><a href=https://cloud.google.com/logging/docs/setup/python>https://cloud.google.com/logging/docs/setup/python</a></li><li><a href=https://www.ai-shift.co.jp/techblog/1217>https://www.ai-shift.co.jp/techblog/1217</a></li><li><a href=https://stackoverflow.com/questions/48078051/duplicate-log-entries-with-google-cloud-stackdriver-logging-of-python-code-on-ku>https://stackoverflow.com/questions/48078051/duplicate-log-entries-with-google-cloud-stackdriver-logging-of-python-code-on-ku</a><ul><li>åŒã˜ã‚ˆã†ãªè³ªå•ãŒã‚ã£ãŸ</li></ul></li></ul></content>---<p>é–¢é€£ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„è¨˜äº‹</p><ul><li><a href=/posts/2019-10-03/>é…ã™ãã‚‹ `pandas.read_gbq` ã‚’ä½¿ã‚ãšã«ã€Google BigQueryã‹ã‚‰é«˜é€Ÿã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€</a></li><li><a href=/posts/2019-09-24/>How to connect the Google Compute Engine via Visual Studio Code</a></li></ul><br>ğŸ“® ğŸ“§ ğŸ: è¨˜äº‹ã¸ã®<a href="https://docs.google.com/forms/d/e/1FAIpQLScgZVDrjQiKLbQRovfs88oweCITzjtvt1PlgwL14JfWPOrpPQ/viewform?usp=pp_url&entry.838298670=https%3a%2f%2fshunyaueta.com%2fposts%2f2021-03-03%2f">æ„Ÿæƒ³</a>ã®ãŠãŸã‚ˆã‚Šã‚’ãŠã¾ã¡ã—ã¦ã¾ã™ã€‚
ãŠæ°—è»½ã«ãŠé€ã‚Šãã ã•ã„ã€‚
ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›ãŒã‚ã‚Œã°ãƒ¡ãƒ¼ãƒ«ã§è¿”ä¿¡ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
ã‚‚ã¡ã‚ã‚“ãŠè¿”äº‹ã‚’å¸Œæœ›ã›ãšã«å˜ãªã‚‹æ„Ÿæƒ³ã ã‘ã§ã‚‚å¤§æ­“è¿ã§ã™ã€‚<br><br>ã“ã®ã‚µã‚¤ãƒˆã®æ›´æ–°æƒ…å ±ã‚’<a href=/index.xml>RSS</a>ã§é…ä¿¡ã—ã¦ã„ã¾ã™ã€‚
ãŠå¥½ããªãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è³¼èª­ã—ã¦ã¿ã¦ãã ã•ã„ã€‚<br><br>ã“ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®é‹å–¶ã‚„è‘—è€…ã®æ´»å‹•ã‚’æ”¯æ´ã—ã¦ã„ãŸã ã‘ã‚‹æ–¹ã‚’å‹Ÿé›†ã—ã¦ã„ã¾ã™ã€‚
ã‚‚ã—ã‚ˆã‚ã—ã‘ã‚Œã°ã€<a href=https://www.buymeacoffee.com/hurutoriya>Buy Me a Coffee</a> ã‹ã‚‰ã‚µãƒãƒ¼ãƒˆ(æŠ•ã’éŠ­)ã—ã¦ã„ãŸã ã‘ã‚‹ã¨ã€è‘—è€…ã®æ´»å‹•ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã«ç¹‹ãŒã‚Šã¾ã™âœ¨<br><br><p><a href=https://shunyaueta.com/tags/gcp/>#gcp</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a></footer></body></html>