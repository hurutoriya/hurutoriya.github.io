<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="faiss : Billion-scale similarity search with GPUs
faiss : Billion-scale similarity search with GPUs
You mainly follow : https://github.com/facebookresearch/faiss/blob/master/INSTALL.md
Env : Mac OS X 10.12.6
Not Tag, Note commit hash:commit cd884114d0a8e1789f257b524e5345bc5b26e6b2 ``_2018.02.24 : New version of Faiss!
What's new?
 Support for on-disk inverted lists (see https://github.com/…/f…/blob/master/demos/demo_ondisk_ivf.py). Enables handling of datasets that do not fit in RAM. We tested it on up to 53B vectors, with a 2TB index. Tutorial and examples for using Faiss on one or more GPUs (see https://github."><meta name=theme-color content="#d3381c"><meta property="og:title" content="How to install faiss • Software Engineer as Data Scientist"><meta property="og:description" content="faiss : Billion-scale similarity search with GPUs
faiss : Billion-scale similarity search with GPUs
You mainly follow : https://github.com/facebookresearch/faiss/blob/master/INSTALL.md
Env : Mac OS X 10.12.6
Not Tag, Note commit hash:commit cd884114d0a8e1789f257b524e5345bc5b26e6b2 ``_2018.02.24 : New version of Faiss!
What's new?
 Support for on-disk inverted lists (see https://github.com/…/f…/blob/master/demos/demo_ondisk_ivf.py). Enables handling of datasets that do not fit in RAM. We tested it on up to 53B vectors, with a 2TB index. Tutorial and examples for using Faiss on one or more GPUs (see https://github."><meta property="og:url" content="https://shunyaueta.com/posts/2018-02-27_how-to-install-faiss/"><meta property="og:site_name" content="Software Engineer as Data Scientist"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="Python"><meta property="article:published_time" content="2018-02-27T05:50:27Z"><meta property="article:modified_time" content="2019-06-16T18:17:55+09:00"><meta name=twitter:card content="summary"><meta name=twitter:site content="@hurutoriya"><meta name=generator content="Hugo 0.67.1"><title>How to install faiss • Software Engineer as Data Scientist</title><link rel=canonical href=https://shunyaueta.com/posts/2018-02-27_how-to-install-faiss/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:#d3381c}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-39994406-11','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="page type-posts"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Software Engineer as Data Scientist</a></li><li><a href=/posts/>Posts</a></li><li><span>How to install faiss</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Software Engineer as Data Scientist</p><p class="desc site-desc">Enjoy Software Engineering & Data Science!!</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>How to install faiss</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2018-02-27T05:50:27Z>2018.02.27</time></span>
<span class=reading-time><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>faiss : Billion-scale similarity search with GPUs</p><p><img src=/posts/2018-02-27_how-to-install-faiss/images/1.png alt=image></p><p>faiss : Billion-scale similarity search with GPUs</p><p>You mainly follow : <a href=https://github.com/facebookresearch/faiss/blob/master/INSTALL.md>https://github.com/facebookresearch/faiss/blob/master/INSTALL.md</a></p><p>Env : <code>Mac OS X 10.12.6</code><br>Not Tag, Note commit hash:<code>commit cd884114d0a8e1789f257b524e5345bc5b26e6b2</code>
``_2018.02.24 : New version of Faiss!<br>What's new?</p><ul><li>Support for on-disk inverted lists (see <a href=https://github.com/>https://github.com/</a>…/f…/blob/master/demos/demo_ondisk_ivf.py). Enables handling of datasets that do not fit in RAM. We tested it on up to 53B vectors, with a 2TB index.</li><li>Tutorial and examples for using Faiss on one or more GPUs (see <a href=https://github.com/facebookresea>https://github.com/facebookresea</a>…/faiss/wiki/Running-on-GPUs).</li><li>Macports package (math/libfaiss) - more packages soon.</li><li>Minor bug fixes._``</li></ul><p>Let’s start.
<code>$ git clone https://github.com/facebookresearch/faiss.git $ cd faiss $ mv example_makefiles/makefile.inc.Mac.brew ./makefile.inc</code></p><h3 id=compile-c-faiss>Compile C++ faiss</h3><ul><li>Firstly you install BLAS and LAPACK. : <a href=https://pheiter.wordpress.com/2012/09/04/howto-installing-lapack-and-blas-on-mac-os/>Install BLAS,LAPACK</a><code>$ `brew install llvm `$ brew install gcc $ make tests/test_blas /usr/local/opt/llvm/bin/clang++ -fPIC -m64 -Wall -g -O3 -msse4 -mpopcnt -fopenmp -Wno-sign-compare -I/usr/local/opt/llvm/include -std=c++11 tests/test_blas.cpp -o tests/test_blas -g -fPIC -fopenmp -L/usr/local/opt/llvm/lib -L/usr/local/Cellar/llvm/5.0.1/lib -framework Accelerate -DFINTEGER=int````$ ./tests/test_blas BLAS test errors= 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 -0.000 -0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 -0.000 0.000 0.000 -0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 -0.000 -0.000 0.000 0.000 0.000 -0.000 -0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 -0.000 -0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 -0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 -0.000 -0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 -0.000 0.000 0.000 0.000 0.000 0.000 0.000 -0.000 0.000 0.000 0.000 -0.000 0.000 0.000 -0.000 -0.000 0.000 -0.000 0.000 -0.000 0.000 0.000 -0.000 Intentional Lapack error (appears only for 64-bit INTEGER): info=0000064b00000000 Lapack uses 32-bit integers</code></li></ul><p>This is not error. : <a href=https://github.com/facebookresearch/faiss/issues/101>link</a>
``$ make<br>/usr/local/opt/llvm/bin/clang++ -fPIC -m64 -Wall -g -O3 -msse4 -mpopcnt -fopenmp -Wno-sign-compare -I/usr/local/opt/llvm/include -std=c++11 -c hamming.cpp -o hamming.o<code>...</code>IndexScalarQuantizer.cpp -o IndexScalarQuantizer.o<br>IndexScalarQuantizer.cpp:14:10: fatal error: 'malloc.h' file not found</p><h1 id=include-ltmallochgt>include &lt;malloc.h></h1><pre><code>     ^~~~~~~~~~
</code></pre><p>1 error generated.<br>make: *** [IndexScalarQuantizer.o] Error 1``</p><p><code>IndexScalarQuantizer.cpp</code>
<code># include &amp;lt;malloc.h&amp;gt;</code></p><p>↓
<code># include &amp;lt;sys/malloc.h&amp;gt;</code></p><p>Ref (<a href=https://tbr8.org/install-faiss-on-mac-os/>https://tbr8.org/install-faiss-on-mac-os/</a>)
<code>$ make /usr/local/opt/llvm/bin/clang++ -fPIC -m64 -Wall -g -O3 -msse4 -mpopcnt -fopenmp -Wno-sign-compare -I/usr/local/opt/llvm/include -std=c++11 -c IndexScalarQuantizer.cpp -o IndexScalarQuantizer.o````...````ar: creating archive libfaiss.a /usr/local/opt/llvm/bin/clang++ -o demos/demo_ivfpq_indexing -fPIC -m64 -Wall -g -O3 -msse4 -mpopcnt -fopenmp -Wno-sign-compare -I/usr/local/opt/llvm/include -std=c++11 demos/demo_ivfpq_indexing.cpp libfaiss.a -g -fPIC -fopenmp -L/usr/local/opt/llvm/lib -L/usr/local/Cellar/llvm/5.0.1/lib -framework Accelerate````$ demos/demo_ivfpq_indexing [0.000 s] Generating 100000 vectors in 128D for training [0.165 s] Training the index Training level-1 quantizer Training level-1 quantizer on 100000 vectors in 128D Training IVF residual Input training set too big (max size is 65536), sampling 65536 / 100000 vectors computing residuals training 4x256 product quantizer on 65536 vectors in 128D Training PQ slice 0/4 Clustering 65536 points in 32D to 256 clusters, redo 1 times, 25 iterations Preprocessing in 0.01 s Iteration 24 (0.87 s, search 0.84 s): objective=113241 imbalance=1.004 nsplit=0 Training PQ slice 1/4 Clustering 65536 points in 32D to 256 clusters, redo 1 times, 25 iterations Preprocessing in 0.01 s Iteration 24 (0.84 s, search 0.81 s): objective=113353 imbalance=1.004 nsplit=0 Training PQ slice 2/4 Clustering 65536 points in 32D to 256 clusters, redo 1 times, 25 iterations Preprocessing in 0.01 s Iteration 24 (0.82 s, search 0.79 s): objective=113274 imbalance=1.004 nsplit=0 Training PQ slice 3/4 Clustering 65536 points in 32D to 256 clusters, redo 1 times, 25 iterations Preprocessing in 0.01 s Iteration 24 (0.88 s, search 0.86 s): objective=113141 imbalance=1.004 nsplit=0 precomputing IVFPQ tables type 1 [8.453 s] storing the pre-trained index to /tmp/index_trained.faissindex [8.456 s] Building a dataset of 200000 vectors to index [8.818 s] Adding the vectors to the index IndexIVFPQ::add_core_o: adding 0:32768 / 200000 add_core times: 157.094 111.340 4.048 IndexIVFPQ::add_core_o: adding 32768:65536 / 200000 add_core times: 161.185 104.820 2.199 IndexIVFPQ::add_core_o: adding 65536:98304 / 200000 add_core times: 156.851 105.808 2.865 IndexIVFPQ::add_core_o: adding 98304:131072 / 200000 add_core times: 163.588 113.381 2.311 IndexIVFPQ::add_core_o: adding 131072:163840 / 200000 add_core times: 195.370 110.669 2.505 IndexIVFPQ::add_core_o: adding 163840:196608 / 200000 add_core times: 155.380 106.777 2.499 IndexIVFPQ::add_core_o: adding 196608:200000 / 200000 add_core times: 18.895 11.918 0.296 [10.518 s] imbalance factor: 1.23721 [10.532 s] Searching the 5 nearest neighbors of 9 vectors in the index [10.533 s] Query results (vector ids, then distances): query 0: 1234 196783 151072 184097 59404 dis: 7.59448 8.73569 9.32671 9.40073 9.8221 query 1: 1235 143169 153018 103432 14870 dis: 6.70634 8.11071 8.82516 9.40931 9.43434 query 2: 1236 75075 188719 85363 10999 dis: 6.89075 9.39095 9.82474 9.92888 10.0297 query 3: 1237 16172 134049 105294 169581 dis: 8.32598 11.3405 11.4758 11.6785 11.7097 query 4: 1238 88419 108591 54396 52208 dis: 8.34287 10.4571 10.4597 11.1477 11.6777 query 5: 1239 43646 195506 35780 113330 dis: 7.46891 9.0416 9.65232 9.82861 9.84448 query 6: 1240 160333 170467 71739 61290 dis: 6.86489 9.4142 9.74915 9.81607 9.85242 query 7: 1241 115632 122785 168251 173845 dis: 6.05343 8.749 8.90397 9.01914 9.07404 query 8: 1242 78102 179175 37071 89957 dis: 7.46019 9.95651 10.0036 10.0071 10.1378 note that the nearest neighbor is not at distance 0 due to quantization errors</code></p><h3 id=python-interface>Python Interface</h3><p><code>$ make py /usr/local/opt/llvm/bin/clang++ -I. -fPIC -m64 -Wall -g -O3 -msse4 -mpopcnt -fopenmp -Wno-sign-compare -I/usr/local/opt/llvm/include -std=c++11 -g -fPIC -fopenmp -L/usr/local/opt/llvm/lib -L/usr/local/Cellar/llvm/5.0.1/lib -I/System/Library/Frameworks/Python.framework/Versions/2.7/include/python2.7 -I/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/numpy/core/include -Wl,-F. -bundle -undefined dynamic_lookup \ -o python/_swigfaiss.so python/swigfaiss_wrap.cxx libfaiss.a -framework Accelerate In file included from python/swigfaiss_wrap.cxx:3241: ./IndexHNSW.h:215:1: warning: &amp;#39;IndexHNSW&amp;#39; defined as a struct here but previously declared as a class [-Wmismatched-tags] struct IndexHNSW: Index { ^ ./IndexHNSW.h:169:1: note: did you mean struct here? class IndexHNSW; ^~~~~ struct 1 warning generated. cp python/_swigfaiss.so python/swigfaiss.py .````$ python -c &amp;#34;import faiss&amp;#34; Failed to load GPU Faiss: No module named swigfaiss_gpu Faiss falling back to CPU-only.</code></p><p>Done!### LAPACK, BLAS ver.</p><ul><li><a href=http://www.netlib.org/lapack/>http://www.netlib.org/lapack/</a></li><li>Download: lapack-3.8.0.tar.gz</li><li><a href=http://www.netlib.org/blas/>http://www.netlib.org/blas/</a></li><li>Download blas-3.8.0.tgz</li></ul><h3 id=next>Next.</h3><p>Switch to wrapper of <em>Python3…</em></p></div><footer class=entry-footer><div class="container sep-before"><div class=last-updated><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20 14.66V20a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2h5.34" /><polygon points="18 2 22 6 12 16 8 16 8 12 18 2" /></svg><span class=screen-reader-text>Last updated:</span>
<time class=entry-date datetime=2019-06-16T18:17:55+09:00>2019.06.16</time></div><div class=tags><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/python/>Python</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before"><a href=/posts/2018-02-13_%E3%83%A1%E3%83%AB%E3%82%AB%E3%83%AA%E3%81%AEteam-ai-meetup-sharp1-%E3%81%AB%E5%8F%82%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%8D%E3%81%9F-sharpmercariai/><span aria-hidden=true><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>メルカリのTeam AI Meetup #1 に参加してきた #mercari_ai</a></div><div class="next-entry sep-before"><a href=/posts/2018-03-25_coursera%E3%81%AEmachine-learning%E3%82%92%E4%BF%AE%E4%BA%86%E3%81%97%E3%81%9F/><span class=screen-reader-text>Next post: </span>Courseraの”Machine Learning”を修了した<span aria-hidden=true>Next<svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav><section id=comments class=comments><div class="container sep-before"><div class=comments-area><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"hurutoriya"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></section></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-about sep-after"><header><h2 class="title site-title"><a href=/>Shunya UETA</a></h2><div class=desc>Shunya UETA who is a working on Machine Leraning as Software Engineer at <a href=https://about.mercari.com/en/>Mercari, inc</a>. Opinions are my own. → <a href=/about>See more detail!</a></div></header></section><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/hurutoriya target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://facebook.com/shunyaueta target=_blank rel=noopener><span class=screen-reader-text>Open Facebook account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></a></li><li><a href=https://twitter.com/hurutoriya target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=https://linkedin.com/in/hurutoriya target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2013-2020 Shunya UETA</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script src=/js/custom.js></script></body></html>