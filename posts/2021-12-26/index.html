<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Amazon検索ランキングの奥深さ at MLconf SF 2016 | 🦅 hurutoriya</title><meta name=keywords content="search,machinelearning,amazon,translation"><meta name=description content="1 日遅れてしまいましたが、情報検索・検索技術 Advent Calendar 2021 25 日目の記事です。
ついにアドベントカレンダー最終日を迎えました! 今年はまだ検索領域のアドベントカレンダーが作られていないからということで、勢いで情報検索・検索技術 Advent Calendar 2021を作りましたが、多くの方に投稿に協力していただきありがとうございました。
社内勉強会の発表でネタを探しており、2016 年と少し昔の情報ですが、Amazon の製品検索において、どのようにランキングを行っているかの公演動画が非常に面白かったので、勉強がてら残したメモを記事として公開します。
今回の口頭発表は MLconf という開発者会議(非学会・非アカデミック)で発表されています。 自分が知る限り、MLconf は機械学習黎明期から高品質な発表が継続されて発信されており、非常に素晴らしいカンファレンスの一つ。 国際会議には投稿されていないが、実応用の観点からしてとても学びの多い発表がとても多いです。 機械学習の応用を考えている場合、世界の最先端事例を知ることができるので非常におすすめです。
 Referemces  Sorokina, D., & Cantu-Paz, E. (2016, July). Amazon search: The joy of ranking products. In Proceedings of the 39th International ACM SIGIR conference on Research and Development in Information Retrieval (pp. 459-460).
  Amazon Search: The joy of ranking products in amazon science Youtube  メモ 自分の私的な意見は NOTE: で書いておきます。"><meta name=author content="Shunya Ueta"><link rel=canonical href=https://shunyaueta.com/posts/2021-12-26/><link crossorigin=anonymous href=/assets/css/stylesheet.abc7c82c3d415a6df50430738d1cbcc4c76fea558bc5a0c830d3babf78167a35.css integrity="sha256-q8fILD1BWm31BDBzjRy8xMdv6lWLxaDIMNO6v3gWejU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://shunyaueta.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shunyaueta.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shunyaueta.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shunyaueta.com/apple-touch-icon.png><link rel=mask-icon href=https://shunyaueta.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-39994406-11','auto');ga('send','pageview');}</script><meta property="og:title" content="Amazon検索ランキングの奥深さ at MLconf SF 2016"><meta property="og:description" content="1 日遅れてしまいましたが、情報検索・検索技術 Advent Calendar 2021 25 日目の記事です。
ついにアドベントカレンダー最終日を迎えました! 今年はまだ検索領域のアドベントカレンダーが作られていないからということで、勢いで情報検索・検索技術 Advent Calendar 2021を作りましたが、多くの方に投稿に協力していただきありがとうございました。
社内勉強会の発表でネタを探しており、2016 年と少し昔の情報ですが、Amazon の製品検索において、どのようにランキングを行っているかの公演動画が非常に面白かったので、勉強がてら残したメモを記事として公開します。
今回の口頭発表は MLconf という開発者会議(非学会・非アカデミック)で発表されています。 自分が知る限り、MLconf は機械学習黎明期から高品質な発表が継続されて発信されており、非常に素晴らしいカンファレンスの一つ。 国際会議には投稿されていないが、実応用の観点からしてとても学びの多い発表がとても多いです。 機械学習の応用を考えている場合、世界の最先端事例を知ることができるので非常におすすめです。
 Referemces  Sorokina, D., & Cantu-Paz, E. (2016, July). Amazon search: The joy of ranking products. In Proceedings of the 39th International ACM SIGIR conference on Research and Development in Information Retrieval (pp. 459-460).
  Amazon Search: The joy of ranking products in amazon science Youtube  メモ 自分の私的な意見は NOTE: で書いておきます。"><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2021-12-26/"><meta property="og:image" content="https://shunyaueta.com/posts/2021-12-26/images/1.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-26T22:52:06+09:00"><meta property="article:modified_time" content="2022-09-01T21:49:58+09:00"><meta property="og:site_name" content="Shunya Ueta"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/posts/2021-12-26/images/1.png"><meta name=twitter:title content="Amazon検索ランキングの奥深さ at MLconf SF 2016"><meta name=twitter:description content="1 日遅れてしまいましたが、情報検索・検索技術 Advent Calendar 2021 25 日目の記事です。
ついにアドベントカレンダー最終日を迎えました! 今年はまだ検索領域のアドベントカレンダーが作られていないからということで、勢いで情報検索・検索技術 Advent Calendar 2021を作りましたが、多くの方に投稿に協力していただきありがとうございました。
社内勉強会の発表でネタを探しており、2016 年と少し昔の情報ですが、Amazon の製品検索において、どのようにランキングを行っているかの公演動画が非常に面白かったので、勉強がてら残したメモを記事として公開します。
今回の口頭発表は MLconf という開発者会議(非学会・非アカデミック)で発表されています。 自分が知る限り、MLconf は機械学習黎明期から高品質な発表が継続されて発信されており、非常に素晴らしいカンファレンスの一つ。 国際会議には投稿されていないが、実応用の観点からしてとても学びの多い発表がとても多いです。 機械学習の応用を考えている場合、世界の最先端事例を知ることができるので非常におすすめです。
 Referemces  Sorokina, D., & Cantu-Paz, E. (2016, July). Amazon search: The joy of ranking products. In Proceedings of the 39th International ACM SIGIR conference on Research and Development in Information Retrieval (pp. 459-460).
  Amazon Search: The joy of ranking products in amazon science Youtube  メモ 自分の私的な意見は NOTE: で書いておきます。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Amazon検索ランキングの奥深さ at MLconf SF 2016","item":"https://shunyaueta.com/posts/2021-12-26/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Amazon検索ランキングの奥深さ at MLconf SF 2016","name":"Amazon検索ランキングの奥深さ at MLconf SF 2016","description":"1 日遅れてしまいましたが、情報検索・検索技術 Advent Calendar 2021 25 日目の記事です。\nついにアドベントカレンダー最終日を迎えました! 今年はまだ検索領域のアドベントカレンダーが作られていないからということで、勢いで情報検索・検索技術 Advent Calendar 2021を作りましたが、多くの方に投稿に協力していただきありがとうございました。\n社内勉強会の発表でネタを探しており、2016 年と少し昔の情報ですが、Amazon の製品検索において、どのようにランキングを行っているかの公演動画が非常に面白かったので、勉強がてら残したメモを記事として公開します。\n今回の口頭発表は MLconf という開発者会議(非学会・非アカデミック)で発表されています。 自分が知る限り、MLconf は機械学習黎明期から高品質な発表が継続されて発信されており、非常に素晴らしいカンファレンスの一つ。 国際会議には投稿されていないが、実応用の観点からしてとても学びの多い発表がとても多いです。 機械学習の応用を考えている場合、世界の最先端事例を知ることができるので非常におすすめです。\n Referemces  Sorokina, D., \u0026amp; Cantu-Paz, E. (2016, July). Amazon search: The joy of ranking products. In Proceedings of the 39th International ACM SIGIR conference on Research and Development in Information Retrieval (pp. 459-460).\n  Amazon Search: The joy of ranking products in amazon science Youtube  メモ 自分の私的な意見は NOTE: で書いておきます。","keywords":["search","machinelearning","amazon","translation"],"articleBody":"1 日遅れてしまいましたが、情報検索・検索技術 Advent Calendar 2021 25 日目の記事です。\nついにアドベントカレンダー最終日を迎えました! 今年はまだ検索領域のアドベントカレンダーが作られていないからということで、勢いで情報検索・検索技術 Advent Calendar 2021を作りましたが、多くの方に投稿に協力していただきありがとうございました。\n社内勉強会の発表でネタを探しており、2016 年と少し昔の情報ですが、Amazon の製品検索において、どのようにランキングを行っているかの公演動画が非常に面白かったので、勉強がてら残したメモを記事として公開します。\n今回の口頭発表は MLconf という開発者会議(非学会・非アカデミック)で発表されています。 自分が知る限り、MLconf は機械学習黎明期から高品質な発表が継続されて発信されており、非常に素晴らしいカンファレンスの一つ。 国際会議には投稿されていないが、実応用の観点からしてとても学びの多い発表がとても多いです。 機械学習の応用を考えている場合、世界の最先端事例を知ることができるので非常におすすめです。\n Referemces  Sorokina, D., \u0026 Cantu-Paz, E. (2016, July). Amazon search: The joy of ranking products. In Proceedings of the 39th International ACM SIGIR conference on Research and Development in Information Retrieval (pp. 459-460).\n  Amazon Search: The joy of ranking products in amazon science Youtube  メモ 自分の私的な意見は NOTE: で書いておきます。\nSearch Ranking Models  1Model = 1 context: 一つのモデルで一つの国の 1 カテゴリをサポート  日本の書籍カテゴリで 1 モデル、フランスの家電領域で更に一つのモデル モデルの軽量化と精度向上のためにコンテキストごとの最適化されたモデル作成を許している   現在、100 以上の機械学習モデルを利用している  GBDT ベースのモデルや、pairwise ランキングモデルなど モデルはだいたい 200 以上の tree で構成されている   150 種類以上の特徴量が利用可能だが、それぞれのモデルが利用しているのは 30 以下  映画では、days_since_release がとても重要だが、他のカテゴリではそうではない    Training Labels  学習データを顧客の行動ログから作成する 利用可能なポジティブラベルとして  クリックされたか? カートに入れられたか? 購入されたか? 消費されたか?   ネガティブなラベルとしては  無視された結果  検索結果には表示されたが、何も行動が起こされていない製品   検索結果から、そもそも表示されなかったページからランダムサンプリング  ページネーションにより表示されなかったページからサンプリングを行う(slide が消えていて見えなかったので論文から補足)。  NOTE: アルゴリズムバイアスを加速させるような気もした。表示されなかったが良い商品をどうやって救い出すかも大事な観点。        Mixing Click and Purchase Targets  何を目的変数とすべきか? クリックなのか、それとも購入か?  おそらく購入されたかどうかでしょう、なぜなら我々の最終目標は製品を売ることなので しかし、いつでも購入がゴールというわけではない… 例をお見せします   Keyword: iPhone  最もクリックされたもの  iPhone7。700 ドル以上もするのでクリックはされますが購入されません   最も購入されたもの  一番購入されたものは何でしょうか? 最安価な iPhone モデルでしょうか? 正解は… 8 ドルの Lightning to USB Cable です…!   もし購入されたことのみを目的変数にしてしまった場合、iPhone と検索して Lightning Cable しか表示されなくなり、検索機能が壊れてしまいます。     これがクリックと購入を混在させたモデルの検索結果になります  iPhone 5S は iPhone モデルシリーズで最も安く最も購入され、その後に 最もクリックされる iPhone7 その後に Lightning Cable が表示されています これによって、異なる顧客の意図を汲み取った検索結果を提供できるようになりました    Fast Feature Evaluation  2 段階の特徴量選択    150→50: ランダムな特徴集合よりも良い結果を出した特徴を選択    50→20: 後方除去、前方選択により枝刈り     ツリーのアンサンブルにおける特徴量のスコアリング  全てのツリーは特徴量のスコアリングアルゴリズムを持っている 課題点として 2 値と連続値の特徴量は比較ができない   is_prime_benefit は Amazon Video で最も重要な特徴量である  しかし、特徴量選択では、いつもランダムな連続値の特徴量にスコアは低くなっている。何故?   アンサンブルツリーはランダムな分割を多く実行する  単一のツリーの分散は最終段階では平均化される   連続値の特徴量は更に可能な分割を提供する  よって、ランダムな分割で多く選ばれる それによりスコアリングが高くなる   それらを避けるには正規化の処理が重要になる 異なる一様分布の値から 6 つのランダムな特徴量を作成・追加を行い、ビデオ領域で実験を行った  本来なら全ては意味のない特徴量なので、全ては同一の低いスコアリングがされるべきである     しかし実験の結果、乱数の値に伴って対数的にスコアリングが変化していることがわかった 正規化された特徴量スコアでのバギングツリーを我々は利用している  上記の手法は OSS として公開しています  https://github.com/dariasor/TreeExtra     上記の手法を適用後、スコアリングが最も高くなったのは is_prime_benefit 特徴量になりました All Product Search green と検索を行うと以下の結果が出てくる  Components of the Blending Score  Fashion, Home\u0026Kichen, Health カテゴリの商品が出てきます。どのように各カテゴリのスコアを計算しているのか? Query Category score  一般的なクエリ: クリック数、カートに追加したか、購入したか? 稀なクエリ: クエリの trigrams , bigrams, unigrams でのクリック数   Hunger score: 飢えのスコア(動的なスコア)  重要なカテゴリはこの Hunger Score が高くなりやすく設定 他のカテゴリが選択されるたび Hunger Score が高くなり、それがカテゴリ選出のスコアリングでは重要になる   In-category relevance score for each product  relevency が高い製品は選ばれやすくなる このスコアは異なるカテゴリ間でも比較可能なものにしなければならない   All Product Search - Blending green というキーワードに対しての Blending Score の具体例  Fashion, Kitchen, Books カテゴリの中からどのように各カテゴリの商品が選出されるか? 各カテゴリの Query Score は、Fashion, Kitchen, Books の順番に高い 初期の全ての Hunger score は 0。白 → 灰色 → 黒と Hunger score が高くなる    まずはじめに、各カテゴリの Top1 製品の F1, K1, B1 を比較して、F1 が QueryScore に基づき最もスコアが高い F1 が選出される。    Fashion が選択されたので、Kitchen と Books の Hunger Score が高くなり、Hunger Score がより高い K1 が選出    Fashion カテゴリは重要なので Hunger Score がより早く高くなりやすい。Query Score と合わせて、三番目には F2 が選出    Books カテゴリの Hunger Score がとても高くなっているので、ついに B1 が 4 番目には選出される    上記の考えで各カテゴリ間でスコアを比較して検索結果に混ぜていく    Match Set  Match set は、クエリに対して返された結果の集合 Match set は 2 つのパターンの製品を含む  例: zootopia というクエリで、70538 個の mache set が返ってきた   Textual matches   クエリに対して、Query understanding 後に Product description とマッチした製品     Behavioral matches   そのクエリで検索後に、クリック、カートに追加、購入した商品の集合 今回の場合は、zootopia で検索後にクリック、カートに追加、購入した製品を指す。  どのように非 text-match が発生するか    zootopia で検索       その後クリックはせずに、inside outで検索を行い製品をクリック       この 1-2 を同一セッションとして Behaivioral feature として扱う       3 の特徴量を取り入れることで、非 text-match の製品を match set に取り込む             Cold Start  新しい Harry Porrer の書籍が利用可能になります!  私達はこの書籍がベストセラーになることを知っていますが…   Behaivioral feature がまだ存在しない  どれくらいクリックされるかは我々は知らない   古い書籍は多くの signal を持っているので、新しい書籍は下のランクに位置づけられる   求めている書籍が検索結果の下にあるのは顧客は不幸です。 Business チームもこの異常事態を伝えてきます ジョークですが、非公式の指標として、「今すぐこれを直してください」の要求の数が低ければ低いほどよいです   Day 0: 全ての behaivioral features は 0  時間特徴量がここでは助けになる(新製品にたいして Boost を行い、ランクを上にする) ここで顧客が製品に対してクリックを行い、signal が溜まっていきます   Day 1: Behaivioral features はまだ更新されていない  クリック情報を持っているが、検索エンジンにはまだ反映されていない 強靭なインフラが、新製品に対して signal の蓄積を迅速に反映させていく   Day 7: Behavioral features はゆっくりと蓄積されていくようになる。  signal が十分にたまり、新製品としての時間特徴量の boost はここでは取り扱われなくなる ここから、適用されるスコアリングの公式が固定される   殆どの人が Cold start は Day 0 に対してのみ考慮するが、Day0-7 まで考える必要がある 時間経過にともなって、スコアリングをどう行っているか  理解が浅いのでここは省略します。だれか解説してくれると嬉しい    Non relevence Sort  big keyward では match set がとても巨大になります  例: tv というキーワードに対して家電カテゴリで 102,4635 の結果が存在する。 relevance sort は適切な検索結果が返ってくるが… Customer review での平均でソートを行うと  relevance がぐちゃぐちゃになってしまう。もちろんカスタマーレビューはありがたい機能ですが…       改善方法  tv というキーワードに対して 500 の製品タイプが Amazon catalog で存在する {query, product type} のペアでスコアを計算する  どの product type が特定のクエリにおいて最もクリック、カートに追加、購入されたか   特定のキーワードでフィルターを行い、指定の product type の製品のみを表示するにした  keyboard→ キーボード製品 USB→ フラッシュメモリ、ネットワークデバイス、入力デバイス TV→ テレビタイプ   これによって Customer review の平均でソートを行っても relevance が保たれるようになった  tvで customer review の平均で sort を行った際に 991 個の製品のみが表示され、relevance が向上した         蛇足 この論文は、過去に読んだサーベイ論文で面白そうとメモしておいたのがきっかけで知ることができた。サーベイ論文の紹介記事はこちら\ne コマースの検索と推薦についてのサーベイ論文である ‘Challenges and research opportunities in eCommerce search and recommendations’ を社内勉強会で発表した\n","wordCount":"509","inLanguage":"ja","image":"https://shunyaueta.com/posts/2021-12-26/images/1.png","datePublished":"2021-12-26T22:52:06+09:00","dateModified":"2022-09-01T21:49:58+09:00","author":{"@type":"Person","name":"Shunya Ueta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shunyaueta.com/posts/2021-12-26/"},"publisher":{"@type":"Organization","name":"🦅 hurutoriya","logo":{"@type":"ImageObject","url":"https://shunyaueta.com/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=https://shunyaueta.com/ accesskey=h title="🦅 hurutoriya (Alt + H)">🦅 hurutoriya</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shunyaueta.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://shunyaueta.com/about title=About><span>About</span></a></li><li><a href=https://shunyaueta.com/tags/newsletter/ title=Newsletter><span>Newsletter</span></a></li><li><a href=https://shunyaueta.com/index.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Amazon検索ランキングの奥深さ at MLconf SF 2016</h1><div class=post-meta><span title="2021-12-26 22:52:06 +0900 +0900">December 26, 2021</span>&nbsp;·&nbsp;Shunya Ueta</div></header><figure class=entry-cover><img loading=lazy src=https://shunyaueta.com/posts/2021-12-26/images/1.png alt="Amazon の検索改善事例"><p>Amazon の検索改善事例</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><ul><li><a href=#referemces aria-label=Referemces>Referemces</a></li><li><a href=#%e3%83%a1%e3%83%a2 aria-label=メモ>メモ</a><ul><li><a href=#search-ranking-models aria-label="Search Ranking Models">Search Ranking Models</a></li><li><a href=#training-labels aria-label="Training Labels">Training Labels</a></li><li><a href=#mixing-click-and-purchase-targets aria-label="Mixing Click and Purchase Targets">Mixing Click and Purchase Targets</a></li></ul></li><li><a href=#fast-feature-evaluation aria-label="Fast Feature Evaluation">Fast Feature Evaluation</a></li><li><a href=#components-of-the-blending-score aria-label="Components of the Blending Score">Components of the Blending Score</a></li><li><a href=#match-set aria-label="Match Set">Match Set</a></li><li><a href=#cold-start aria-label="Cold Start">Cold Start</a></li><li><a href=#non-relevence-sort aria-label="Non relevence Sort">Non relevence Sort</a><ul><li><a href=#%e8%9b%87%e8%b6%b3 aria-label=蛇足>蛇足</a></li></ul></li></ul></div></details></div><div class=post-content><p>1 日遅れてしまいましたが、<a href=https://adventar.org/calendars/6430>情報検索・検索技術 Advent Calendar 2021</a> 25 日目の記事です。</p><p>ついにアドベントカレンダー最終日を迎えました!
今年はまだ検索領域のアドベントカレンダーが作られていないからということで、勢いで<code>情報検索・検索技術 Advent Calendar 2021</code>を作りましたが、多くの方に投稿に協力していただきありがとうございました。</p><p>社内勉強会の発表でネタを探しており、2016 年と少し昔の情報ですが、Amazon の製品検索において、どのようにランキングを行っているかの公演動画が非常に面白かったので、勉強がてら残したメモを記事として公開します。</p><p>今回の口頭発表は <a href=https://mlconf.com/>MLconf</a> という開発者会議(非学会・非アカデミック)で発表されています。
自分が知る限り、MLconf は機械学習黎明期から高品質な発表が継続されて発信されており、非常に素晴らしいカンファレンスの一つ。
国際会議には投稿されていないが、実応用の観点からしてとても学びの多い発表がとても多いです。
機械学習の応用を考えている場合、世界の最先端事例を知ることができるので非常におすすめです。</p><hr><h2 id=referemces>Referemces<a hidden class=anchor aria-hidden=true href=#referemces>#</a></h2><blockquote><p>Sorokina, D., & Cantu-Paz, E. (2016, July). Amazon search: The joy of ranking products. In Proceedings of the 39th International ACM SIGIR conference on Research and Development in Information Retrieval (pp. 459-460).</p></blockquote><ul><li><a href=https://www.amazon.science/publications/amazon-search-the-joy-of-ranking-products>Amazon Search: The joy of ranking products in amazon science</a></li><li><a href=https://youtu.be/NLrhmn-EZ88>Youtube</a></li></ul><h2 id=メモ>メモ<a hidden class=anchor aria-hidden=true href=#メモ>#</a></h2><p>自分の私的な意見は <code>NOTE:</code> で書いておきます。</p><h3 id=search-ranking-models>Search Ranking Models<a hidden class=anchor aria-hidden=true href=#search-ranking-models>#</a></h3><ul><li>1Model = 1 context: 一つのモデルで一つの国の 1 カテゴリをサポート<ul><li>日本の書籍カテゴリで 1 モデル、フランスの家電領域で更に一つのモデル</li><li>モデルの軽量化と精度向上のためにコンテキストごとの最適化されたモデル作成を許している</li></ul></li><li>現在、100 以上の機械学習モデルを利用している<ul><li>GBDT ベースのモデルや、pairwise ランキングモデルなど</li><li>モデルはだいたい 200 以上の tree で構成されている</li></ul></li><li>150 種類以上の特徴量が利用可能だが、それぞれのモデルが利用しているのは 30 以下<ul><li>映画では、<code>days_since_release</code> がとても重要だが、他のカテゴリではそうではない</li></ul></li></ul><h3 id=training-labels>Training Labels<a hidden class=anchor aria-hidden=true href=#training-labels>#</a></h3><ul><li>学習データを顧客の行動ログから作成する</li><li>利用可能なポジティブラベルとして<ul><li>クリックされたか?</li><li>カートに入れられたか?</li><li>購入されたか?</li><li>消費されたか?</li></ul></li><li>ネガティブなラベルとしては<ul><li>無視された結果<ul><li>検索結果には表示されたが、何も行動が起こされていない製品</li></ul></li><li>検索結果から、そもそも表示されなかったページからランダムサンプリング<ul><li>ページネーションにより表示されなかったページからサンプリングを行う(slide が消えていて見えなかったので論文から補足)。<ul><li><code>NOTE:</code> アルゴリズムバイアスを加速させるような気もした。表示されなかったが良い商品をどうやって救い出すかも大事な観点。</li></ul></li></ul></li></ul></li></ul><h3 id=mixing-click-and-purchase-targets>Mixing Click and Purchase Targets<a hidden class=anchor aria-hidden=true href=#mixing-click-and-purchase-targets>#</a></h3><p><img loading=lazy src=/posts/2021-12-26/images/1.png alt></p><ul><li>何を目的変数とすべきか? クリックなのか、それとも購入か?<ul><li>おそらく購入されたかどうかでしょう、なぜなら我々の最終目標は製品を売ることなので</li><li>しかし、いつでも購入がゴールというわけではない&mldr; 例をお見せします</li></ul></li><li>Keyword: iPhone<ul><li>最もクリックされたもの<ul><li>iPhone7。700 ドル以上もするのでクリックはされますが購入されません</li></ul></li><li>最も購入されたもの<ul><li>一番購入されたものは何でしょうか? 最安価な iPhone モデルでしょうか?</li><li>正解は&mldr; 8 ドルの Lightning to USB Cable です&mldr;!</li></ul></li><li>もし購入されたことのみを目的変数にしてしまった場合、iPhone と検索して Lightning Cable しか表示されなくなり、検索機能が壊れてしまいます。</li></ul></li></ul><p><img loading=lazy src=/posts/2021-12-26/images/2.png alt></p><ul><li>これがクリックと購入を混在させたモデルの検索結果になります<ul><li>iPhone 5S は iPhone モデルシリーズで最も安く最も購入され、その後に 最もクリックされる iPhone7 その後に Lightning Cable が表示されています</li><li>これによって、異なる顧客の意図を汲み取った検索結果を提供できるようになりました</li></ul></li></ul><h2 id=fast-feature-evaluation>Fast Feature Evaluation<a hidden class=anchor aria-hidden=true href=#fast-feature-evaluation>#</a></h2><ul><li>2 段階の特徴量選択<ul><li><ol><li><code>150→50</code>: ランダムな特徴集合よりも良い結果を出した特徴を選択</li></ol></li><li><ol start=2><li><code>50→20</code>: 後方除去、前方選択により枝刈り</li></ol></li></ul></li><li>ツリーのアンサンブルにおける特徴量のスコアリング<ul><li>全てのツリーは特徴量のスコアリングアルゴリズムを持っている</li><li>課題点として 2 値と連続値の特徴量は比較ができない</li></ul></li><li><code>is_prime_benefit</code> は Amazon Video で最も重要な特徴量である<ul><li>しかし、特徴量選択では、いつもランダムな連続値の特徴量にスコアは低くなっている。何故?</li></ul></li><li>アンサンブルツリーはランダムな分割を多く実行する<ul><li>単一のツリーの分散は最終段階では平均化される</li></ul></li><li>連続値の特徴量は更に可能な分割を提供する<ul><li>よって、ランダムな分割で多く選ばれる</li><li>それによりスコアリングが高くなる</li></ul></li><li>それらを避けるには正規化の処理が重要になる</li><li>異なる一様分布の値から 6 つのランダムな特徴量を作成・追加を行い、ビデオ領域で実験を行った<ul><li>本来なら全ては意味のない特徴量なので、全ては同一の低いスコアリングがされるべきである</li></ul></li></ul><p><img loading=lazy src=/posts/2021-12-26/images/3.png alt></p><ul><li>しかし実験の結果、乱数の値に伴って対数的にスコアリングが変化していることがわかった</li><li>正規化された特徴量スコアでのバギングツリーを我々は利用している<ul><li>上記の手法は OSS として公開しています<ul><li><a href=https://github.com/dariasor/TreeExtra>https://github.com/dariasor/TreeExtra</a></li></ul></li></ul></li><li>上記の手法を適用後、スコアリングが最も高くなったのは <code>is_prime_benefit</code> 特徴量になりました</li><li>All Product Search</li><li><code>green</code> と検索を行うと以下の結果が出てくる</li></ul><p><img loading=lazy src=/posts/2021-12-26/images/4.png alt></p><h2 id=components-of-the-blending-score>Components of the Blending Score<a hidden class=anchor aria-hidden=true href=#components-of-the-blending-score>#</a></h2><ul><li>Fashion, Home&Kichen, Health カテゴリの商品が出てきます。どのように各カテゴリのスコアを計算しているのか?</li><li>Query Category score<ul><li>一般的なクエリ: クリック数、カートに追加したか、購入したか?</li><li>稀なクエリ: クエリの trigrams , bigrams, unigrams でのクリック数</li></ul></li><li>Hunger score: 飢えのスコア(動的なスコア)<ul><li>重要なカテゴリはこの Hunger Score が高くなりやすく設定</li><li>他のカテゴリが選択されるたび Hunger Score が高くなり、それがカテゴリ選出のスコアリングでは重要になる</li></ul></li><li>In-category relevance score for each product<ul><li>relevency が高い製品は選ばれやすくなる</li><li>このスコアは異なるカテゴリ間でも比較可能なものにしなければならない</li></ul></li><li>All Product Search - Blending</li><li><code>green</code> というキーワードに対しての Blending Score の具体例</li><li><img loading=lazy src=/posts/2021-12-26/images/5.png alt><ul><li>Fashion, Kitchen, Books カテゴリの中からどのように各カテゴリの商品が選出されるか?</li><li>各カテゴリの Query Score は、Fashion, Kitchen, Books の順番に高い</li><li>初期の全ての Hunger score は 0。白 → 灰色 → 黒と Hunger score が高くなる</li></ul></li><li><img loading=lazy src=/posts/2021-12-26/images/6.png alt><ul><li>まずはじめに、各カテゴリの Top1 製品の F1, K1, B1 を比較して、F1 が QueryScore に基づき最もスコアが高い F1 が選出される。</li></ul></li><li><img loading=lazy src=/posts/2021-12-26/images/7.png alt><ul><li>Fashion が選択されたので、Kitchen と Books の Hunger Score が高くなり、Hunger Score がより高い K1 が選出</li></ul></li><li><img loading=lazy src=/posts/2021-12-26/images/8.png alt><ul><li>Fashion カテゴリは重要なので Hunger Score がより早く高くなりやすい。Query Score と合わせて、三番目には F2 が選出</li></ul></li><li><img loading=lazy src=/posts/2021-12-26/images/9.png alt><ul><li>Books カテゴリの Hunger Score がとても高くなっているので、ついに B1 が 4 番目には選出される</li></ul></li><li><img loading=lazy src=/posts/2021-12-26/images/10.png alt><ul><li>上記の考えで各カテゴリ間でスコアを比較して検索結果に混ぜていく</li></ul></li></ul><h2 id=match-set>Match Set<a hidden class=anchor aria-hidden=true href=#match-set>#</a></h2><ul><li>Match set は、クエリに対して返された結果の集合</li><li>Match set は 2 つのパターンの製品を含む<ul><li>例: <code>zootopia</code> というクエリで、70538 個の mache set が返ってきた</li><li><ol><li>Textual matches</li></ol><ul><li>クエリに対して、Query understanding 後に Product description とマッチした製品</li><li><img loading=lazy src=/posts/2021-12-26/images/11.png alt></li></ul></li><li><ol start=2><li>Behavioral matches</li></ol><ul><li>そのクエリで検索後に、クリック、カートに追加、購入した商品の集合</li><li>今回の場合は、<code>zootopia</code> で検索後にクリック、カートに追加、購入した製品を指す。</li><li><img loading=lazy src=/posts/2021-12-26/images/12.png alt></li><li>どのように非 text-match が発生するか<ul><li><ol><li><code>zootopia</code> で検索</li></ol><ul><li><img loading=lazy src=/posts/2021-12-26/images/13.png alt></li></ul></li><li><ol start=2><li>その後クリックはせずに、<code>inside out</code>で検索を行い製品をクリック</li></ol><ul><li><img loading=lazy src=/posts/2021-12-26/images/14.png alt></li></ul></li><li><ol start=3><li>この 1-2 を同一セッションとして Behaivioral feature として扱う</li></ol><ul><li><img loading=lazy src=/posts/2021-12-26/images/15.png alt></li></ul></li><li><ol start=4><li>3 の特徴量を取り入れることで、非 text-match の製品を match set に取り込む</li></ol><ul><li><img loading=lazy src=/posts/2021-12-26/images/16.png alt></li></ul></li></ul></li></ul></li></ul></li></ul><h2 id=cold-start>Cold Start<a hidden class=anchor aria-hidden=true href=#cold-start>#</a></h2><ul><li>新しい Harry Porrer の書籍が利用可能になります!<ul><li>私達はこの書籍がベストセラーになることを知っていますが&mldr;</li></ul></li><li>Behaivioral feature がまだ存在しない<ul><li>どれくらいクリックされるかは我々は知らない</li></ul></li><li>古い書籍は多くの signal を持っているので、新しい書籍は下のランクに位置づけられる<ul><li><img loading=lazy src=/posts/2021-12-26/images/17.png alt></li><li>求めている書籍が検索結果の下にあるのは顧客は不幸です。</li><li>Business チームもこの異常事態を伝えてきます</li><li>ジョークですが、非公式の指標として、「今すぐこれを直してください」の要求の数が低ければ低いほどよいです</li></ul></li><li>Day 0: 全ての behaivioral features は 0<ul><li>時間特徴量がここでは助けになる(新製品にたいして Boost を行い、ランクを上にする)</li><li>ここで顧客が製品に対してクリックを行い、signal が溜まっていきます</li></ul></li><li>Day 1: Behaivioral features はまだ更新されていない<ul><li>クリック情報を持っているが、検索エンジンにはまだ反映されていない</li><li>強靭なインフラが、新製品に対して signal の蓄積を迅速に反映させていく</li></ul></li><li>Day 7: Behavioral features はゆっくりと蓄積されていくようになる。<ul><li>signal が十分にたまり、新製品としての時間特徴量の boost はここでは取り扱われなくなる</li><li>ここから、適用されるスコアリングの公式が固定される</li></ul></li><li>殆どの人が Cold start は Day 0 に対してのみ考慮するが、Day0-7 まで考える必要がある</li><li>時間経過にともなって、スコアリングをどう行っているか<ul><li>理解が浅いのでここは省略します。だれか解説してくれると嬉しい</li></ul></li></ul><h2 id=non-relevence-sort>Non relevence Sort<a hidden class=anchor aria-hidden=true href=#non-relevence-sort>#</a></h2><ul><li>big keyward では match set がとても巨大になります<ul><li>例: <code>tv</code> というキーワードに対して家電カテゴリで 102,4635 の結果が存在する。</li><li>relevance sort は適切な検索結果が返ってくるが&mldr;</li><li>Customer review での平均でソートを行うと<ul><li>relevance がぐちゃぐちゃになってしまう。もちろんカスタマーレビューはありがたい機能ですが&mldr;<ul><li><img loading=lazy src=/posts/2021-12-26/images/18.png alt></li></ul></li></ul></li><li>改善方法<ul><li><code>tv</code> というキーワードに対して 500 の製品タイプが Amazon catalog で存在する</li><li>{query, product type} のペアでスコアを計算する<ul><li>どの product type が特定のクエリにおいて最もクリック、カートに追加、購入されたか</li></ul></li><li>特定のキーワードでフィルターを行い、指定の product type の製品のみを表示するにした<ul><li>keyboard→ キーボード製品</li><li>USB→ フラッシュメモリ、ネットワークデバイス、入力デバイス</li><li>TV→ テレビタイプ</li></ul></li><li>これによって Customer review の平均でソートを行っても relevance が保たれるようになった<ul><li><code>tv</code>で customer review の平均で sort を行った際に 991 個の製品のみが表示され、relevance が向上した</li><li><img loading=lazy src=/posts/2021-12-26/images/19.png alt></li></ul></li></ul></li></ul></li></ul><h3 id=蛇足>蛇足<a hidden class=anchor aria-hidden=true href=#蛇足>#</a></h3><p>この論文は、過去に読んだサーベイ論文で面白そうとメモしておいたのがきっかけで知ることができた。サーベイ論文の紹介記事はこちら</p><p><a href=/posts/2021-07-10/>e コマースの検索と推薦についてのサーベイ論文である &lsquo;Challenges and research opportunities in eCommerce search and recommendations&rsquo; を社内勉強会で発表した</a></p><h2>See Also</h2><ul><li><a href=/posts/2021-11-26/>Amazonがeコマース検索を Lucene により、どうスケールさせているか at Berlin Buzzwords 2019</a></li><li><a href=/posts/2021-10-09/>クエリ分類(Query Classification) について社内の勉強会で話してきた</a></li><li><a href=/posts/2021-07-10/>eコマースの検索と推薦についてのサーベイ論文である 'Challenges and research opportunities in eCommerce search and recommendations' を社内勉強会で発表した</a></li><li><a href=/posts/2021-05-12/>[抄訳] 検索エンジンの達成度と検索チームの成熟度モデル</a></li><li><a href=/posts/2021-01-17/>TFXの歴史を振り返りつつ機械学習エンジニアリングを提案する論文「Towards ML Engineering: A Brief History Of TensorFlow Extended (TFX)」</a></li></ul><h2>Support</h2>記事をお読みくださりありがとうございます。このウェブサイトの運営を支援していただける方を募集しています。
もしよろしければ、下のボタンからサポート(投げ銭)していただけると、ブログ執筆、情報発信のモチベーションに繋がります✨
<a href=https://www.buymeacoffee.com/hurutoriya><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&emoji=☕&slug=hurutoriya&button_colour=FFDD00&font_colour=000000&font_family=Inter&outline_colour=000000&coffee_colour=ffffff"></a></div><footer class=post-footer><ul class=post-tags><li><a href=https://shunyaueta.com/tags/search/>search</a></li><li><a href=https://shunyaueta.com/tags/machinelearning/>machinelearning</a></li><li><a href=https://shunyaueta.com/tags/amazon/>amazon</a></li><li><a href=https://shunyaueta.com/tags/translation/>translation</a></li></ul><nav class=paginav><a class=prev href=https://shunyaueta.com/posts/2021-12-28/><span class=title>« 前のページ</span><br><span>Jupyter Notebook で画像をダウンロードすることなく、URLから参照してPandas DataFrame内部に表示させる</span></a>
<a class=next href=https://shunyaueta.com/posts/2021-12-07/><span class=title>次のページ »</span><br><span>Offers Magazine というメディアに、エンジニアによる業務実績の論文化について寄稿した</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=hurutoriya/hurutoriya.github.io data-repo-id="MDEwOlJlcG9zaXRvcnk2MDgyNTY1Nw==" data-category=Comments data-category-id=DIC_kwDOA6AgOc4CAQTX data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-theme=dark data-lang=ja crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2022 <a href=https://shunyaueta.com/>🦅 hurutoriya</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z" /></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerHTML='コピー';function copyingDone(){copybutton.innerHTML='コピーされました!';setTimeout(()=>{copybutton.innerHTML='コピー';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>