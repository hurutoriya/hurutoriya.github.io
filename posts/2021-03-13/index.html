<!doctype html><html><head><script data-ad-client=ca-pub-8604812913439531 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Shunya Ueta (a.k.a hurutoriya) personal website"><link rel="shortcut icon" href=https://shunyaueta.com/favicon.ico><link rel=stylesheet href=/css/style.min.css><script data-ad-client=ca-pub-8604812913439531 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><title>pipenv でローカルパッケージが正常にインストールされないときの対処法</title></head><body><header id=banner><h2><a href=https://shunyaueta.com/>Software Engineer as Data Scientist</a></h2><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>pipenv でローカルパッケージが正常にインストールされないときの対処法</h1><time>2021-03-13</time></header><h2 id=tl-dr>TL; DR;</h2><ul><li>pip install pipenv==2018.11.26 をすれば直った!!!!!</li></ul><h2 id=実行環境>実行環境</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nv>$pipenv</span> --version
pipenv, version 2020.11.15
</code></pre></div><h2 id=直面した問題>直面した問題</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>./app/
├── model
│   └── setup.py
└── serving
    └── Pipfile
</code></pre></div><p>のような構成で、<code>model</code>というローカルパッケージを作成しており、serving 直下のPipfile は、<code>model</code> を読み込んでsetup.py に記述されている依存パッケージもインストールするようにしたい。</p><p>serving ディレクトリで、以下のコマンドを入力すればローカルパッケージがpipenv によりインストールされるはずだが</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>pipenv install --editable ../model
</code></pre></div><p>依存関係をすべて記述するはずのPipenv.lock には、<code>model</code>のパスのみが記述され、ローカルパッケージが要求する依存パッケージが記述されていない。</p><p>原因を探してみたところ、</p><p><a href=https://github.com/pypa/pipenv/issues/1024>Installing a local package with pipenv install &lsquo;-e .&rsquo; doesn&rsquo;t save dependencies #1024</a></p><p>同じ GitHub issue を発見しダメ元で pipenv を以下のコマンドでダウングレードして見たところ</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>pip install <span class=nv>pipenv</span><span class=o>==</span>2018.11.26
</code></pre></div><p>なんと&mldr;. 直った。無事にローカルパッケージの依存パッケージが Pipenv.lock に記述されており、無事にローカルパッケージがserving 直下で動くようになった。</p><p>後方互換性が無いとかそんなちゃちな問題ではない気がするのだが、この問題でかなり時間が溶けたので非常に精神的に消耗した。</p><p>思えばこういう問題が多くて、普段はpoetry を使っていたのを思い出した。</p><h2 id=ref>Ref</h2><ul><li><a href=https://stackoverflow.com/questions/53505681/installing-dependencies-of-a-local-dependency-with-pipenv>Installing dependencies of a local dependency with pipenv</a></li></ul></article></main><h3>See Also</h3><ul><li><a href=/posts/2021-02-08/>pip 実行時に sys.stderr.write(f"ERROR: {exc} ") とエラーが出てpipを実行できないときの対処方法</a></li><li><a href=/posts/2020-12-26/>Apache beam 入門</a></li><li><a href=/posts/2020-09-09/>pandas を使って特定のディレクトリのCSVファイルをすべて連結して一つのCSVファイルを作成</a></li><li><a href=/posts/2020-08-23/>Python の内包表記とジェネレータ式のメモリ使用量比較</a></li><li><a href=/posts/2020-07-25/>How to write the UnitTest with stdin at Pytest</a></li></ul><footer id=footer>Copyright © 2013-2021 Shunya Ueta</footer></body></html>