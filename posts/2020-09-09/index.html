<!doctype html><html><head><script data-ad-client=ca-pub-8604812913439531 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>pandas を使って特定のディレクトリのCSVファイルをすべて連結して一つのCSVファイルを作成 - hurutoriya</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:image" content><meta property="og:title" content="pandas を使って特定のディレクトリのCSVファイルをすべて連結して一つのCSVファイルを作成"><meta property="og:description" content="目的 複数の同じフォーマットのCSVファイルが特定のディレクトリに配置されており、そのCSVファイル群を一つのCSVファイルに連結したい
今回は、PythonのPandas とpathlibを使って上記の目的を実現します。
実行環境 In [1]: import pandas as pd In [2]: pd.__version__ Out[2]: '1.1.2 In [3]: import sys ...: print(sys.version) 3.8.2 (default, Jul 19 2020, 07:23:27) [Clang 11.0.3 (clang-1103.0.32.62)] 目的となるcsvファイルは tmp ディレクトリに以下のような形式で配置されているとする
tmp ├── 1.csv ├── 2.csv └── 3.csv 各ファイルはこのような形式で保存されています。
id name created 1 John 2020/09/10 2 bob 2020/09/10 3 taro 2020/09/11 以下のPythonスクリプトを実行
import pathlib import pandas as pd def contcat_csv(f_path:str): # pathlibのitedir()で対象とするディレクトリのCSVファイル一覧をジェネレーターとして取得 csvs = [pd.read_csv(str(path)) for path in pathlib."><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2020-09-09/"><meta property="article:published_time" content="2020-09-09T23:49:37+09:00"><meta property="article:modified_time" content="2020-09-09T23:49:37+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="pandas を使って特定のディレクトリのCSVファイルをすべて連結して一つのCSVファイルを作成"><meta name=twitter:description content="目的 複数の同じフォーマットのCSVファイルが特定のディレクトリに配置されており、そのCSVファイル群を一つのCSVファイルに連結したい
今回は、PythonのPandas とpathlibを使って上記の目的を実現します。
実行環境 In [1]: import pandas as pd In [2]: pd.__version__ Out[2]: '1.1.2 In [3]: import sys ...: print(sys.version) 3.8.2 (default, Jul 19 2020, 07:23:27) [Clang 11.0.3 (clang-1103.0.32.62)] 目的となるcsvファイルは tmp ディレクトリに以下のような形式で配置されているとする
tmp ├── 1.csv ├── 2.csv └── 3.csv 各ファイルはこのような形式で保存されています。
id name created 1 John 2020/09/10 2 bob 2020/09/10 3 taro 2020/09/11 以下のPythonスクリプトを実行
import pathlib import pandas as pd def contcat_csv(f_path:str): # pathlibのitedir()で対象とするディレクトリのCSVファイル一覧をジェネレーターとして取得 csvs = [pd.read_csv(str(path)) for path in pathlib."><script src=https://shunyaueta.com/js/feather.min.js></script><link href=https://shunyaueta.com/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://shunyaueta.com/css/main.css><link rel=stylesheet type=text/css href=https://shunyaueta.com/css/dark.css media="(prefers-color-scheme: dark)"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-39994406-11"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-39994406-11');</script></head><body><div class=content><header><div class=main><a href=https://shunyaueta.com/>hurutoriya</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>pandas を使って特定のディレクトリのCSVファイルをすべて連結して一つのCSVファイルを作成</h1><div class=meta>Posted on Sep 9, 2020</div></div><section class=body><h2 id=目的>目的</h2><p>複数の同じフォーマットのCSVファイルが特定のディレクトリに配置されており、そのCSVファイル群を一つのCSVファイルに連結したい</p><p>今回は、PythonのPandas とpathlibを使って上記の目的を実現します。</p><h3 id=実行環境>実行環境</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>In [<span style=color:#ae81ff>1</span>]: <span style=color:#f92672>import</span> pandas <span style=color:#f92672>as</span> pd
In [<span style=color:#ae81ff>2</span>]: pd<span style=color:#f92672>.</span>__version__
Out[<span style=color:#ae81ff>2</span>]: <span style=color:#e6db74>&#39;1.1.2</span>
In [<span style=color:#ae81ff>3</span>]: <span style=color:#f92672>import</span> sys
   <span style=color:#f92672>...</span>: <span style=color:#66d9ef>print</span>(sys<span style=color:#f92672>.</span>version)
<span style=color:#ae81ff>3.8</span><span style=color:#f92672>.</span><span style=color:#ae81ff>2</span> (default, Jul <span style=color:#ae81ff>19</span> <span style=color:#ae81ff>2020</span>, <span style=color:#ae81ff>07</span>:<span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>27</span>)
[Clang <span style=color:#ae81ff>11.0</span><span style=color:#f92672>.</span><span style=color:#ae81ff>3</span> (clang<span style=color:#f92672>-</span><span style=color:#ae81ff>1103.0</span><span style=color:#f92672>.</span><span style=color:#ae81ff>32.62</span>)]
</code></pre></div><p>目的となるcsvファイルは <code>tmp</code> ディレクトリに以下のような形式で配置されているとする</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tmp
├── 1.csv
├── 2.csv
└── 3.csv
</code></pre></div><p>各ファイルはこのような形式で保存されています。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>id  name  created
1   John  2020/09/10
2   bob   2020/09/10
3   taro  2020/09/11
</code></pre></div><p>以下のPythonスクリプトを実行</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> pathlib
<span style=color:#f92672>import</span> pandas <span style=color:#f92672>as</span> pd


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>contcat_csv</span>(f_path:str):
    <span style=color:#75715e># pathlibのitedir()で対象とするディレクトリのCSVファイル一覧をジェネレーターとして取得</span>
    csvs <span style=color:#f92672>=</span> [pd<span style=color:#f92672>.</span>read_csv(str(path)) <span style=color:#66d9ef>for</span> path <span style=color:#f92672>in</span> pathlib<span style=color:#f92672>.</span>Path(f_path)<span style=color:#f92672>.</span>glob(<span style=color:#e6db74>&#39;*.csv&#39;</span>)]
    <span style=color:#75715e># そのファイル一覧をPandasで読み込んで、pd.concat()で連結してDataFrameとして返す</span>
    <span style=color:#66d9ef>return</span> pd<span style=color:#f92672>.</span>concat(csvs, sort<span style=color:#f92672>=</span>False)

df <span style=color:#f92672>=</span> contcat_csv(<span style=color:#e6db74>&#39;tmp&#39;</span>)
<span style=color:#75715e># 連結されたDataFrameをCSVとして保存する</span>
df<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>&#39;concat.csv&#39;</span>, index<span style=color:#f92672>=</span>False)

</code></pre></div><p>concat.csvを確認してみると</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>id  name    created
1   John    2020/09/10
2   bob     2020/09/10
3   taro    2020/09/11
4   hanako  2020/09/12
1   John    2020/09/10
2   bob     2020/09/10
3   taro    2020/09/11
4   hanako  2020/09/12
1   John    2020/09/10
2   bob     2020/09/10
3   taro    2020/09/11
4   hanako  2020/09/12
</code></pre></div><p>無事連結されたCSVを取得することができました</p><h2 id=追記>追記</h2><ul><li>2020-09-12: @siumachi さんから<a href=https://twitter.com/shiumachi/status/1304325924377096192>ご指摘</a>を受け、CSVファイル以外がディレクトリに混入していても問題ないように変更しました</li></ul><blockquote><p>拝見しました。forでディレクトリを走査するときは pathlib.Path.glob("*.csv&rdquo;)を使った方が、csv以外のファイルが混入したときの対策になると思ったのですが、いかがでしょう <a href=https://docs.python.org/ja/3/library/pathlib.html#pathlib.Path.glob>https://docs.python.org/ja/3/library/pathlib.html#pathlib.Path.glob</a></p></blockquote></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/python>Python</a></li><li><a href=/tags/pandas>Pandas</a></li></ul></nav></div></article></main><h3>See Also</h3><ul><li><a href=/posts/2020-08-23/>Python の内包表記とジェネレータ式のメモリ使用量比較</a></li><li><a href=/posts/2020-07-25/>How to write the UnitTest with stdin at Pytest</a></li><li><a href=/posts/2020-05-10/>自走プログラマーを読み終えた</a></li><li><a href=/posts/2020-04-26/>Pythonの関数のデフォルト引数はmutable(上書きされる)</a></li><li><a href=/posts/2019-10-03/>pandas.read_gbq を使わずに、Google BigQueryから高速にData ETL</a></li></ul><footer><hr><a class=soc href=https://github.com/hurutoriya title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/hurutoriya/ title=Twitter><i data-feather=twitter></i></a>|⚡️
2021 © Shunya Ueta | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>