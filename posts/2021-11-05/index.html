<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>Google Cloud Pub/Sub に公開された結果はDataflow template を使えばめちゃくちゃ簡単に確認できる | Shunya Ueta</title><link rel=stylesheet href=/sass/main.min.b81b77bfef641cdef5a77f4a7bb221547def6cea9b73ab29b5fed4c98707f2a8.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-39994406-11','auto');ga('send','pageview');}</script><meta property="og:title" content="Google Cloud Pub/Sub に公開された結果はDataflow template を使えばめちゃくちゃ簡単に確認できる"><meta property="og:description" content="PubSub に出力された結果を確認するのって、なかなか手間がかかりませんか?
最近同僚に簡単な確認方法を教えてもらい、感動したのでそれを記事にしました。
確認方法  PubSub のメッセージを出力する Google Cloud Storage bucket を同一 GCP プロジェクトで作成する。 GCP の Pub/Sub ページに移動する 確認したい Pub/Sub topic をクリックする ページ下部にある CREATE SUBSCRIPTION ボタンを押すと選択肢で、Create subscription, Export to BigQuery, Export to Cloud Storageがあり、 Export to Cloud Storageを選択する。  BigQuery、 Google Cloud Storage への吐き出しを行い際に、自動的に subscription が生成される。   Export to Cloud Storage を選択すると、Text 形式か Abro 形式での出力にするかを選択できる。基本的には簡単に確認できる Text 形式を選ぶと良さげ。 選択後、下記のような設定画面が出てくるので情報を埋めていく。基本的には、どこの Google Cloud Storage に出力するかを埋めれば完了。   10m ほどすると Streaming job の Dataflow の起動が完了して、一定期間ごとに Pub/Sub の topic に公開されたデータがテキスト形式で出力され始めます。 出力された GCS の結果を眺めるには、 gsutil コマンドなどを使うのが簡単です。自分はgsutil cat の結果をコピーして VS Code で確認しています。  Cloud Dataflow のテンプレート機能については、端的に説明すると、GUI でパラメータを設定するだけで、Dataflow によるデータ処理が簡単に実行できるようになる機能です。"><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2021-11-05/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="article:published_time" content="2021-11-05T23:05:22+09:00"><meta property="article:modified_time" content="2022-01-06T13:01:00+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="Google Cloud Pub/Sub に公開された結果はDataflow template を使えばめちゃくちゃ簡単に確認できる"><meta name=twitter:description content="PubSub に出力された結果を確認するのって、なかなか手間がかかりませんか?
最近同僚に簡単な確認方法を教えてもらい、感動したのでそれを記事にしました。
確認方法  PubSub のメッセージを出力する Google Cloud Storage bucket を同一 GCP プロジェクトで作成する。 GCP の Pub/Sub ページに移動する 確認したい Pub/Sub topic をクリックする ページ下部にある CREATE SUBSCRIPTION ボタンを押すと選択肢で、Create subscription, Export to BigQuery, Export to Cloud Storageがあり、 Export to Cloud Storageを選択する。  BigQuery、 Google Cloud Storage への吐き出しを行い際に、自動的に subscription が生成される。   Export to Cloud Storage を選択すると、Text 形式か Abro 形式での出力にするかを選択できる。基本的には簡単に確認できる Text 形式を選ぶと良さげ。 選択後、下記のような設定画面が出てくるので情報を埋めていく。基本的には、どこの Google Cloud Storage に出力するかを埋めれば完了。   10m ほどすると Streaming job の Dataflow の起動が完了して、一定期間ごとに Pub/Sub の topic に公開されたデータがテキスト形式で出力され始めます。 出力された GCS の結果を眺めるには、 gsutil コマンドなどを使うのが簡単です。自分はgsutil cat の結果をコピーして VS Code で確認しています。  Cloud Dataflow のテンプレート機能については、端的に説明すると、GUI でパラメータを設定するだけで、Dataflow によるデータ処理が簡単に実行できるようになる機能です。"></head><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/><span class=emoji>🦅</span>
Shunya Ueta</a></div><div class=flex><a href=/articles/>All posts</a>
<button id=dark-mode-button></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Google Cloud Pub/Sub に公開された結果はDataflow template を使えばめちゃくちゃ簡単に確認できる</h1><div class=post-meta><div>By Shunya Ueta on <time>2021.11.05</time> (Last updated:<time>2022.01.06</time>)</div><div class=tags><a href=/tags/dataflow/>dataflow</a>
<a href=/tags/gcp/>gcp</a>
<a href=/tags/pubsub/>pubsub</a></div></div></div></div></header></article><div class=article-post><p>PubSub に出力された結果を確認するのって、なかなか手間がかかりませんか?</p><p>最近同僚に簡単な確認方法を教えてもらい、感動したのでそれを記事にしました。</p><h2 id=確認方法>確認方法</h2><ol><li>PubSub のメッセージを出力する Google Cloud Storage bucket を同一 GCP プロジェクトで作成する。</li><li>GCP の Pub/Sub ページに移動する</li><li>確認したい Pub/Sub topic をクリックする</li><li>ページ下部にある <code>CREATE SUBSCRIPTION</code> ボタンを押すと選択肢で、<code>Create subscription</code>, <code>Export to BigQuery</code>, <code>Export to Cloud Storage</code>があり、 <code>Export to Cloud Storage</code>を選択する。<ul><li>BigQuery、 Google Cloud Storage への吐き出しを行い際に、自動的に subscription が生成される。</li></ul></li><li><code>Export to Cloud Storage</code> を選択すると、Text 形式か Abro 形式での出力にするかを選択できる。基本的には簡単に確認できる Text 形式を選ぶと良さげ。</li><li>選択後、下記のような設定画面が出てくるので情報を埋めていく。基本的には、どこの Google Cloud Storage に出力するかを埋めれば完了。</li></ol><p><img src=/posts/2021-11-05/images/1.png alt="Export to Cloud Storage config"></p><ol><li>10m ほどすると Streaming job の Dataflow の起動が完了して、一定期間ごとに Pub/Sub の topic に公開されたデータがテキスト形式で出力され始めます。</li><li>出力された GCS の結果を眺めるには、 <code>gsutil</code> コマンドなどを使うのが簡単です。自分は<code>gsutil cat</code> の結果をコピーして VS Code で確認しています。</li></ol><p>Cloud Dataflow のテンプレート機能については、端的に説明すると、GUI でパラメータを設定するだけで、Dataflow によるデータ処理が簡単に実行できるようになる機能です。</p><p>詳しくは、 GCPUG での<a href=https://medium.com/google-cloud-jp/cloud-dataflow-%E3%81%8C%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%AB%E3%82%88%E3%82%8A%E6%B0%97%E8%BB%BD%E3%81%AB%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%83%AC%E3%82%B9%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E9%80%B2%E5%8C%96%E3%81%97%E3%81%9F%E8%A9%B1-f8105ea956d3>Cloud Dataflow がテンプレートにより気軽に使えるサーバーレスのサービスに進化した話
</a>の記事がわかりやすいのでごらんください。</p></div><h2>Support</h2><div class=container><div class=posts><div class=post><div class=post-row><a href=https://www.buymeacoffee.com/hurutoriya target=_blank>☕️ Buy me a cofee: お読みくださりありがとうございます。
こちらから ☕ を一杯支援していただけると、ブログ執筆のモチベーションに繋がります ✨</a></div></div></div></div><h2>See Also</h2><ul><li><a href=/posts/2021-10-04/>CloudComposer のDAGをCircleCIで更新する</a></li><li><a href=/posts/2021-09-29/>GCPのCloud Composer のDAGを素早く・簡単にデバッグする</a></li><li><a href=/posts/2021-09-07/>gcloud commands で PubSub に jsonファイルをメッセージとして公開 (Pusblish) する</a></li><li><a href=/posts/2021-03-03/>GKE 上にて Pythonで logger.info() を行うとCloud logging では stderr に保存され、すべてエラーになる問題への対処法</a></li><li><a href=/posts/2019-10-03/>遅すぎる `pandas.read_gbq` を使わずに、Google BigQueryから高速にデータを読み込む</a></li></ul></div><div class=container><nav class="flex container suggested"><a rel=prev href=/posts/2021-10-12/ title="Previous post (older)"><span>Previous</span>
Airflow でDAGを任意のタイミングで一度だけ実行する方法</a>
<a rel=next href=/posts/2021-11-06/ title="Next post (newer)"><span>Next</span>
Standard SQLのCOALESCEで、時間経過によってカラム名が変化したデータを柔軟に抽出する</a></nav></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/about/>About</a>
<a href=/index.xml>RSS</a>
<a href=https://www.buymeacoffee.com/hurutoriya>Support</a></nav></section><script async src=/js/features.min.a94f58a30ad2560de728e080d87f75c60cf806fd1b3d5f4815f1a1a02c0d1859.js></script></footer></body></html>