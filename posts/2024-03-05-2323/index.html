<!doctype html><html lang=ja><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Community Over Code North America 2023 にて Lucene 関係で気になった発表まとめ | Shunya Ueta</title>
<meta name=title content="Community Over Code North America 2023 にて Lucene 関係で気になった発表まとめ"><meta name=description content="特に Uber 検索基盤の話と、Amazon の benchmarking, 正規表現検索が楽しそう
Lessons Learned from Benchmarking Amazon’s E-commerce Search Engine The search engine on Amazon’s retail website runs on Lucene. It makes billions of products available to customers in less than 1 second per query. At this scale, every wasted millisecond comes at a large cost, so performance tests have to be thorough. Last year, we took inventory of our benchmarks, quantified the noise and bias we were seeing, introduced measurements for the statistical significance of results, and addressed sources of inconsistency (e."><meta name=keywords content="lucene,search,"><meta property="og:title" content="Community Over Code North America 2023 にて Lucene 関係で気になった発表まとめ"><meta property="og:description" content="特に Uber 検索基盤の話と、Amazon の benchmarking, 正規表現検索が楽しそう
Lessons Learned from Benchmarking Amazon’s E-commerce Search Engine The search engine on Amazon’s retail website runs on Lucene. It makes billions of products available to customers in less than 1 second per query. At this scale, every wasted millisecond comes at a large cost, so performance tests have to be thorough. Last year, we took inventory of our benchmarks, quantified the noise and bias we were seeing, introduced measurements for the statistical significance of results, and addressed sources of inconsistency (e."><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2024-03-05-2323/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-05T23:23:56+09:00"><meta property="article:modified_time" content="2024-03-05T23:23:56+09:00"><meta property="og:site_name" content="Shunya Ueta"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="Community Over Code North America 2023 にて Lucene 関係で気になった発表まとめ"><meta name=twitter:description content="特に Uber 検索基盤の話と、Amazon の benchmarking, 正規表現検索が楽しそう
Lessons Learned from Benchmarking Amazon’s E-commerce Search Engine The search engine on Amazon’s retail website runs on Lucene. It makes billions of products available to customers in less than 1 second per query. At this scale, every wasted millisecond comes at a large cost, so performance tests have to be thorough. Last year, we took inventory of our benchmarks, quantified the noise and bias we were seeing, introduced measurements for the statistical significance of results, and addressed sources of inconsistency (e."><meta itemprop=name content="Community Over Code North America 2023 にて Lucene 関係で気になった発表まとめ"><meta itemprop=description content="特に Uber 検索基盤の話と、Amazon の benchmarking, 正規表現検索が楽しそう
Lessons Learned from Benchmarking Amazon’s E-commerce Search Engine The search engine on Amazon’s retail website runs on Lucene. It makes billions of products available to customers in less than 1 second per query. At this scale, every wasted millisecond comes at a large cost, so performance tests have to be thorough. Last year, we took inventory of our benchmarks, quantified the noise and bias we were seeing, introduced measurements for the statistical significance of results, and addressed sources of inconsistency (e."><meta itemprop=datePublished content="2024-03-05T23:23:56+09:00"><meta itemprop=dateModified content="2024-03-05T23:23:56+09:00"><meta itemprop=wordCount content="593"><meta itemprop=image content="https://shunyaueta.com/ogp.jpg"><meta itemprop=keywords content="lucene,search,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-JMJRQJT0Q3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JMJRQJT0Q3")</script></head><body><header><a href=/ class=title><h2>Shunya Ueta</h2></a><nav><a href=/about/>著者について</a>
<a href=/index.xml>RSS</a></nav></header><main><h1>Community Over Code North America 2023 にて Lucene 関係で気になった発表まとめ</h1><p><i><time datetime=2024-03-05 pubdate>2024-03-05</time></i></p><content><p>特に Uber 検索基盤の話と、Amazon の benchmarking, 正規表現検索が楽しそう</p><h2 id=lessons-learned-from-benchmarking-amazons-e-commerce-search-engine>Lessons Learned from Benchmarking Amazon’s E-commerce Search Engine</h2><blockquote><p>The search engine on Amazon’s retail website runs on Lucene. It makes billions of products available to customers in less than 1 second per query. At this scale, every wasted millisecond comes at a large cost, so performance tests have to be thorough. Last year, we took inventory of our benchmarks, quantified the noise and bias we were seeing, introduced measurements for the statistical significance of results, and addressed sources of inconsistency (e.g.: caching, index geometry). We aren’t done, but this is a step in the right direction – benchmarks that are accurate, precise, and quick enough to remain useful. This talk will tell that story and help you move in the same direction. (<a href=https://communityovercode.org/wp-content/uploads/2023/10/sun_performance_vodita-stefan-vodita.pptx>Slides</a>)</p></blockquote><p>Amazon の検索エンジンのベンチマーキングについての発表</p><h2 id=search-at-uber-over-apache-lucene>Search at Uber over Apache Lucene</h2><blockquote><p>In this talk, we’ll give an overview of the Search platform at Uber, and share how we built a scalable and high-performance platform over Apache Lucene. We’ll highlight several business-critical use cases at Uber powered-by the search platform such as UberEats Discovery and Maps search. We will discuss the unique challenges from these use cases such as strong data freshness and geospatial search requirements. Next, we’ll present the overall architecture of the search platform, built on top of Apache Lucene, and explain how it addresses the challenges via a Base/Snapshot/Live (BSL) fashion of index structure. Lastly, we’ll share several ongoing interesting efforts that leverage new features from Lucene such as HNSW for vector search. (<a href=https://communityovercode.org/wp-content/uploads/2023/10/sat_search_search-at-uber-over-apache-lucene-yupeng-fu.pdf>Slides</a>)</p></blockquote><p>Uber で Apache Lucene を使ってどのように検索基盤を作成しているか</p><h2 id=introducing-multi-valued-vector-fields-in-apache-lucene>Introducing Multi-valued Vector Fields in Apache Lucene</h2><blockquote><p>Since the introduction of native vector-based search in Apache Lucene happened, many features have been developed, but the support for multiple vectors in a dedicated KNN vector field remained to explore. Having the possibility of indexing (and searching) multiple values per field unlocks the possibility of working with long textual documents, splitting them into paragraphs, and encoding each paragraph as a separate vector: a scenario that is often encountered by many businesses. This talk explores the challenges, the technical design and the implementation activities that happened during the work for this contribution to the Apache Lucene project. The audience is expected to get an understanding of how multi-valued fields can work in a vector-based search use case and how this feature has been implemented.</p></blockquote><p>Lucene の複数の値を持つベクトルフィールドの紹介
複数に分割することで、長すぎるドキュメントに対しても分割してベクトルを作成することで扱うことが可能になった</p><h2 id=fighting-adversarial-regular-expressions-in-apache-lucene>Fighting Adversarial Regular Expressions in Apache Lucene</h2><blockquote><p>Regular expressions are a compact and powerful approach for matching strings and are well supported in Lucene using RegexpQuery. However, such queries can be surprisingly costly, leading to a possible denial of service (ReDoS) vulnerability in search services built on Lucene.<br>This talk will first briefly introduce how Lucene executes RegexpQuery using a pre-determinized finite state automaton or DFA matching approach. This yields fast query execution, but Lucene must guard against the determinization pre-step taking too much work and reject the query, preventing such costly regular expressions from being used in Lucene at all. Next I’ll describe a recent Lucene bug that led to an adversarial ReDoS query impacting an OpenSearch user [1] and how we fixed and optimized it. I’ll present the ongoing development efforts to execute the RegexQuery directly using a non-deterministic finite state automaton (NFA) instead, guided by the method described in Russ Cox’s paper [2]. Finally I’ll walk through the pros and cons of these two execution methods for Lucene’s RegexpQuery so that future Lucene users can understand and reduce the risk and impact of ReDoS attacks in their search applications.<br>[1] <a href=https://github.com/opensearch-project/OpenSearch/issues/687>https://github.com/opensearch-project/OpenSearch/issues/687</a><br>[2] <a href=https://swtch.com/~rsc/regexp/regexp1.html>https://swtch.com/~rsc/regexp/regexp1.html</a> (<a href=https://communityovercode.org/wp-content/uploads/2023/10/sat_search_patrickzhai-patrick-zhai.pdf>Slides</a>)</p></blockquote><p>Lucene での正規表現検索の改善と NFA を使った 正規表現クエリの実装のアイデアを紹介</p></content>---<p>関連しているかもしれない記事</p><ul><li><a href=/posts/2023-04-17-2252/>Twitter の検索システムを学ぶ - 概要編</a></li><li><a href=/posts/2023-03-26-2208/>現在 Lucene の KNN ベクトルの最大次元数は1024次元 だが、それを2048次元に変更できないかという議論</a></li><li><a href=/posts/2023-03-11-1727/>初心者だけど Apache Lucene に貢献したい場合におすすめのチケットラベル</a></li><li><a href=/posts/2021-11-26/>Amazonがeコマース検索を Lucene により、どうスケールさせているか at Berlin Buzzwords 2019</a></li><li><a href=/posts/2024-02-22-0032/>運用コストを低く抑えつつ全文検索機能を実現したい: SQLite3 で全文検索を実現する fts5 、ベクトル検索を実現する sqlite-vss</a></li></ul><br>📮 📧 🐏: 記事への<a href="https://docs.google.com/forms/d/e/1FAIpQLScgZVDrjQiKLbQRovfs88oweCITzjtvt1PlgwL14JfWPOrpPQ/viewform?usp=pp_url&entry.838298670=https%3a%2f%2fshunyaueta.com%2fposts%2f2024-03-05-2323%2f">感想</a>のおたよりをおまちしてます。
お気軽にお送りください。
メールアドレス入力があればメールで返信させていただきます。
もちろんお返事を希望せずに単なる感想だけでも大歓迎です。<br><br>このサイトの更新情報を<a href=/index.xml>RSS</a>で配信しています。
お好きなフィードリーダーで購読してみてください。<br><br>このウェブサイトの運営や著者の活動を支援していただける方を募集しています。
もしよろしければ、<a href=https://www.buymeacoffee.com/hurutoriya>Buy Me a Coffee</a> からサポート(投げ銭)していただけると、著者の活動のモチベーションに繋がります✨<br>Amazonで<a href=https://www.amazon.jp/hz/wishlist/ls/1Z8LPJGBMH1QK>ほしいものリスト</a>も公開しているので、こちらからもサポートしていただけると励みになります。<br><p><a href=https://shunyaueta.com/tags/lucene/>#lucene</a>
<a href=https://shunyaueta.com/tags/search/>#search</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>