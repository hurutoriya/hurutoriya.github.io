<!doctype html><html lang=ja><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Pythonã§å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦SQLã‚¯ã‚¨ãƒªã‚’æŸ”è»Ÿã«æ§‹ç¯‰ã™ã‚‹ | Shunya Ueta</title><meta name=title content="Pythonã§å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦SQLã‚¯ã‚¨ãƒªã‚’æŸ”è»Ÿã«æ§‹ç¯‰ã™ã‚‹"><meta name=description content="ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®ã‚¿ã‚¹ã‚¯ã‚’ã“ãªã—ã¦ã„ã‚‹ã¨ã€Python ã§ SQL ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—æŸ”è»Ÿã« SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ãŸããªã‚‹ã€‚
ä¾‹ãˆã°ã€
ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ãŸã‚ã« Airflow ãªã©ã§å®šæœŸçš„ãªã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã€SQL ã® createdã®æ™‚é–“ã‚’å½“æ—¥ã®ã‚‚ã®ã«å¤‰æ›´ã™ã‚‹ training, dev, test ã§ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã™ã‚‹éš›ã«ã€createdã®æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ ã®ã‚ˆã†ãªçŠ¶æ³ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚
å¤‰æ•°ã‚’ SQL ã«çµ„ã¿è¾¼ã‚“ã§å®Ÿè¡Œã—ãŸã„éš›ã«ã¯ã€kayak/pypikaã®ã‚ˆã†ãª SQL builder ã‚‚ã‚ã‚‹ãŒã€å€‹äººçš„ã«ã¯å¯èª­æ€§ãŒæ‚ªããªã‚‹ã—ã€SQL ã‚¯ã‚¨ãƒªã®ä½œæˆã®ãŸã‚ã ã‘ã«ä½™è¨ˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã„ã‚ŒãŸããªã„ã€‚
ãã®ãŸã‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¥ã‚Œãšã«ç°¡æ½”ãªã‚¯ã‚¨ãƒªæ§‹ç¯‰æ–¹æ³•ã‚’ã“ã“ã§ã¯ç´¹ä»‹ã™ã‚‹ã€‚
ç·¨é›†å±¥æ­´ 2021/05/12: twitter ã§ docstring ã§ã¯ãªã string literal ã§ã™ã‚ˆã¨ã„ã†æŒ‡æ‘˜ã‚’ã„ãŸã ãä¿®æ­£ ref 2021/05/12: twitter ã§ã®æ„è¦‹ã‚’åæ˜  1. å˜ãªã‚‹æ–‡å­—åˆ—ã¨ã—ã¦ SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ f-string ã§æ–‡å­—åˆ—ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦ã€SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹
def get_guery(num: int, category: str): sql=f&#34;SELECT field1, field2, field3, field4 FROM TABLE WHERE condition1={num} AND condition2={category}&#34; return sql æ¬ ç‚¹ SQL ãŒé•·ããªã‚‹ã¨ PEP8 ã«æº–æ‹ ã›ãšã€E501 line too longã«æŠµè§¦ã™ã‚‹ è¦–èªæ€§ãŒä½ãã€SQL ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œå†…å®¹ã‚’ç†è§£ã—ã¥ã‚‰ã„ 2."><meta name=keywords content="python,sql,"><meta property="og:title" content="Pythonã§å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦SQLã‚¯ã‚¨ãƒªã‚’æŸ”è»Ÿã«æ§‹ç¯‰ã™ã‚‹"><meta property="og:description" content="ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®ã‚¿ã‚¹ã‚¯ã‚’ã“ãªã—ã¦ã„ã‚‹ã¨ã€Python ã§ SQL ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—æŸ”è»Ÿã« SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ãŸããªã‚‹ã€‚
ä¾‹ãˆã°ã€
ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ãŸã‚ã« Airflow ãªã©ã§å®šæœŸçš„ãªã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã€SQL ã® createdã®æ™‚é–“ã‚’å½“æ—¥ã®ã‚‚ã®ã«å¤‰æ›´ã™ã‚‹ training, dev, test ã§ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã™ã‚‹éš›ã«ã€createdã®æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ ã®ã‚ˆã†ãªçŠ¶æ³ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚
å¤‰æ•°ã‚’ SQL ã«çµ„ã¿è¾¼ã‚“ã§å®Ÿè¡Œã—ãŸã„éš›ã«ã¯ã€kayak/pypikaã®ã‚ˆã†ãª SQL builder ã‚‚ã‚ã‚‹ãŒã€å€‹äººçš„ã«ã¯å¯èª­æ€§ãŒæ‚ªããªã‚‹ã—ã€SQL ã‚¯ã‚¨ãƒªã®ä½œæˆã®ãŸã‚ã ã‘ã«ä½™è¨ˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã„ã‚ŒãŸããªã„ã€‚
ãã®ãŸã‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¥ã‚Œãšã«ç°¡æ½”ãªã‚¯ã‚¨ãƒªæ§‹ç¯‰æ–¹æ³•ã‚’ã“ã“ã§ã¯ç´¹ä»‹ã™ã‚‹ã€‚
ç·¨é›†å±¥æ­´ 2021/05/12: twitter ã§ docstring ã§ã¯ãªã string literal ã§ã™ã‚ˆã¨ã„ã†æŒ‡æ‘˜ã‚’ã„ãŸã ãä¿®æ­£ ref 2021/05/12: twitter ã§ã®æ„è¦‹ã‚’åæ˜  1. å˜ãªã‚‹æ–‡å­—åˆ—ã¨ã—ã¦ SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ f-string ã§æ–‡å­—åˆ—ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦ã€SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹
def get_guery(num: int, category: str): sql=f&#34;SELECT field1, field2, field3, field4 FROM TABLE WHERE condition1={num} AND condition2={category}&#34; return sql æ¬ ç‚¹ SQL ãŒé•·ããªã‚‹ã¨ PEP8 ã«æº–æ‹ ã›ãšã€E501 line too longã«æŠµè§¦ã™ã‚‹ è¦–èªæ€§ãŒä½ãã€SQL ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œå†…å®¹ã‚’ç†è§£ã—ã¥ã‚‰ã„ 2."><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2021-04-29/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-29T22:52:25+09:00"><meta property="article:modified_time" content="2021-04-29T22:52:25+09:00"><meta property="og:site_name" content="Shunya Ueta"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="Pythonã§å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦SQLã‚¯ã‚¨ãƒªã‚’æŸ”è»Ÿã«æ§‹ç¯‰ã™ã‚‹"><meta name=twitter:description content="ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®ã‚¿ã‚¹ã‚¯ã‚’ã“ãªã—ã¦ã„ã‚‹ã¨ã€Python ã§ SQL ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—æŸ”è»Ÿã« SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ãŸããªã‚‹ã€‚
ä¾‹ãˆã°ã€
ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ãŸã‚ã« Airflow ãªã©ã§å®šæœŸçš„ãªã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã€SQL ã® createdã®æ™‚é–“ã‚’å½“æ—¥ã®ã‚‚ã®ã«å¤‰æ›´ã™ã‚‹ training, dev, test ã§ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã™ã‚‹éš›ã«ã€createdã®æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ ã®ã‚ˆã†ãªçŠ¶æ³ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚
å¤‰æ•°ã‚’ SQL ã«çµ„ã¿è¾¼ã‚“ã§å®Ÿè¡Œã—ãŸã„éš›ã«ã¯ã€kayak/pypikaã®ã‚ˆã†ãª SQL builder ã‚‚ã‚ã‚‹ãŒã€å€‹äººçš„ã«ã¯å¯èª­æ€§ãŒæ‚ªããªã‚‹ã—ã€SQL ã‚¯ã‚¨ãƒªã®ä½œæˆã®ãŸã‚ã ã‘ã«ä½™è¨ˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã„ã‚ŒãŸããªã„ã€‚
ãã®ãŸã‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¥ã‚Œãšã«ç°¡æ½”ãªã‚¯ã‚¨ãƒªæ§‹ç¯‰æ–¹æ³•ã‚’ã“ã“ã§ã¯ç´¹ä»‹ã™ã‚‹ã€‚
ç·¨é›†å±¥æ­´ 2021/05/12: twitter ã§ docstring ã§ã¯ãªã string literal ã§ã™ã‚ˆã¨ã„ã†æŒ‡æ‘˜ã‚’ã„ãŸã ãä¿®æ­£ ref 2021/05/12: twitter ã§ã®æ„è¦‹ã‚’åæ˜  1. å˜ãªã‚‹æ–‡å­—åˆ—ã¨ã—ã¦ SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ f-string ã§æ–‡å­—åˆ—ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦ã€SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹
def get_guery(num: int, category: str): sql=f&#34;SELECT field1, field2, field3, field4 FROM TABLE WHERE condition1={num} AND condition2={category}&#34; return sql æ¬ ç‚¹ SQL ãŒé•·ããªã‚‹ã¨ PEP8 ã«æº–æ‹ ã›ãšã€E501 line too longã«æŠµè§¦ã™ã‚‹ è¦–èªæ€§ãŒä½ãã€SQL ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œå†…å®¹ã‚’ç†è§£ã—ã¥ã‚‰ã„ 2."><meta itemprop=name content="Pythonã§å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦SQLã‚¯ã‚¨ãƒªã‚’æŸ”è»Ÿã«æ§‹ç¯‰ã™ã‚‹"><meta itemprop=description content="ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®ã‚¿ã‚¹ã‚¯ã‚’ã“ãªã—ã¦ã„ã‚‹ã¨ã€Python ã§ SQL ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—æŸ”è»Ÿã« SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ãŸããªã‚‹ã€‚
ä¾‹ãˆã°ã€
ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ãŸã‚ã« Airflow ãªã©ã§å®šæœŸçš„ãªã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã€SQL ã® createdã®æ™‚é–“ã‚’å½“æ—¥ã®ã‚‚ã®ã«å¤‰æ›´ã™ã‚‹ training, dev, test ã§ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã™ã‚‹éš›ã«ã€createdã®æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ ã®ã‚ˆã†ãªçŠ¶æ³ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚
å¤‰æ•°ã‚’ SQL ã«çµ„ã¿è¾¼ã‚“ã§å®Ÿè¡Œã—ãŸã„éš›ã«ã¯ã€kayak/pypikaã®ã‚ˆã†ãª SQL builder ã‚‚ã‚ã‚‹ãŒã€å€‹äººçš„ã«ã¯å¯èª­æ€§ãŒæ‚ªããªã‚‹ã—ã€SQL ã‚¯ã‚¨ãƒªã®ä½œæˆã®ãŸã‚ã ã‘ã«ä½™è¨ˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã„ã‚ŒãŸããªã„ã€‚
ãã®ãŸã‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¥ã‚Œãšã«ç°¡æ½”ãªã‚¯ã‚¨ãƒªæ§‹ç¯‰æ–¹æ³•ã‚’ã“ã“ã§ã¯ç´¹ä»‹ã™ã‚‹ã€‚
ç·¨é›†å±¥æ­´ 2021/05/12: twitter ã§ docstring ã§ã¯ãªã string literal ã§ã™ã‚ˆã¨ã„ã†æŒ‡æ‘˜ã‚’ã„ãŸã ãä¿®æ­£ ref 2021/05/12: twitter ã§ã®æ„è¦‹ã‚’åæ˜  1. å˜ãªã‚‹æ–‡å­—åˆ—ã¨ã—ã¦ SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ f-string ã§æ–‡å­—åˆ—ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦ã€SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹
def get_guery(num: int, category: str): sql=f&#34;SELECT field1, field2, field3, field4 FROM TABLE WHERE condition1={num} AND condition2={category}&#34; return sql æ¬ ç‚¹ SQL ãŒé•·ããªã‚‹ã¨ PEP8 ã«æº–æ‹ ã›ãšã€E501 line too longã«æŠµè§¦ã™ã‚‹ è¦–èªæ€§ãŒä½ãã€SQL ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œå†…å®¹ã‚’ç†è§£ã—ã¥ã‚‰ã„ 2."><meta itemprop=datePublished content="2021-04-29T22:52:25+09:00"><meta itemprop=dateModified content="2021-04-29T22:52:25+09:00"><meta itemprop=wordCount content="297"><meta itemprop=image content="https://shunyaueta.com/ogp.jpg"><meta itemprop=keywords content="python,sql,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-JMJRQJT0Q3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JMJRQJT0Q3")</script></head><body><header><a href=/ class=title><h2>Shunya Ueta</h2></a><nav><a href=/about/>è‘—è€…ã«ã¤ã„ã¦</a>
<a href=/index.xml>RSS</a></nav></header><main><h1>Pythonã§å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦SQLã‚¯ã‚¨ãƒªã‚’æŸ”è»Ÿã«æ§‹ç¯‰ã™ã‚‹</h1><p><i><time datetime=2021-04-29 pubdate>2021-04-29</time></i></p><content><p>ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®ã‚¿ã‚¹ã‚¯ã‚’ã“ãªã—ã¦ã„ã‚‹ã¨ã€Python ã§ SQL ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—æŸ”è»Ÿã« SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ãŸããªã‚‹ã€‚</p><p>ä¾‹ãˆã°ã€</p><ul><li>ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ãŸã‚ã« Airflow ãªã©ã§å®šæœŸçš„ãªã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã€SQL ã® <code>created</code>ã®æ™‚é–“ã‚’å½“æ—¥ã®ã‚‚ã®ã«å¤‰æ›´ã™ã‚‹</li><li><code>training</code>, <code>dev</code>, <code>test</code> ã§ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã™ã‚‹éš›ã«ã€<code>created</code>ã®æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹</li></ul><p>ã®ã‚ˆã†ãªçŠ¶æ³ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚</p><p>å¤‰æ•°ã‚’ SQL ã«çµ„ã¿è¾¼ã‚“ã§å®Ÿè¡Œã—ãŸã„éš›ã«ã¯ã€<a href=https://github.com/kayak/pypika>kayak/pypika</a>ã®ã‚ˆã†ãª SQL builder ã‚‚ã‚ã‚‹ãŒã€å€‹äººçš„ã«ã¯å¯èª­æ€§ãŒæ‚ªããªã‚‹ã—ã€SQL ã‚¯ã‚¨ãƒªã®ä½œæˆã®ãŸã‚ã ã‘ã«ä½™è¨ˆãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã„ã‚ŒãŸããªã„ã€‚</p><p>ãã®ãŸã‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¥ã‚Œãšã«ç°¡æ½”ãªã‚¯ã‚¨ãƒªæ§‹ç¯‰æ–¹æ³•ã‚’ã“ã“ã§ã¯ç´¹ä»‹ã™ã‚‹ã€‚</p><h2 id=ç·¨é›†å±¥æ­´>ç·¨é›†å±¥æ­´</h2><ul><li>2021/05/12: twitter ã§ docstring ã§ã¯ãªã string literal ã§ã™ã‚ˆã¨ã„ã†æŒ‡æ‘˜ã‚’ã„ãŸã ãä¿®æ­£ <a href=https://twitter.com/cocu_tan/status/1392481952662310925>ref</a></li><li>2021/05/12: twitter ã§ã®æ„è¦‹ã‚’åæ˜ </li></ul><h2 id=1-å˜ãªã‚‹æ–‡å­—åˆ—ã¨ã—ã¦-sql-ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰>1. å˜ãªã‚‹æ–‡å­—åˆ—ã¨ã—ã¦ SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰</h2><p>f-string ã§æ–‡å­—åˆ—ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦ã€SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_guery</span>(num: int, category: str):
</span></span><span style=display:flex><span>	sql<span style=color:#f92672>=</span><span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;SELECT field1, field2, field3, field4 FROM TABLE WHERE condition1=</span><span style=color:#e6db74>{</span>num<span style=color:#e6db74>}</span><span style=color:#e6db74> AND condition2=</span><span style=color:#e6db74>{</span>category<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> sql
</span></span></code></pre></div><h3 id=æ¬ ç‚¹>æ¬ ç‚¹</h3><ul><li>SQL ãŒé•·ããªã‚‹ã¨ PEP8 ã«æº–æ‹ ã›ãšã€<a href=https://www.flake8rules.com/rules/E501.html>E501 line too long</a>ã«æŠµè§¦ã™ã‚‹</li><li>è¦–èªæ€§ãŒä½ãã€SQL ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œå†…å®¹ã‚’ç†è§£ã—ã¥ã‚‰ã„</li></ul><h2 id=2-è¤‡æ•°è¡Œæ–‡å­—åˆ—ã¨ã—ã¦-sql-ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰>2. è¤‡æ•°è¡Œæ–‡å­—åˆ—ã¨ã—ã¦ SQL ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_guery</span>(num: int, category: str):
</span></span><span style=display:flex><span>    sql <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        SELECT field1, field2, field3, field4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        FROM table
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        WHERE condition1=</span><span style=color:#e6db74>{</span>num<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        AND condition2=</span><span style=color:#e6db74>{</span>category<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> sql
</span></span></code></pre></div><p>1 ç•ªç›®ã¨æ¯”è¼ƒã™ã‚‹ã¨ã€è¤‡æ•°è¡Œã‚’æ‰±ãˆã‚‹<a href=https://docs.python.org/3/reference/lexical_analysis.html#string-and-bytes-literals>string literal-longstring</a>ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã§ã€SQL ã‚¯ã‚¨ãƒªãŒè¤‡æ•°è¡Œã«ãªã‚‹ã“ã¨ã§ã§è¦‹ã‚„ã™ã„ (@cocu_tan ã•ã‚“ã€<a href=https://twitter.com/cocu_tan/status/1392481952662310925>ã”æŒ‡æ‘˜</a>ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™!)</p><h3 id=æ¬ ç‚¹-1>æ¬ ç‚¹</h3><ul><li>SQL æ§‹æ–‡ã«é–¢ã™ã‚‹ lint ã‚„ ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’æ´»ç”¨ã§ããªã„</li><li>SQL ã¸ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆãŒç„¡ã„ã®ã§ã€è¦–èªæ€§ãŒä½ã„</li></ul><h2 id=3-sql-ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–‡å­—åˆ—ã¨ã—ã¦èª­ã¿è¾¼ã¿-formatã§å¤‰æ•°ã‚’æŒ¿å…¥ã™ã‚‹>3. SQL ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–‡å­—åˆ—ã¨ã—ã¦èª­ã¿è¾¼ã¿ã€ <code>.format()</code>ã§å¤‰æ•°ã‚’æŒ¿å…¥ã™ã‚‹</h2><p>SQL ãƒ•ã‚¡ã‚¤ãƒ«ãŒ <code>./sql/test.sql</code> ã«è¨­ç½®ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã¨ã™ã‚‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql:test.sql data-lang=sql:test.sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  field1,
</span></span><span style=display:flex><span>  field2,
</span></span><span style=display:flex><span>  field3,
</span></span><span style=display:flex><span>  field4
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>TABLE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>  condition1<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>{</span>num<span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AND</span> condition2<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>{</span>category<span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><p>Python å´ã§ã®å®Ÿè£…ä¾‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_guery</span>(num: int, category: str, filename: str)<span style=color:#f92672>-&gt;</span>str:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    SQLãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ•°ã‚’æŒ¿å…¥ã—ã¦ã‚¯ã‚¨ãƒªã‚’ä½œæˆã™ã‚‹
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        num (int): å¹´é½¢
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        category (str): å¥½ããªæœç‰©
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        filename (str): SQLãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        str: SQLã‚¯ã‚¨ãƒª
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#34;./sql&#34;</span>, filename), <span style=color:#e6db74>&#34;r&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> f<span style=color:#f92672>.</span>read()<span style=color:#f92672>.</span>format(num<span style=color:#f92672>=</span>num, category<span style=color:#f92672>=</span>category)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(get_guery(num<span style=color:#f92672>=</span><span style=color:#ae81ff>18</span>, category<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple&#34;</span>, filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test.sql&#34;</span>))
</span></span></code></pre></div><p>å®Ÿè¡Œçµæœ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SELECT
</span></span><span style=display:flex><span>  field1,
</span></span><span style=display:flex><span>  field2,
</span></span><span style=display:flex><span>  field3,
</span></span><span style=display:flex><span>  field4
</span></span><span style=display:flex><span>FROM
</span></span><span style=display:flex><span>  TABLE
</span></span><span style=display:flex><span>WHERE
</span></span><span style=display:flex><span>  condition1<span style=color:#f92672>=</span><span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>  AND condition2<span style=color:#f92672>=</span>apple
</span></span></code></pre></div><ul><li>SQL ã‚¯ã‚¨ãƒªã‚’<code>SQL</code>ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã§ãã‚‹ã®ã§ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚„ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®æ©æµã‚’æ´»ç”¨ã§ãã‚‹ã€‚</li><li>ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ <code>.read()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã“ã¨ã§æ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã€‚ãã®ãŠã‹ã’ã§ã€SQL ãƒ•ã‚¡ã‚¤ãƒ«ã«<code>{var_1}</code>, <code>{var_2}</code> ã®ã‚ˆã†ãªå½¢å¼ã§ã€Python ä¸Šã®å¤‰æ•°ã‚’ SQL ã®æŒ¿å…¥ã—ã¦æŸ”è»Ÿã«ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰å¯èƒ½ã«ãªã‚‹ã€‚</li></ul><p>SQL ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã« Python ã® <code>.format()</code> è¨˜æ³•ã‚’äº‹å‰ã«åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒä»Šå›ã®ã‚³ãƒ„ã§ã™ã­ã€‚</p><h3 id=ä½™è«‡>ä½™è«‡</h3><p>SQL ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql:test.sql data-lang=sql:test.sql><span style=display:flex><span><span style=color:#75715e>-- {}ã®ä¸­ã«Pythonã‹ã‚‰å¤‰æ•°ãŒæŒ¿å…¥ã•ã‚Œã‚‹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  field1,
</span></span><span style=display:flex><span>  field2,
</span></span><span style=display:flex><span>  field3,
</span></span><span style=display:flex><span>  field4
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>TABLE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>  condition1<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>{</span>num<span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AND</span> condition2<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>{</span>category<span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><p>1 è¡Œç›®ã®ã‚ˆã†ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥ã‚Œã¦ã—ã¾ã†ã¨ã€SQL ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§ã¯ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è©•ä¾¡ã•ã‚Œã‚‹éƒ¨åˆ†ã‚‚ Pythn ã®æ–‡å­—åˆ—å†…ã§ã¯<code>.format()</code>ã®æŒ¿å…¥å¯¾è±¡ã¨ãªã‚‹ã€‚ãã®å½±éŸ¿ã§<code>.format()</code>ã§æŒ¿å…¥ã•ã‚Œã‚‹ã¹ãå¤‰æ•°ã®æ•°ãŒ 3 ã¤ã¨è©•ä¾¡ã•ã‚Œã€å®Ÿéš›ã®å¼•æ•°ã¯ 2 ã¤ã—ã‹ä¸ãˆã¦ãŠã‚‰ãšã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚
SQL ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¡ãƒ³ãƒˆã§ã‚ã‚ã†ã¨ã€<code>{}</code>ã¨è¨˜è¿°ã—ãªã„ã‚ˆã†ã«æ°—ã‚’ã¤ã‘ã¦ãŠãã¾ã—ã‚‡ã†ã€‚</p><h2 id=è¿½è¨˜>è¿½è¨˜</h2><p>Twitter ã§ã¿ã‚“ãªã®ç®¡ç†æ–¹æ³•ã‚’ãŠèãã§ããŸã®ã§ã€è¨˜ã—ã¦ãŠãã€‚
ã‚ã‚ŠãŒãŸã„ã€‚</p><h3 id=shuhei_fujiwara-ã•ã‚“>@shuhei_fujiwara ã•ã‚“</h3><blockquote><p>BigQuery ã®è©±ã ã‘ã©åƒ•ã¯</p><ul><li>ã»ã¨ã‚“ã©ã®å ´åˆ => parameterized query</li><li>æœ¬å½“ã«çŸ­ãã¦è‡ªæ˜ãªã‚¯ã‚¨ãƒª => 1 or 2</li><li>ã©ã†ã«ã‚‚ãªã‚‰ã‚“ã¨ã => 3
<a href=https://cloud.google.com/bigquery/docs/parameterized-queries>https://cloud.google.com/bigquery/docs/parameterized-queries</a>
3 ã¯ã‚ã‹ã‚‹ã‚“ã ã‘ã©ã€Python ã‚³ãƒ¼ãƒ‰ã§èª­ã¿è¾¼ã‚€å‰æã‚ˆã‚Šã¯ SQL ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½“ã§æˆç«‹ã—ã¦ã„ã‚‹æ–¹ãŒå¥½ããªã®ã§å¯èƒ½ãªã‚‰é¿ã‘ã¦ã¾ã™
<a href=https://twitter.com/shuhei_fujiwara/status/1387815866436243458>https://twitter.com/shuhei_fujiwara/status/1387815866436243458</a></li></ul></blockquote><p>å˜ä½“ã§æˆç«‹ã—ãŸã„æ°—æŒã¡ã€ãŸã—ã‹ã«åˆ†ã‹ã‚‹~</p><h3 id=satoshihirose-ã•ã‚“>@satoshihirose ã•ã‚“</h3><blockquote><p>Airflow ã®ã¿ã®è©±ã«ã¯ãªã£ã¦ã—ã¾ã„ã¾ã™ãŒã€sql ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç®¡ç†ã—ã¦åŸºæœ¬ jinja template å¯¾å¿œã®ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ä½¿ã£ã¦ã¾ã—ãŸã­ <a href=https://qiita.com/munaita_/items/6bdcfb10f36c8c6b4753>https://qiita.com/munaita_/items/6bdcfb10f36c8c6b4753</a> > <a href=https://twitter.com/satoshihirose/status/1387776005943840772>https://twitter.com/satoshihirose/status/1387776005943840772</a></p></blockquote><p>Airflow ã®ã¨ãã« jinja ä½¿ãˆã‚‹ã‚“ã§ã™ã­ã€‚ä»Šåº¦ã‹ã‚‰ä½¿ã„ã¾ã™!</p><h3 id=reto_nayuta-ã•ã‚“>@reto_nayuta ã•ã‚“</h3><blockquote><p>ç§ã‚‚ï¼ˆAirflow ã§ã¯ãªã„ã§ã™ãŒï¼‰jinja ä½¿ã†ã“ã¨ãŒå¤šã„ã§ã™ã­
<a href=https://twitter.com/reto_nayuta/status/1387801584512364544>https://twitter.com/reto_nayuta/status/1387801584512364544</a></p></blockquote><h3 id=sassahero-ã•ã‚“>@SassaHero ã•ã‚“</h3><blockquote><p>3 ã‚’ã€from string import Template ã§å¤‰æ•°ç½®ãæ›ãˆã‚’å®Ÿç¾ã—ã¦ã¾ã™ï¼
<a href=https://twitter.com/SassaHero/status/1387878168481075200>https://twitter.com/SassaHero/status/1387878168481075200</a></p></blockquote><p><code>from string import Template</code> çŸ¥ã‚‰ãªã‹ã£ãŸ</p><h2 id=ref>Ref</h2><ul><li><a href=https://stackoverflow.com/questions/5243596/python-sql-query-string-formatting>Python SQL query string formatting</a></li></ul></content><p><a href=https://shunyaueta.com/tags/python/>#python</a>
<a href=https://shunyaueta.com/tags/sql/>#sql</a></p>---<br>ğŸ“® ğŸ“§ ğŸ: è¨˜äº‹ã¸ã®<a href="https://docs.google.com/forms/d/e/1FAIpQLScgZVDrjQiKLbQRovfs88oweCITzjtvt1PlgwL14JfWPOrpPQ/viewform?usp=pp_url&entry.838298670=https%3a%2f%2fshunyaueta.com%2fposts%2f2021-04-29%2f">æ„Ÿæƒ³</a>ã®ãŠãŸã‚ˆã‚Šã‚’ãŠã¾ã¡ã—ã¦ã¾ã™ã€‚
ãŠæ°—è»½ã«ãŠé€ã‚Šãã ã•ã„ã€‚
ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›ãŒã‚ã‚Œã°ãƒ¡ãƒ¼ãƒ«ã§è¿”ä¿¡ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
ã‚‚ã¡ã‚ã‚“ãŠè¿”äº‹ã‚’å¸Œæœ›ã›ãšã«å˜ãªã‚‹æ„Ÿæƒ³ã ã‘ã§ã‚‚å¤§æ­“è¿ã§ã™ã€‚<br><br>ã“ã®ã‚µã‚¤ãƒˆã®æ›´æ–°æƒ…å ±ã‚’<a href=/index.xml>RSS</a>ã§é…ä¿¡ã—ã¦ã„ã¾ã™ã€‚
ãŠå¥½ããªãƒ•ã‚£ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§è³¼èª­ã—ã¦ã¿ã¦ãã ã•ã„ã€‚<br><br>ã“ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®é‹å–¶ã‚„è‘—è€…ã®æ´»å‹•ã‚’æ”¯æ´ã—ã¦ã„ãŸã ã‘ã‚‹æ–¹ã‚’å‹Ÿé›†ã—ã¦ã„ã¾ã™ã€‚<br>ã‚‚ã—ã‚ˆã‚ã—ã‘ã‚Œã°ã€<a href=https://www.buymeacoffee.com/hurutoriya>Buy Me a Coffee</a> ã‹ã‚‰ã‚µãƒãƒ¼ãƒˆ(æŠ•ã’éŠ­)ã—ã¦ã„ãŸã ã‘ã‚‹ã¨ã€è‘—è€…ã®æ´»å‹•ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã«ç¹‹ãŒã‚Šã¾ã™âœ¨<br>---<br><p>é–¢é€£ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„è¨˜äº‹</p><ul><li><a href=/posts/2021-03-13/>pipenv ã®version 2020.11.15 ã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæ­£å¸¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œãªã„ã¨ãã®å¯¾å‡¦æ³•</a></li><li><a href=/posts/2021-02-09/>Standard SQLã§ åˆ—ã¨åˆ—ã®çµ„ã¿åˆã‚ã›ã®æ•°ã‚’é›†è¨ˆã—ãŸã„</a></li><li><a href=/posts/2021-02-08/>pip å®Ÿè¡Œæ™‚ã« sys.stderr.write(f"ERROR: {exc} ") ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦pipã‚’å®Ÿè¡Œã§ããªã„ã¨ãã®å¯¾å‡¦æ–¹æ³•</a></li><li><a href=/posts/2020-12-26/>Pythonã§Apache beam å…¥é–€</a></li><li><a href=/posts/2020-09-09/>pandas ã‚’ä½¿ã£ã¦ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦é€£çµã—ã¦ä¸€ã¤ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</a></li></ul></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a></footer></body></html>