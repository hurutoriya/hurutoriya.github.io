<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>gRPC client evans で portforward 先のリモートサーバーにリクエストを行う | Shunya Ueta</title><link rel=stylesheet href=/sass/main.min.1a3290acca8b3fc92df85ea9200859476d6c80d59009c89a749300f3ce7a7a67.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-39994406-11','auto');ga('send','pageview');}</script><meta property="og:title" content="gRPC client evans で portforward 先のリモートサーバーにリクエストを行う"><meta property="og:description" content="evans
evans は対象のサーバーのgRPC のリフレクション機能が起動されていれば、proto ファイルを参照せずに便利な [REPL mode](gRPC のリフレクション機能) を使用できます。
 If your server is enabling gRPC reflection, you can launch Evans with only -r (&ndash;reflection) option.
 gRPC のリフレクション機能については evans 作者の ktr0731さんが解説している記事が非常にわかりやすいです。
gRPC リフレクションはなにをしているか？
ローカルの5000 番のポートをリモートサーバの5000番ポートにフォワード (port-forward)しているとします。 例えば、kubectl だと以下のような実行コマンドになります。
Forward a local port to a port on the Pod
1  kubectl port-forward pods/hoge-asas32s 5000:5000   そして、ポートフォワードのシェルは保持した上で、別にシェルを起動します。
この際に 対象となるlocalhost:5000 に対して、--host, --port オプションで指定してやれば evans のREPLモードが起動します。
REPL 1 2 3 4 5 6 7 8 9 10 11  > evans -r --host localhost --port 5000 ______ | ____| | |__ __ __ __ _ _ __ ___ | __| \ \ / / / _."><meta property="og:type" content="article"><meta property="og:url" content="https://shunyaueta.com/posts/2021-08-19/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="article:published_time" content="2021-08-19T16:51:05+09:00"><meta property="article:modified_time" content="2021-11-29T11:07:28+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="gRPC client evans で portforward 先のリモートサーバーにリクエストを行う"><meta name=twitter:description content="evans
evans は対象のサーバーのgRPC のリフレクション機能が起動されていれば、proto ファイルを参照せずに便利な [REPL mode](gRPC のリフレクション機能) を使用できます。
 If your server is enabling gRPC reflection, you can launch Evans with only -r (&ndash;reflection) option.
 gRPC のリフレクション機能については evans 作者の ktr0731さんが解説している記事が非常にわかりやすいです。
gRPC リフレクションはなにをしているか？
ローカルの5000 番のポートをリモートサーバの5000番ポートにフォワード (port-forward)しているとします。 例えば、kubectl だと以下のような実行コマンドになります。
Forward a local port to a port on the Pod
1  kubectl port-forward pods/hoge-asas32s 5000:5000   そして、ポートフォワードのシェルは保持した上で、別にシェルを起動します。
この際に 対象となるlocalhost:5000 に対して、--host, --port オプションで指定してやれば evans のREPLモードが起動します。
REPL 1 2 3 4 5 6 7 8 9 10 11  > evans -r --host localhost --port 5000 ______ | ____| | |__ __ __ __ _ _ __ ___ | __| \ \ / / / _."></head><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/><span class=emoji>🦅</span>
Shunya Ueta</a></div><div class=flex><a href=/articles/>All posts</a>
<button id=dark-mode-button></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>gRPC client evans で portforward 先のリモートサーバーにリクエストを行う</h1><div class=post-meta><div>By Shunya Ueta on <time>2021.08.19</time> (Last updated:<time>2021.11.29</time>)</div><div class=tags><a href=/tags/grpc/>grpc</a></div></div></div></div></header></article><div class=article-post><p><a href=https://github.com/ktr0731/evans>evans</a></p><p>evans は対象のサーバーのgRPC のリフレクション機能が起動されていれば、proto ファイルを参照せずに便利な [REPL mode](gRPC のリフレクション機能) を使用できます。</p><blockquote><p>If your server is enabling gRPC reflection, you can launch Evans with only -r (&ndash;reflection) option.</p></blockquote><p>gRPC のリフレクション機能については evans 作者の ktr0731さんが解説している記事が非常にわかりやすいです。</p><p><a href=https://syfm.hatenablog.com/entry/2020/06/23/235952>gRPC リフレクションはなにをしているか？</a></p><p>ローカルの5000 番のポートをリモートサーバの5000番ポートにフォワード (port-forward)しているとします。
例えば、<code>kubectl</code> だと以下のような実行コマンドになります。</p><p><a href=https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#forward-a-local-port-to-a-port-on-the-pod>Forward a local port to a port on the Pod</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>kubectl port-forward pods/hoge-asas32s 5000:5000
</code></pre></td></tr></table></div></div><p>そして、ポートフォワードのシェルは保持した上で、別にシェルを起動します。</p><p>この際に 対象となる<code>localhost:5000</code> に対して、<code>--host</code>, <code>--port</code> オプションで指定してやれば evans のREPLモードが起動します。</p><h2 id=repl>REPL</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>&gt; evans  -r --host localhost --port <span class=m>5000</span>

  ______
 <span class=p>|</span>  ____<span class=p>|</span>
 <span class=p>|</span> <span class=p>|</span>__    __   __   __ _   _ __    ___
 <span class=p>|</span>  __<span class=p>|</span>   <span class=se>\ \ </span>/ /  / _. <span class=p>|</span> <span class=p>|</span> <span class=err>&#39;</span>_ <span class=se>\ </span> / __<span class=p>|</span>
 <span class=p>|</span> <span class=p>|</span>____   <span class=se>\ </span>V /  <span class=p>|</span> <span class=o>(</span>_<span class=p>|</span> <span class=p>|</span> <span class=p>|</span> <span class=p>|</span> <span class=p>|</span> <span class=p>|</span> <span class=se>\_</span>_ <span class=se>\
</span><span class=se></span> <span class=p>|</span>______<span class=p>|</span>   <span class=se>\_</span>/    <span class=se>\_</span>_,_<span class=p>|</span> <span class=p>|</span>_<span class=p>|</span> <span class=p>|</span>_<span class=p>|</span> <span class=p>|</span>___/

 more expressive universal gRPC client

</code></pre></td></tr></table></div></div><h2 id=cli>CLI</h2><p>CLI は cli というサブコマンドを追記するだけで起動できます。
シェル変数などを使って実行したい場合は、こちらが便利です。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>evans  -r --host localhost --port <span class=m>5000</span> cli list
</code></pre></td></tr></table></div></div><p>evans で快適な gRPC ライフを楽しみましょう。</p></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/posts/2021-08-13/ title="Previous post (older)"><span>Previous</span>
システムの応答速度は本質的な価値提供であることを示す A/B テストの実例</a>
<a rel=next href=/posts/2021-09-07/ title="Next post (newer)"><span>Next</span>
gcloud commands で PubSub に jsonファイルをメッセージとして公開 (Pusblish) する</a></nav></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/index.xml>RSS</a></nav></section><script async src=/js/features.min.a94f58a30ad2560de728e080d87f75c60cf806fd1b3d5f4815f1a1a02c0d1859.js></script></footer></body></html>