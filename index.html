<!doctype html><html><head><meta name=generator content="Hugo 0.67.1"><script data-ad-client=ca-pub-8604812913439531 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>hurutoriya | Home</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:image" content><link rel=alternate type=application/rss+xml href=https://shunyaueta.com/index.xml title=hurutoriya><meta property="og:title" content="hurutoriya"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://shunyaueta.com/"><meta property="og:updated_time" content="2019-06-15T19:25:33+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="hurutoriya"><meta name=twitter:description content><script src=https://shunyaueta.com/js/feather.min.js></script><link href=https://shunyaueta.com/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://shunyaueta.com/css/main.css><link rel=stylesheet type=text/css href=https://shunyaueta.com/css/dark.css media="(prefers-color-scheme: dark)"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-39994406-11"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-39994406-11');</script></head><body><div class=content><header><div class=main><a href=https://shunyaueta.com/>hurutoriya</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main class=list><div class=site-description></div><section class=list-item><h1 class=title><a href=/posts/2021-03-13/>pipenv でローカルパッケージが正常にインストールされないときの対処法</a></h1><time>Mar 13, 2021</time><br><div class=description>TL; DR; pip install pipenv==2018.11.26 をすれば直った!!!!! 実行環境 $pipenv --version pipenv, version 2020.11.15 直面した問題 ./app/ ├── model │ └── setup.py └── serving └── Pipfile のような構成で、modelというローカルパッケージを作成しており、serving 直下のPipfile は、model を読み込んでsetup.py に記述されている依存パッケージもインストールするようにしたい。
serving ディレクトリで、以下のコマンドを入力すればローカルパッケージがpipenv によりインストールされるはずだが
pipenv install --editable ../model 依存関係をすべて記述するはずのPipenv.lock には、modelのパスのみが記述され、ローカルパッケージが要求する依存パッケージが記述されていない。
原因を探してみたところ、
Installing a local package with pipenv install &lsquo;-e .&rsquo; doesn&rsquo;t save dependencies #1024
同じ GitHub issue を発見しダメ元で pipenv を以下のコマンドでダウングレードして見たところ
pip install pipenv==2018.11.26 なんと&mldr;. 直った。無事にローカルパッケージの依存パッケージが Pipenv.lock に記述されており、無事にローカルパッケージがserving 直下で動くようになった。
後方互換性が無いとかそんなちゃちな問題ではない気がするのだが、この問題でかなり時間が溶けたので非常に精神的に消耗した。
思えばこういう問題が多くて、普段はpoetry を使っていたのを思い出した。&mldr;</div><a href=/posts/2021-03-13/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2021-03-05/>2021年の目標</a></h1><time>Mar 5, 2021</time><br><div class=description>ちょっと遅れましたが、最近これからどうするかについて色々と考えていて、その過程で2021年をどう過ごすかが決まったのでメモ。
3つの目標 Senior Software Engineer として確固たる実力を身につけることに集中 英語にふれることを習慣化 SNSを断ち自分にとって後悔の無い時間を歩む Senior Software Engineer として確固たる実力を身につけることに集中 まず Senior Software Engineer と自分で胸を張って宣言できる実力を身につける。
最近は自分のキャリアを専門性を深堀りしていくとして、Software Engineer としての道を進んでいくことを決めた。
上記の理由として自分はData Scientist になれるほど専門性は無いと思っている。Ph.D は持っていないし、再び博士課程に行くとしても研究は辛い。またMachine Learning Engineerや Data Scientist に特化していっても将来30年間働いていく中でそれらのレッドオーシャンで自分が生き抜いていけるとは思えない。 Software Engineer という職に飽きるまではProduct Manager のキャリアも考えなくていいと思った。その葛藤を同僚の人にも相談したが、輝かしい経歴(アメリカの有名大学でCS専攻→SWE→PMと天上人)の人でも、手を動かせなくなることに焦りを感じるよとおっしゃられていて非常に共感した。
何よりも今の会社に入社して 3年間働いてきた経験で身に染みたのは、Software Engineer という職業が楽しいなと思えた。もちろんデータ分析や機械学習などにも楽しさがあるが、それらを最大限レバレッジをきかせるためにはSoftware Enginner としてのスキルが必須であり、最終的に物事を実現するためも避けて通れないと考えている。
2020/03 からは新しいキャリアを見据えて少し方向転換をしてみることした。機械学習やデータ分析領域からは離れないが、チームが変わって扱う領域も異なるので非常に楽しみだ。弱くてニューゲームを楽しもう
英語にふれることを習慣化 最近親しい人と雑談する際に言葉に出すようにしているんですが、国外で働くことに憧れを持っています。業務でも英語を使ったコミュニケーションはムラがあるが4-7割ほどになっている。今の段階はコミュニケーションはできるが、細かいミスや相手にネイティブレベルのスピードで喋られると脳みそがストップして働くのをやめてしまうのでなんとかしたい。社内の語学学習強化トレーナーの人に相談したところ、やはり毎日時間を積み重ねていくしかないと言われたので、今の気合でしゃべる英会話から自分でも自信を持てる英語の力を持っていきたいなと思っている。
SNSを断ち自分にとって後悔の無い時間を歩む これは自戒なのですが、何気なくボーッとしてSNSを見たりする時間が多く、学生の頃にあったひたむきに何かを学び積み重ねていくという習慣が消え去ってます。やばい。集中力も継続できないしで焦燥感だけが高まり行動ができていないという悪循環です。
人生を楽しむためにも、貴重な時間を自分自身に自信を持って過ごせるように後悔のない時間を歩んでいきたい。
これらの目標は toggl で追跡しておいて、毎月どれくらいの時間を費やせたかを振り替えれるようにする 学び続けるということを習慣化したいので、学びの内容が可視化されるように、これからは学んだことを文章化して気軽にBlog記事としてアウトプットしていく &mldr;</div><a href=/posts/2021-03-05/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2021-03-03/>GKE 上でPythonで logger.info() を行うとCloud logging では stderr に保存され、すべてエラーになるときの対処法</a></h1><time>Mar 3, 2021</time><br><div class=description>Python のアプリケーションで、Cloud logger にログを出力したいときに
標準のPython logging モジュールを利用して、ログを出力する Python Cloud Logging package を使用する 上記の２つの方法があります。
不必要にパッケージを増やしたくはないので、1の標準モジュールでCloud Logger へ出力できないか試してみました。
標準のPython logging モジュールを試す 標準のlogging モジュールでログを出力したいときに
import logging logger = logging.getLogger(__name__) def hoge(): logger.info('logging Start 2021') と、logging.info() を仕込んで、Cloud logger にログを出力してみると、logger.info() で出しているはずなのに、Cloud logger 上ではすべてエラーとして扱われてしまっています。
原因を特定するために、logger のログを見てみると logger.info() がすべて stderr標準エラーストリームへ出力されてしまっています。
{ "textPayload": "2021-02-20 21:26:51,012 - root:predict:36 - INFO: logging Start\n", ... }, "timestamp": "2021-02-20T12:26:51.013213826Z", "severity": "ERROR", "labels": { ... }, "logName": "projects/.../logs/stderr", "receiveTimestamp": "2021-02-20T12:26:55.050911180Z" } そのため、明示的に標準出力へ出力先を変更してみました。&mldr;</div><a href=/posts/2021-03-03/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2021-02-21/>GKE でローリングアップデート後、ローカルからポートフォワードでリクエストを投げるとcurl: (52) Empty reply from server と返ってくるときの対処方法</a></h1><time>Feb 21, 2021</time><br><div class=description>前提 ローカルからkubectlでポートフォワードして、GKEにリクエストを投げて確認を行っている
発生した問題 deployment のローリングアップデート前は問題なくポートフォワードを通してリクエストが返っていた。コードに変更を加えてGKE上でも確認をしたかったので、まずローカルで確認をして問題がなかった変更が、ローリングアップデート後ポートフォワード でGKE にリクエストを投げると curl: (52) Empty reply from server と返ってくる。
TL; DR; ポートフォワードはrolling update が終わったら貼り直そう。なぜなら、ポートフォワードの接続先はローリングアップデート前後で変化するため。 エラーメッセージ curl でリクエストした際のメッセージ
curl: (52) Empty reply from server Port foward の出力
uid : Error: No such container: xxxxx まとめ 発生していた問題は、ローリングアップデートを行うと、ポートフォワードの接続先が変更され、その際にローリングアップデート前後でkubectl でのポートフォワードは固定されたままなのでリクエストはサーバーから返ってこないという説明するのも恥ずかしい問題でした。
理由は単純だけど、気づくのに時間がかかってしまった。k8s の動きを理解していないからこういうので時間を溶かしてしまった。反省
Appendix Performing a Rolling Update &mldr;</div><a href=/posts/2021-02-21/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2021-02-09/>Standard SQLで 列と列の組み合わせの数を集計したい</a></h1><time>Feb 9, 2021</time><br><div class=description>group by は集計作業において根幹となる処理ですが、少し手の混んだ集計をしたいときに毎回調べていることが多かったのでここに学んだことをまとめておく
今回やりたいことは
A列がαになっている行のB列の種類を集計したい
です。
はじめに 実際のデータを用意したほうが、理解が深まるので擬似的なテーブルを作成する。 テーブルのデータの概略として、何日にsender (送信者) が receiver (受信者) にいくら送金(price)したかを格納しているテーブルとする。
StandardSQLはWITHを使って簡単にモックテーブルを作れるのが良いところ。
#standardSQL WITH `transactions` AS ( SELECT 'A' AS sender, 'B' AS receiver, 600 AS price, '2020-01-01' AS day UNION ALL SELECT 'A', 'B', 1200, '2020-01-01' UNION ALL SELECT 'A', 'B', 600, '2020-01-01' UNION ALL SELECT 'A', 'C', 2000, '2020-01-01' UNION ALL SELECT 'A', 'D', 3000, '2020-01-01' UNION ALL SELECT 'A', 'D', 2000, '2020-01-01' UNION ALL SELECT 'B', 'C', 700, '2020-01-01' UNION ALL SELECT 'B', 'C', 300, '2020-01-01' UNION ALL SELECT 'B', 'D', 250, '2020-01-01' UNION ALL SELECT 'A', 'B', 400, '2020-01-02' UNION ALL SELECT 'A', 'B', 1000, '2020-01-02' UNION ALL SELECT 'A', 'B', 1200, '2020-01-02' UNION ALL SELECT 'A', 'B', 2000, '2020-01-02' UNION ALL SELECT 'B', 'C', 450, '2020-01-02' UNION ALL SELECT 'B', 'C', 500, '2020-01-02' ) SELECT * FROM transactions sender receiver price day A B 600 2020-01-01 A B 1200 2020-01-01 A B 1800 2020-01-01 A C 2000 2020-01-01 A D 3000 2020-01-01 A D 2000 2020-01-01 B C 700 2020-01-01 B C 300 2020-01-01 B D 250 2020-01-01 A B 400 2020-01-02 A B 1000 2020-01-02 A B 1200 2020-01-02 A B 2000 2020-01-02 B C 450 2020-01-02 B C 500 2020-01-02 列と列の組み合わせの数を集計する 日次ごとに送金者が何人に送ったかを集計したい、つまり(sender, receiver)のペアを考えて、sender を固定した上で何人に送金したいかを集計したとする。 上記のデータだと&mldr;</div><a href=/posts/2021-02-09/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2021-02-08/>pip 実行時に sys.stderr.write(f"ERROR: {exc} ") とエラーが出てpipを実行できないときの対処方法</a></h1><time>Feb 8, 2021</time><br><div class=description>新しいマシンでpipをセットアップして実行しようとすると
>> pip Traceback (most recent call last): File "/usr/local/bin/pip", line 11, in &lt;module> load_entry_point('pip==21.0', 'console_scripts', 'pip')() File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/pkg_resources/__init__.py", line 489, in load_entry_point return get_distribution(dist).load_entry_point(group, name) File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/pkg_resources/__init__.py", line 2843, in load_entry_point return ep.load() File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/pkg_resources/__init__.py", line 2434, in load return self.resolve() File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/pkg_resources/__init__.py", line 2440, in resolve module = __import__(self.module_name, fromlist=['__name__'], level=0) File "/Library/Python/2.7/site-packages/pip-21.0-py2.7.egg/pip/_internal/cli/main.py", line 60 sys.stderr.write(f"ERROR: {exc}") というエラーが出た。
デフォルトのPython の実行ランタイムが2.x 系なのでそれに起因するエラーだった。 pipをPython2系でおそらくインストールしており、pip21に更新後はPython3.6 からの機能であるf-stringが利用され始めたことが起因。
対処方法 既存のpipを削除した上で、
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.&mldr;</div><a href=/posts/2021-02-08/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2021-01-17/>抄訳 Towards ML Engineering: A Brief History Of TensorFlow Extended (TFX)</a></h1><time>Jan 17, 2021</time><br><div class=description>この記事はMLOps Advent Calendar 2020の25日目の記事です。(盛大に遅れました)
KDD2019の招待講演でGoogleがTFXの歴史について発表されており、TFX信者の自分としては発表内容が以前から気になっていたが、公開はされておらずなんとかして見れないかな~と思っていましたが、TensorFlowのBlogで該当の招待講演が論文化されたことを知ったのでメモがてら抄訳として残しておく。
注意)この翻訳記事は原著論文の著者陣からレビューはされていません Shunya Ueta, are providing a translation and abridgment, which has not been reviewed by the authors. Citation Karmarkar, A., Altay, A., Zaks, A., Polyzotis, N., Ramesh, A., Mathes, B., … & Li, Z. (2020). Towards ML Engineering: A Brief History Of TensorFlow Extended (TFX). arXiv preprint arXiv:2010.02013. ***
Towards ML Engineering with TensorFlow Extended (TFX) at KDD2019 Towards ML Engineering with TensorFlow Extended (TFX) ACM PDFはarxiv でも閲覧可能 https://arxiv.&mldr;</div><a href=/posts/2021-01-17/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2020-12-26/>Apache beam 入門</a></h1><time>Dec 26, 2020</time><br><div class=description>TensorFlowの勉強をしていたら、Apache beam を前処理に採用していたケースがあり、興味を持ったので深堀りしてみます。
興味が湧いたモチベーションとしては、
データ量が増加しても前処理部分を難なくスケールできそう(前処理部分をスケールさせて高速に実験を回したい、並列化などはすべて良い感じにbeamに任せれそう バッチとストリーミングの両者に対応可能なので、柔軟な機械学習の推論サービスが提供できるのでは? (GCPの参考資料 Data preprocessing for machine learning: options and recommendations) Apache beam を触りつつ分散データ処理を学びたい https://github.com/jhuangtw/xg2xg#services
を見てみるとGoogle 内部のFlume という並列データパイプライン技術がApache beam として公開されているみたいです。
Apache beam について端的に説明すると
Apache beam は3つの考えを基礎にしています。
Unified ストリーミング、バッチの両者のケースに一つのプログラミングモデルで対応可能な統一性 Portable 実行パイプラインが複数の実行環境で実行可能な可搬性 Extensible 新しいSDK、IO Connectorsや変換ライブラリなどをを書いて共有することができる拡張性 Java, Python, Go やScalaを使ってBeam Model を作成して任意のruntime で実行する流れです。
自分はPythonが一眼手軽に書けるのでこの記事ではPythonで紹介していきます。
Version 2.14.0 からPython 3がサポートされたのは非常にありがたいですね。それまではPython 2のみをサポートしており、その影響で技術選定時に採用しづらかったのでは無いのでしょうか?
Spotify が作成しているApach BeamとDataflowのScala APIであるscioが開発されており、そちらも気になっています。
https://github.com/spotify/scio https://engineering.&mldr;</div><a href=/posts/2020-12-26/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2020-09-27/>機械学習・ソフトウェアエンジニアリングをテーマにしたPodcast just4fun.fm を始めてみた</a></h1><time>Sep 27, 2020</time><br><div class=description>機械学習エンジニアをしている hurutoriya が機械学習、Software Engineering 周りに関する学んだことなど最近楽しいと思っていることを発信していくPodcast です
扱うトピックとしては、普段学んだ機械学習、ソフトウェアエンジニアリング、読んだ論文やデータ分析などについて扱っていきます。 もし、ご興味あれば購読お願いします。主要なPodcast Platformで購読可能です。
just4fun.fm Google Podcasts Apple Podcasts Pocket Casts ご感想などは Twitter ハッシュタグ #just4funfm でお待ちしております
なぜ Podcast なのか？ 以前からPodcastは日常的に聴いていて、自分の中でもすごく好きなメディアのうちの一つです。 前からやってみようかなと思っていたんですが、周りの人たちがPodcastを始めたのを機によし自分もやるかと始めてみました
Blogと比べてみると、
ブログ書くよりかはサラッと配信できる、音声で配信するのも新鮮で面白い その代わり、換気扇とかの音が気になり音源環境とかはめちゃくちゃ気を使う 発表レベルの構造化したトークよりも雑談レベルでワイワイするほうがPodcastは向いてる感じはする。前者だと準備やらなんやらで公開できずに死の谷に落ちそう 喋っているうちに思考が洗練されていくので、あまり気負いすぎずに喋りたい事を発信していくのが良さそう しばらく試験的に続けていきたいと思います。
Anchor 凄い AnchorでPodcastを始めると、自動的にAppole Podcast, Google Podcast, Pocket CastなどPodcastのプラットフォームに自動配信される。 Google Podcastは、配信開始と通知が来ても実際は2-3日後に視聴可能になると問い合わせたら返信がきた Support here. Sorry for the confusion with your podcast on Google. Allow me to explain this to you.&mldr;</div><a href=/posts/2020-09-27/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=/posts/2020-09-21/>自分なりの機械学習エンジニアスキル構成論</a></h1><time>Sep 21, 2020</time><br><div class=description>機械学習エンジニアとして働き始めて2年7ヶ月が経過した。
機械学習エンジニアというロールは会社によって期待される内容が異なってくるが、今の会社で働いてきた経験に基づき自分の中の機械学習エンジニアスキル構成論を整理してみる。
TL; DR 人によって考える理想のスキル論は違うので他の人の持論を聞いてみたい テクいことをやりたい気持ちはあるが、地道なやるべきことがたくさんあるのがこの世界 自分の中で機械学習エンジニアにとって大事なスキル Software Engineer 40% 機械学習サービス実装スキル Product Manager 30% 機械学習プロジェクト自体を成功に導くスキル Data Scientist 30% データに基づき、意思決定し改善していくスキル Machine Learning Engineer as Software Engineer なぜSWEの比率が一番上なのか？
どれだけ良いモデルができたとしてもそれが活用されるシステムがなければ成果を出せないからです
データを活用してインパクトの大きい課題を解決するための、サービスを実装して、運用して改善していく どの方法がベストか考えた上で、それを実現していく 例えば、R&Dスタイルでモデル開発と実装者を完全に分ける組織構造もあると思いますが、このスタイルはいろんな会社のお話を聞く限りは、組織構造がよほど洗練されていないとうまく稼働しないじゃないかなと思っている
Full Cycle Developers at Netflixでは、システム開発のライフサイクルである
design, development, test, deploy, operate, support
を1チームが一気通貫で責任を持つスタイルをNetflixが提唱している。
今所属している会社もMicro Serviceでの開発に注力していて、まさにFull Cycleスタイルで機械学習サービス開発を行っている。 個人的に機械学習プロジェクトとこの方式の相性の良いところは、例えば、職能ごとにモデル開発、システム開発と運用を行うメンバーを分割すると、
モデルを作ってデプロイはしたが運用は他人任せになってしまい継続的な改善が回しづらい 役割が分離されていることで、モデルの詳細を完全に把握できないので実際のトラブル発生時に対応が困難 運用を考えてモデルがデザインされていないので運用者にしわ寄せがくる などアンチパターンが数多く存在する
Micro Serviceでの開発は上記の課題を解決して、作って終わりではなく自分たちでシステムデザインからサポートまで行うことで、そのサービスの継続的な改善に責任と自由を手にして開発することできる また、プロジェクトデザインの段階からシステム開発・運用を念頭に動くことができるので、やってみてうまく動かないなどの不確実性を大きく減少させる&mldr;</div><a href=/posts/2020-09-21/>Read more ⟶</a></section><ul class=pagination><span class="page-item page-prev"></span><span class="page-item page-next"><a href=/page/2/ class=page-link aria-label=Next><span aria-hidden=true>Next →</span></a></span></ul></main><footer><hr><a class=soc href=https://github.com/hurutoriya title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/hurutoriya/ title=Twitter><i data-feather=twitter></i></a>|⚡️
2021 © Shunya Ueta | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>