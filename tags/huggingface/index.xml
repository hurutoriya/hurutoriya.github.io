<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>huggingface on hurutoriya</title><link>https://shunyaueta.com/tags/huggingface/</link><description>Recent content in huggingface on hurutoriya</description><image><url>https://shunyaueta.com/ogp.jpg</url><link>https://shunyaueta.com/ogp.jpg</link></image><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Sun, 23 Oct 2022 23:44:13 +0900</lastBuildDate><atom:link href="https://shunyaueta.com/tags/huggingface/index.xml" rel="self" type="application/rss+xml"/><item><title>Elasticsearchの近似近傍探索を使って、ドラえもんのひみつ道具検索エンジンを作ってみた</title><link>https://shunyaueta.com/posts/2022-10-23-2344/</link><pubDate>Sun, 23 Oct 2022 23:44:13 +0900</pubDate><guid>https://shunyaueta.com/posts/2022-10-23-2344/</guid><description>Elasticsearch 8 系から使用可能になった近似近傍探索1を使って、ドラえもんのひみつ道具の自然言語検索ができる検索エンジンを作ってみた。
デモ動画のように、検索したいひみつ道具を説明する文章することで近しいひみつ道具が検索されます。
コードは GitHub に公開してあるので、興味のある方は手元で、動かして遊ぶことが出来ます。 poetry と Docker さえあれば動くようになっています。
hurutoriya/doraemon-himitsu-dogu-search: Doraemon Himitsu Dogu Japanese semantic search based on Elascticsearch ANN
システムの概要図はこんな感じ
所感 ドラえもんのひみつ道具のデータセットを今回１から作ったが、パースと前処理がめんどくさくてここが一番手間がかかった。が、工夫しないと出来なかったので、一番楽しいところでもあった。 文章の特徴抽出は、sonoisa/sentence-bert-base-ja-mean-tokens-v2 · Hugging Faceを使わせていただき、驚くほど簡単に実現できた。 実際はもっと精度を高めるには、fine tune などがいいのだろうが、システム側を作ることに注力したかったので今回は割愛 デモアプリの構築は streamlit を使って 20m くらいで作れたので、相変わらず便利すぎて愛用している。今回の検索エンジンは CLI から実行もできるが、こうやってデモアプリがあったほうがそれっぽくて気持ちいい。 インデキシング時にトーカナイザーのことなど全く考えずに特徴ベクトルだけインデキシングして、それで検索が成り立つというのは新鮮。閾値設定しなければゼロヒット問題にも直面しないので、できることの幅は広がりそう。 Elasticsearch の近似近傍探索は、今回ベクトル同士の近似近傍探索しかやっていないが、それもインデキシング、クエリ部分は公式ドキュメントを見れば事足りたので変にハマることはなかった。 クエリ部分はこれだけで書けた。
1 2 3 4 5 6 7 8 9 10 query = { &amp;#34;knn&amp;#34;: { &amp;#34;field&amp;#34;: &amp;#34;vector&amp;#34;, &amp;#34;query_vector&amp;#34;: sentence_embeddings[0], &amp;#34;k&amp;#34;: 10, &amp;#34;num_candidates&amp;#34;: 100, }, &amp;#34;fields&amp;#34;: [&amp;#34;name&amp;#34;, &amp;#34;description&amp;#34;], } result = es.</description></item></channel></rss>