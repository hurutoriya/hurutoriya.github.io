<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>gcp | ğŸ¦… hurutoriya</title><meta name=keywords content><meta name=description content="Shunya Ueta's blog"><meta name=author content="Shunya Ueta"><link rel=canonical href=https://shunyaueta.com/tags/gcp/><link crossorigin=anonymous href=/assets/css/stylesheet.min.e21185e6c4b43ff34c81666f70aa4f80140274057866888c0a5c28addc9b7fd2.css integrity="sha256-4hGF5sS0P/NMgWZvcKpPgBQCdAV4ZoiMClwordybf9I=" rel="preload stylesheet" as=style><link rel=icon href=https://shunyaueta.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shunyaueta.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shunyaueta.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shunyaueta.com/apple-touch-icon.png><link rel=mask-icon href=https://shunyaueta.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://shunyaueta.com/tags/gcp/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-39994406-11','auto');ga('send','pageview');}</script><meta property="og:title" content="gcp"><meta property="og:description" content="Shunya Ueta's blog"><meta property="og:type" content="website"><meta property="og:url" content="https://shunyaueta.com/tags/gcp/"><meta property="og:image" content="https://shunyaueta.com/ogp.jpg"><meta property="og:site_name" content="Shunya Ueta"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shunyaueta.com/ogp.jpg"><meta name=twitter:title content="gcp"><meta name=twitter:description content="Shunya Ueta's blog"></head><body class=list id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=https://shunyaueta.com/ accesskey=h title="ğŸ¦… hurutoriya (Alt + H)">ğŸ¦… hurutoriya</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://shunyaueta.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://shunyaueta.com/about title=About><span>About</span></a></li><li><a href=https://www.getrevue.co/profile/hurutoriya title=Newsletter><span>Newsletter</span></a></li><li><a href=https://www.buymeacoffee.com/hurutoriya title=Support><span>Support</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>gcp</h1></header><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy src=https://shunyaueta.com/posts/2022-01-20/images/1.png alt="bqutil.fn.typeof() ã®å®Ÿè¡Œçµæœ"></figure><header class=entry-header><h2>OSS ã® Google BigQuery UDF `bqutil.fn` ã‚’ä½¿ãˆã° UDF ã®ç‹¬è‡ªå®Ÿè£…ã‚’ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„</h2></header><section class=entry-content><p>TL;DR; UDF ã‚’ç‹¬è‡ªå®Ÿè£…ã™ã‚‹å‰ã«ã€bqutil.fnã‚’çœºã‚ã¦ãŠãã¨è»Šè¼ªã®å†ç™ºæ˜ãŒå›é¿ã§ãã‚‹ã‹ã‚‚
èƒŒæ™¯ SQL ã¯ã€ç‰¹å®šã®å‡¦ç†ã‚’è¡Œã†éš›ã«ãƒ‡ãƒ¼ã‚¿ã®å‹ãŒåŒä¸€ã§ãªã„ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ãŒã€ã‚‚ã¨ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ç´¹ä»‹ã™ã‚‹ã‚ˆã‚Šã‚‚ã‚‚ã£ã¨ãŠæ‰‹è»½ã«ã‚«ãƒ©ãƒ ã®å‹ã‚’ç¢ºèªã—ãŸã„ã¨ããŒã‚ã‚Šã¾ã›ã‚“ã‹?
ä¾‹ãˆã°ã€å‡ºåŠ›çµæœã‚’è¦‹ãŸã ã‘ã§ã¯ã€12345 ãŒ STRING ãªã®ã‹ INT64 ãªã®ã‹åˆ¤åˆ¥ä¸å¯èƒ½ã§ã™ã‚ˆã­ã€‚(ã‚‚ã—åˆ¤åˆ¥å¯èƒ½ãªæ–¹æ³•çŸ¥ã£ã¦ã„ã‚‹äººã„ãŸã‚‰æ•™ãˆã¦ä¸‹ã•ã„â€¦)
GCP ã«ã‚ˆã‚‹ OSS UDF ã® bqutil.fn ãªã®ã§ãŠæ‰‹è»½ã« BigQuery ã®çµæœã®å‹ã‚’ç¢ºèªã—ãŸã„æ™‚ã«ãªã«ã‹è‰¯ã„æ–¹æ³•ãŒãªã„ã‹ãªã¨èª¿ã¹ã¦ã„ãŸã‚‰ã€OSS ã§bqutil.fnã¨ã„ã† UDF ãŒ GCP ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ãŸã€‚
ä¾‹ãˆã°å‹ã®ç¢ºèªã®å ´åˆã€ä»¥ä¸‹ã® ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ï¼ˆUDF) ã¯ã©ã® GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å®Ÿè¡Œã—ã¦ã‚‚å®Ÿè¡Œå¯èƒ½
1 bqutil.fn.typeof() ã“ã®bqutil.fn ã¯bigquery-utils/udfs/community/ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ UDF ãŒbqutil ã¨ã„ã† GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®fn ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«åŒæœŸã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã©ã® GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Google BigQuery ã‹ã‚‰å®Ÿè¡Œã—ã¦ã‚‚ bqutil.fn.typeof()ã‚’å®Ÿè¡Œå¯èƒ½ã«ã—ã¦ã„ã‚‹ã‚‰ã—ã„ã€‚ é ­è‰¯ã„
This directory contains community contributed user-defined functions to extend BigQuery for more specialized usage patterns. Each UDF within this directory will be automatically synchronized to the bqutil project within the fn dataset for reference in queries....</p></section><footer class=entry-footer><span title="2022-01-20 00:03:07 +0900 +0900">January 20, 2022</span>&nbsp;Â·&nbsp;Shunya Ueta</footer><a class=entry-link aria-label="post link to OSS ã® Google BigQuery UDF `bqutil.fn` ã‚’ä½¿ãˆã° UDF ã®ç‹¬è‡ªå®Ÿè£…ã‚’ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„" href=https://shunyaueta.com/posts/2022-01-20/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Google Cloud Pub/Sub ã«å…¬é–‹ã•ã‚ŒãŸçµæœã¯Dataflow template ã‚’ä½¿ãˆã°ã‚ã¡ã‚ƒãã¡ã‚ƒç°¡å˜ã«ç¢ºèªã§ãã‚‹</h2></header><section class=entry-content><p>PubSub ã«å‡ºåŠ›ã•ã‚ŒãŸçµæœã‚’ç¢ºèªã™ã‚‹ã®ã£ã¦ã€ãªã‹ãªã‹æ‰‹é–“ãŒã‹ã‹ã‚Šã¾ã›ã‚“ã‹?
æœ€è¿‘åŒåƒšã«ç°¡å˜ãªç¢ºèªæ–¹æ³•ã‚’æ•™ãˆã¦ã‚‚ã‚‰ã„ã€æ„Ÿå‹•ã—ãŸã®ã§ãã‚Œã‚’è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚
ç¢ºèªæ–¹æ³• PubSub ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã™ã‚‹ Google Cloud Storage bucket ã‚’åŒä¸€ GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½œæˆã™ã‚‹ã€‚ GCP ã® Pub/Sub ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹ ç¢ºèªã—ãŸã„ Pub/Sub topic ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã«ã‚ã‚‹ CREATE SUBSCRIPTION ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨é¸æŠè‚¢ã§ã€Create subscription, Export to BigQuery, Export to Cloud StorageãŒã‚ã‚Šã€ Export to Cloud Storageã‚’é¸æŠã™ã‚‹ã€‚ BigQueryã€ Google Cloud Storage ã¸ã®åãå‡ºã—ã‚’è¡Œã„éš›ã«ã€è‡ªå‹•çš„ã« subscription ãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚ Export to Cloud Storage ã‚’é¸æŠã™ã‚‹ã¨ã€Text å½¢å¼ã‹ Abro å½¢å¼ã§ã®å‡ºåŠ›ã«ã™ã‚‹ã‹ã‚’é¸æŠã§ãã‚‹ã€‚åŸºæœ¬çš„ã«ã¯ç°¡å˜ã«ç¢ºèªã§ãã‚‹ Text å½¢å¼ã‚’é¸ã¶ã¨è‰¯ã•ã’ã€‚ é¸æŠå¾Œã€ä¸‹è¨˜ã®ã‚ˆã†ãªè¨­å®šç”»é¢ãŒå‡ºã¦ãã‚‹ã®ã§æƒ…å ±ã‚’åŸ‹ã‚ã¦ã„ãã€‚åŸºæœ¬çš„ã«ã¯ã€ã©ã“ã® Google Cloud Storage ã«å‡ºåŠ›ã™ã‚‹ã‹ã‚’åŸ‹ã‚ã‚Œã°å®Œäº†ã€‚ 10m ã»ã©ã™ã‚‹ã¨ Streaming job ã® Dataflow ã®èµ·å‹•ãŒå®Œäº†ã—ã¦ã€ä¸€å®šæœŸé–“ã”ã¨ã« Pub/Sub ã® topic ã«å…¬é–‹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§å‡ºåŠ›ã•ã‚Œå§‹ã‚ã¾ã™ã€‚ å‡ºåŠ›ã•ã‚ŒãŸ GCS ã®çµæœã‚’çœºã‚ã‚‹ã«ã¯ã€ gsutil ã‚³ãƒãƒ³ãƒ‰ãªã©ã‚’ä½¿ã†ã®ãŒç°¡å˜ã§ã™ã€‚è‡ªåˆ†ã¯gsutil cat ã®çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ VS Code ã§ç¢ºèªã—ã¦ã„ã¾ã™ã€‚ Cloud Dataflow ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ã«ã¤ã„ã¦ã¯ã€ç«¯çš„ã«èª¬æ˜ã™ã‚‹ã¨ã€GUI ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ã ã‘ã§ã€Dataflow ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãŒç°¡å˜ã«å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹æ©Ÿèƒ½ã§ã™ã€‚...</p></section><footer class=entry-footer><span title="2021-11-05 23:05:22 +0900 +0900">November 5, 2021</span>&nbsp;Â·&nbsp;Shunya Ueta</footer><a class=entry-link aria-label="post link to Google Cloud Pub/Sub ã«å…¬é–‹ã•ã‚ŒãŸçµæœã¯Dataflow template ã‚’ä½¿ãˆã°ã‚ã¡ã‚ƒãã¡ã‚ƒç°¡å˜ã«ç¢ºèªã§ãã‚‹" href=https://shunyaueta.com/posts/2021-11-05/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>CloudComposer ã®DAGã‚’CircleCIã§æ›´æ–°ã™ã‚‹</h2></header><section class=entry-content><p>Cloud Composer(Airflow) ã® DAG ã‚’ GitHub ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¦ã€CI ã«ã‚ˆã‚Šãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¦ã„ã‚‹ DAG ã‚’ Pull Request ãŒãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã¨ Cloud Composer ã® DAG ã¸åŒæœŸã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã™ã‚‹ã€‚
DAG ã¯ã€ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã® dags/ ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã‚’å‰æã¨ã™ã‚‹ã€‚
ä»¥ä¸‹ã®ï¼’ã¤ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦å®Ÿç¾ã§ãã‚‹ã€‚
Service Account ã®èªè¨¼ã®ãŸã‚ã« gcloud DAG ã®åŒæœŸã®ãŸã‚ã« gsutil CircleCI ã«ã‚ˆã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è¨˜è¿°ä¾‹ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 version:2.1jobs:rsync-dags:working_directory:~/workspacedocker:- image:gcr.io/google.com/cloudsdktool/cloud-sdk:alpineenvironment:GOOGLE_APPLICATION_CREDENTIALS:/gcp-service-key.jsonsteps:- checkout- run:name:SyncDAGfoldertoGCS'sDAGfoldercommand:| echo "${CLOUD_COMPOSER_CREDENTIALS_JSON}" > ${GOOGLE_APPLICATION_CREDENTIALS}gcloudauthactivate-service-account--key-file${GOOGLE_APPLICATION_CREDENTIALS}gsutil-mrsync-d-rdags\"$(gcloud composer environments describe {COMPOSER_NAME} --project={GCP_PROJECT} --location={REGION} --format="get(config....</p></section><footer class=entry-footer><span title="2021-10-04 22:23:24 +0900 +0900">October 4, 2021</span>&nbsp;Â·&nbsp;Shunya Ueta</footer><a class=entry-link aria-label="post link to CloudComposer ã®DAGã‚’CircleCIã§æ›´æ–°ã™ã‚‹" href=https://shunyaueta.com/posts/2021-10-04/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>GCPã®Cloud Composer ã®DAGã‚’ç´ æ—©ããƒ»ç°¡å˜ã«ãƒ‡ãƒãƒƒã‚°ã™ã‚‹</h2></header><section class=entry-content><p>GCPã§Airflow ã‚’ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ãˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ Cloud Composer ãŒå­˜åœ¨ã™ã‚‹ã€‚ BigQueryã‚„BigTable, PubSub ãªã©GCPã®å„ã‚µãƒ¼ãƒ“ã‚¹ã‚’DAGã¨ã—ã¦å®šç¾©ã—ã¦ã‚¸ãƒ§ãƒ–ã‚’å®šæœŸå®Ÿè¡Œã§ãã‚‹ã®ã§éå¸¸ã«ä¾¿åˆ©ã ãŒã€ãã®ä»£ã‚ã‚ŠDAGã‚’å®Ÿè¡Œã™ã‚‹ã¾ã§çµæœãŒã‚ã‹ã‚‰ãªã„ã®ã§ã€CloudComposer ã‚’ä¸€åº¦å®Ÿè¡Œã™ã‚‹ã—ã‹ç„¡ã„ã®ã§ãƒ‡ãƒãƒƒã‚°ãŒå›°é›£ã«ãªã‚‹å‚¾å‘ãŒã‚ã‚‹ã€‚
ã¾ãŸã€GitHubã®ãƒªãƒã‚¸ãƒˆãƒªã«DAGã‚’ä¿å­˜ã—ã¦ã€CIã§Cloud Composerã‚’æ›´æ–°ã™ã‚‹ã‚ˆã†ã—ã¦ã„ã‚‹ã¨ PRã‚’éƒ½åº¦ä½œã£ã¦ãƒãƒ¼ã‚¸ã•ã‚Œãªã„ã¨ç¢ºèªã§ããªã„ã¨ã„ã†å ´åˆã‚‚ã‚ã‚‹ã€‚
ãƒ­ãƒ¼ã‚«ãƒ«ã§Docker ã§èµ°ã‚‰ã›ã‚Œã°è‰¯ã„ã®ã˜ã‚ƒãªã„ã‹ã¨ã„ã†ãƒ„ãƒƒã‚³ãƒŸãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€çµå±€ Cloud Composer ä¸Šã§ã®å‹•ä½œã‚’ç¢ºã‹ã‚ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ä»Šå›ã®è¨˜äº‹ã‚’æ›¸ãã“ã¨ã«ã—ã¾ã—ãŸã€‚
NOTE: è‡ªåˆ†ãŒä½¿ç”¨ã—ã¦ã„ã‚‹Composerã®versionã¯composer-1.8.0-Airflow-1.10.3 ã§ã™ã€‚åŸºæœ¬çš„ã«ã‚„ã‚Œã‚‹ã“ã¨ã¯ä¸€ç·’ã ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€dev, prodã§åŒä¸€ã®DAGãŒèµ°ã‚‹Cloud Composer ã‚’é‹ç”¨ã—ã¦ã„ã‚‹ã¨ã„ã†å‰æã§ã™ã€‚
ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ï¼’ã¤
logger.info() ã‚’ä»•è¾¼ã‚“ã§ã€DAGã®ãªã‹ã§ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ 1 2 3 4 5 import logging logger = logging.getLogger(__name__) logger.info() loggerã‚’DAGã‚’è¨˜è¿°ã—ãŸ Pythonãƒ•ã‚¡ã‚¤ãƒ«ã«ä»•è¾¼ã‚“ã§ã€å†…éƒ¨ã§ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã‚’æŠŠæ¡ã™ã‚‹ã€‚
å„DAGã®logã¯ã€
GCPã®Cloud Composerã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Airflow webserver åˆ—ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Airflowã®Web applicaiton ã«ãƒ­ã‚°ã‚¤ãƒ³ ç¢ºèªã—ãŸã„DAGã‚’ã‚¯ãƒªãƒƒã‚¯ DAGå†…ã®task ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã® View Logã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€loggerã®æƒ…å ±ãŒç¢ºèªã§ãã‚‹ gstuil rsync ã‚³ãƒãƒ³ãƒ‰ã§ã®GCSã¸ã®DAGã®åŒæœŸ gstuil rsyncã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã“ã¨ã§ã€ãƒªãƒã‚¸ãƒˆãƒªã®DAGãƒ•ã‚¡ã‚¤ãƒ«ã‚’GCSã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹é–‹ç™ºç’°å¢ƒä¸Šã®CloudComposer ã®DAGãƒ•ã‚¡ã‚¤ãƒ«ã«ç›´æ¥åŒæœŸã—ã¦Pull Request ãƒãƒ¼ã‚¸å¾Œã®DAGã®æŒ™å‹•ã‚’ç¢ºèªã§ãã‚‹ã€‚
Cloud Composer ã®DAGã¯ã€è‡ªå‹•ä½œæˆã•ã‚ŒãŸGoogle Cloud Storage(GCS)ã«æ ¼ç´ã•ã‚Œã¦ãŠã‚Šã€GCSã‚’Cloud ComposerãŒå®šæœŸçš„ã«ç›£è¦–ã—ã¦Cloud Composerã‚’æ›´æ–°ã—ã¦ã„ã‚‹ã€‚ ã¤ã¾ã‚Šã€GCSä¸Šã®DAGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥æ›´æ–°ã—ã¦ã‚„ã‚‹ã¨ãã‚ŒãŒCloud Composerã«åæ˜ ã•ã‚Œã‚‹ã€‚ ä½“æ„Ÿã¨ã—ã¦2-3åˆ†ã«ä¸€åº¦ã¯ç›£è¦–ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã»ã¼å¾…ã¡çŠ¶æ…‹ãŒãªã„çŠ¶æ…‹ã§ç¢ºèªã§ãã¦ä¾¿åˆ©ã§ã™ã€‚...</p></section><footer class=entry-footer><span title="2021-09-29 22:20:23 +0900 +0900">September 29, 2021</span>&nbsp;Â·&nbsp;Shunya Ueta</footer><a class=entry-link aria-label="post link to GCPã®Cloud Composer ã®DAGã‚’ç´ æ—©ããƒ»ç°¡å˜ã«ãƒ‡ãƒãƒƒã‚°ã™ã‚‹" href=https://shunyaueta.com/posts/2021-09-29/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>gcloud commands ã§ PubSub ã« jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦å…¬é–‹ (Pusblish) ã™ã‚‹</h2></header><section class=entry-content><p>gcloud commands ã§ PubSub ã« json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦å…¬é–‹ (Pusblish) ã™ã‚‹
jq ã‚³ãƒãƒ³ãƒ‰ãŒå¿…è¦ã«ãªã‚‹ãŒã€ä¸€ç•ªç°¡å˜ã«å®Ÿç¾ã§ãã‚‹ã®ã¯
1 $ gcloud pubsub topics publish {PUBSUB_TOPIC_NAME} --message "$(cat {FILE_NAME} | jq -c)" jq ã‚³ãƒãƒ³ãƒ‰ã® -c ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ compact-output ã‚’æ„å‘³ã—ã¦ã„ã‚‹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ pretty-prints ã«ãªã£ã¦ã—ã¾ã†ã€‚ ãã‚Œã‚’é¿ã‘ã‚‹ãŸã‚ã«-cã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚
ref Publishing messages to topics Read a txt file JSON data to publish the messages in Cloud Pub Sub</p></section><footer class=entry-footer><span title="2021-09-07 12:22:16 +0900 +0900">September 7, 2021</span>&nbsp;Â·&nbsp;Shunya Ueta</footer><a class=entry-link aria-label="post link to gcloud commands ã§ PubSub ã« jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦å…¬é–‹ (Pusblish) ã™ã‚‹" href=https://shunyaueta.com/posts/2021-09-07/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://shunyaueta.com/tags/gcp/page/2/>æ¬¡ã®ãƒšãƒ¼ã‚¸ Â»</a></nav></footer></main><footer class=footer><span>&copy; 2022 <a href=https://shunyaueta.com/>ğŸ¦… hurutoriya</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z" /></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>